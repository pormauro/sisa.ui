Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app
File: +not-found.tsx
Content:
import { Link, Stack } from 'expo-router';
import { StyleSheet } from 'react-native';

export default function NotFoundScreen() {
  return (
    <>
      <Stack.Screen options={{ title: 'Oops!' }} />
        <Link href="/" style={styles.link}>
        Not Found
        </Link>
    </>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    alignItems: 'center',
    justifyContent: 'center',
    padding: 20,
  },
  link: {
    marginTop: 15,
    paddingVertical: 15,
  },
});

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app
File: Home.tsx
Content:
import React, { useContext } from 'react';
import { View, Text, StyleSheet, TouchableOpacity, ScrollView } from 'react-native';
import { useRouter } from 'expo-router';
import { AuthContext } from '@/contexts/AuthContext';
import { PermissionsContext } from '@/contexts/PermissionsContext';

interface MenuItem {
  title: string;
  route: string;
  // Si no se especifica, se asume que la secciÃ³n siempre estÃ¡ habilitada.
  requiredPermissions?: string[];
}

const menuItems: MenuItem[] = [
  { title: 'Errors', route: '/ErrorLogsList', requiredPermissions: ['viewErrors'] },
  { title: 'Clientes', route: '/clients', requiredPermissions: ['listClients'] },
  { title: 'Productos / Servicios', route: '/products_services', requiredPermissions: ['listProductsServices'] },
  { title: 'Carpetas', route: '/folders', requiredPermissions: ['listFolders'] },
  { title: 'Trabajos', route: '/jobs', requiredPermissions: ['listJobs'] },
  { title: 'Ventas', route: '/sales', requiredPermissions: ['listSales'] },
  { title: 'Gastos', route: '/expenses', requiredPermissions: ['listExpenses'] },
  { title: 'Citas', route: '/appointments', requiredPermissions: ['listAppointments'] },
 // { title: 'Notificaciones', route: '/notifications' }, // Sin restricciÃ³n
  { title: 'Cajas', route: '/cash_boxes', requiredPermissions: ['listCashBoxes'] },
  { title: 'Cierres Contables', route: '/accounting_closings', requiredPermissions: ['listClosings'] },
  { title: 'Perfil', route: '/user/ProfileScreen' }, // Sin restricciÃ³n
  { title: 'ConfiguraciÃ³n', route: '/user/ConfigScreen' }, // Sin restricciÃ³n
  { title: 'Estados', route: '/statuses', requiredPermissions: ['listStatuses'] },
  { title: 'Permisos', route: '/permission', requiredPermissions: ['listPermissions'] },
];

const Menu: React.FC = () => {
  const router = useRouter();
  const { userId } = useContext(AuthContext);
  const { permissions } = useContext(PermissionsContext);

  // FunciÃ³n para determinar si se deben mostrar los elementos con permisos requeridos.
  const isEnabled = (item: MenuItem): boolean => {
    // Si el usuario es super, se muestran todos.
    if (userId === '1') return true;
    // Si no hay permisos requeridos, se muestra.
    if (!item.requiredPermissions) return true;
    // De lo contrario, se verifica que el usuario tenga todos los permisos requeridos.
    return item.requiredPermissions.every((perm) => permissions.includes(perm));
  };

  // Filtramos el array de elementos para mostrar solo los habilitados.
  const visibleMenuItems = menuItems.filter(isEnabled);

  return (
    <ScrollView style={styles.container}>
      <Text style={styles.title}>MenÃº Principal</Text>
      {visibleMenuItems.map((item: MenuItem, index: number) => (
        <TouchableOpacity
          key={index}
          style={styles.menuItem}
          onPress={() => router.push(item.route as any)}
        >
          <Text style={styles.menuText}>{item.title}</Text>
        </TouchableOpacity>
      ))}
      <View>
        <Text></Text>
      </View>
    </ScrollView>
  );
};

export default Menu;

const styles = StyleSheet.create({
  container: {
    flex: 1,
    padding: 20,
    backgroundColor: '#f2f2f2',
  },
  title: {
    fontSize: 28,
    fontWeight: 'bold',
    marginBottom: 20,
    textAlign: 'center',
  },
  menuItem: {
    backgroundColor: '#007BFF',
    paddingVertical: 15,
    paddingHorizontal: 10,
    borderRadius: 10,
    marginBottom: 10,
    alignItems: 'center',
  },
  menuText: {
    color: 'white',
    fontSize: 18,
  },
});

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app
File: Index.tsx
Content:
import { AuthContext } from '@/contexts/AuthContext';
import React from 'react';
import { View, StyleSheet, Image } from 'react-native';

export default function SplashScreen() {
  return (
    <View style={styles.container}>
      <Image 
        source={require('@/assets/images/logo.png')} 
        style={styles.logo} 
      />
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#2f273e',
    justifyContent: 'center',
    alignItems: 'center',
  },
  logo: {
    width: '90%',
    resizeMode: 'contain',
  },
});

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app
File: output.txt
Content:

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app
File: _layout.tsx
Content:
import React, { useContext, useEffect } from 'react';
import { View, ActivityIndicator, StyleSheet } from 'react-native';
import { Stack, useRouter } from 'expo-router';
import { AuthProvider, AuthContext } from '@/contexts/AuthContext';
import { ProfileProvider } from '@/contexts/ProfileContext';
import { ConfigProvider } from '@/contexts/ConfigContext';
import { PermissionsProvider } from '@/contexts/PermissionsContext';
import { CashBoxesProvider } from '@/contexts/CashBoxesContext';
import { ClientsProvider } from '@/contexts/ClientsContext';
import { FoldersProvider } from '@/contexts/FoldersContext';
import { ProductsServicesProvider } from '@/contexts/ProductsServicesContext';
import { JobsProvider } from '@/contexts/JobsContext';
import { StatusesProvider } from '@/contexts/StatusesContext';
import { FilesProvider } from '@/contexts/FilesContext';


function RootLayoutContent() {
  const { isLoading, username } = useContext(AuthContext);
  const router = useRouter();

  useEffect(() => {
    if (!isLoading) {
      if (username) {
        router.replace('/Home');
      } else {
        router.replace('/login/Login');
      }
    }
  }, [isLoading, username]);

  if (isLoading) {
    return (
      <View style={styles.loadingContainer}>
        <ActivityIndicator size="large" color="#ffffff" />
      </View>
    );
  }

  return (
    <Stack screenOptions={{ headerShown: false }}>
      <Stack.Screen name="Index" />
      <Stack.Screen name="login" />
      <Stack.Screen name="Home" />
      <Stack.Screen name="+not-found" />
    </Stack>
  );
}

export default function RootLayout() {
  return (
    <AuthProvider>
      <PermissionsProvider>
        <FilesProvider>
          <ProfileProvider>
            <ConfigProvider>
              <CashBoxesProvider>
                <ClientsProvider>
                  <ProductsServicesProvider>
                    <StatusesProvider>
                      <JobsProvider>
                        <FoldersProvider>
                          <RootLayoutContent />
                        </FoldersProvider>
                      </JobsProvider>
                    </StatusesProvider>
                  </ProductsServicesProvider>
                </ClientsProvider>
              </CashBoxesProvider>
            </ConfigProvider>
          </ProfileProvider>
        </FilesProvider>
      </PermissionsProvider>
    </AuthProvider>
  );
}

const styles = StyleSheet.create({
  loadingContainer: {
    flex: 1,
    backgroundColor: '#2f273e',
    justifyContent: 'center',
    alignItems: 'center',
  },
});

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\appointments
File: index.tsx
Content:

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\cash_boxes
File: create.tsx
Content:
// C:/Users/Mauri/Documents/GitHub/router/app/cash_boxes/create.tsx
import React, { useState, useContext, useEffect } from 'react';
import { View, Text, TextInput, TouchableOpacity, StyleSheet, ScrollView, Alert, ActivityIndicator } from 'react-native';
import { useRouter } from 'expo-router';
import { CashBoxesContext } from '@/contexts/CashBoxesContext';
import { PermissionsContext } from '@/contexts/PermissionsContext';
import CircleImagePicker from '@/components/CircleImagePicker';

export default function CreateCashBox() {
  const router = useRouter();
  const { addCashBox, loadCashBoxes } = useContext(CashBoxesContext);
  const { permissions } = useContext(PermissionsContext);
  
  const [name, setName] = useState('');
  const [imageFileId, setImageFileId] = useState<string | null>(null);
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    if (!permissions.includes('addCashBox')) {
      Alert.alert('Acceso denegado', 'No tienes permiso para crear cajas.');
      router.back();
    }
  }, [permissions]);

  const handleSubmit = async () => {
    if (!name) {
      Alert.alert('Error', 'El nombre es obligatorio');
      return;
    }
    setLoading(true);
    const newCashBox = await addCashBox({ name, image_file_id: imageFileId });
    await loadCashBoxes();
    setLoading(false);
    if (newCashBox) {
      Alert.alert('Ã‰xito', 'Caja creada exitosamente');
      router.back();
    } else {
      Alert.alert('Error', 'No se pudo crear la caja');
    }
  };

  return (
    <ScrollView contentContainerStyle={styles.container}>
      <Text style={styles.label}>Imagen de la Caja</Text>
      <CircleImagePicker 
        fileId={imageFileId} 
        editable={true}
        size={200} 
        onImageChange={(newId) => setImageFileId(newId)}
      />

      <Text style={styles.label}>Nombre de la Caja</Text>
      <TextInput 
        style={styles.input}
        placeholder="Nombre de la caja"
        value={name}
        onChangeText={setName}
      />

      <TouchableOpacity style={styles.submitButton} onPress={handleSubmit} disabled={loading}>
        {loading ? <ActivityIndicator color="#fff" /> : <Text style={styles.submitButtonText}>Crear Caja</Text>}
      </TouchableOpacity>
    </ScrollView>
  );
}

const styles = StyleSheet.create({
  container: { padding: 16, backgroundColor: '#fff' },
  label: { marginVertical: 8, fontSize: 16 },
  input: { borderWidth: 1, borderColor: '#ccc', borderRadius: 8, padding: 12, marginBottom: 8 },
  submitButton: { marginTop: 16, backgroundColor: '#28a745', padding: 16, borderRadius: 8, alignItems: 'center' },
  submitButtonText: { color: '#fff', fontSize: 16, fontWeight: 'bold' },
});

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\cash_boxes
File: index.tsx
Content:
// C:/Users/Mauri/Documents/GitHub/router/app/cash_boxes/CashBoxesScreen.tsx
import React, { useContext, useState, useMemo, useEffect } from 'react';
import { View, Text, FlatList, TouchableOpacity, TextInput, StyleSheet, ActivityIndicator, Alert } from 'react-native';
import { useRouter } from 'expo-router';
import Fuse from 'fuse.js';
import CircleImagePicker from '@/components/CircleImagePicker';
import { CashBoxesContext, CashBox } from '@/contexts/CashBoxesContext';
import { PermissionsContext } from '@/contexts/PermissionsContext';

export default function CashBoxesScreen() {
  const { cashBoxes, loadCashBoxes, deleteCashBox } = useContext(CashBoxesContext);
  const { permissions } = useContext(PermissionsContext);
  const router = useRouter();
  const [searchQuery, setSearchQuery] = useState('');
  const [loadingId, setLoadingId] = useState<number | null>(null);

  useEffect(() => {
    // Verificamos el permiso para listar cajas
    if (!permissions.includes('listCashBoxes')) {
      Alert.alert('Acceso denegado', 'No tienes permiso para ver las cajas.');
      router.back();
    } else {
      loadCashBoxes();
    }
  }, [permissions]);

  const fuse = new Fuse(cashBoxes, { keys: ['name'] });
  const filteredCashBoxes = useMemo(() => {
    if (!searchQuery) return cashBoxes;
    const results = fuse.search(searchQuery);
    return results.map(result => result.item);
  }, [searchQuery, cashBoxes]);

  const canDeleteCashBox = permissions.includes('deleteCashBox');

  const handleDelete = (id: number) => {
    Alert.alert(
      'Confirmar eliminaciÃ³n',
      'Â¿EstÃ¡ seguro de que desea eliminar esta caja?',
      [
        { text: 'Cancelar', style: 'cancel' },
        {
          text: 'Eliminar',
          style: 'destructive',
          onPress: async () => {
            setLoadingId(id);
            const success = await deleteCashBox(id);
            setLoadingId(null);
            if (!success) {
              Alert.alert('Error', 'No se pudo eliminar la caja');
            }
          }
        }
      ]
    );
  };

  const renderItem = ({ item }: { item: CashBox }) => (
    <TouchableOpacity style={styles.itemContainer} onLongPress={() => router.push(`./cash_boxes/${item.id}`)}>
      <CircleImagePicker fileId={item.image_file_id} size={50} />
      <View style={styles.itemInfo}>
        <Text style={styles.itemTitle}>{item.name}</Text>
      </View>
      {canDeleteCashBox && (
        <TouchableOpacity style={styles.deleteButton} onPress={() => handleDelete(item.id)}>
          {loadingId === item.id ? <ActivityIndicator /> : <Text style={styles.deleteText}>ðŸ—‘</Text>}
        </TouchableOpacity>
      )}
    </TouchableOpacity>
  );

  return (
    <View style={styles.container}>
      <TextInput 
        placeholder="Buscar caja..."
        style={styles.searchInput}
        value={searchQuery}
        onChangeText={setSearchQuery}
      />
      <FlatList 
        data={filteredCashBoxes}
        keyExtractor={(item) => item.id.toString()}
        renderItem={renderItem}
        ListEmptyComponent={<Text style={styles.emptyText}>No se encontraron cajas</Text>}
      />
      <TouchableOpacity style={styles.addButton} onPress={() => router.push('/cash_boxes/create')}>
        <Text style={styles.addButtonText}>âž• Agregar Caja</Text>
      </TouchableOpacity>
    </View>
  );
}

const styles = StyleSheet.create({
  container: { flex: 1, padding: 16, backgroundColor: '#fff' },
  searchInput: { borderWidth: 1, borderColor: '#ccc', borderRadius: 8, padding: 12, marginBottom: 12 },
  itemContainer: { flexDirection: 'row', alignItems: 'center', paddingVertical: 8, borderBottomWidth: 1, borderColor: '#eee' },
  itemInfo: { flex: 1, marginLeft: 12 },
  itemTitle: { fontSize: 16, fontWeight: 'bold' },
  deleteButton: { padding: 8 },
  deleteText: { fontSize: 18 },
  addButton: { position: 'absolute', right: 16, bottom: 32, backgroundColor: '#007BFF', padding: 16, borderRadius: 50, alignItems: 'center', justifyContent: 'center' },
  addButtonText: { color: '#fff', fontSize: 16, fontWeight: 'bold' },
  emptyText: { textAlign: 'center', marginTop: 20, fontSize: 16 },
});

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\cash_boxes
File: output.txt
Content:
Folder: C:/Users/Mauri/Documents/GitHub/router/app/cash_boxes
File: create.tsx
Content:
// C:/Users/Mauri/Documents/GitHub/router/app/cash_boxes/create.tsx
import React, { useState, useContext, useEffect } from 'react';
import { View, Text, TextInput, TouchableOpacity, StyleSheet, ScrollView, Alert, ActivityIndicator } from 'react-native';
import { useRouter } from 'expo-router';
import { CashBoxesContext } from '@/contexts/CashBoxesContext';
import { PermissionsContext } from '@/contexts/PermissionsContext';
import CircleImagePicker from '@/components/image/CircleImagePicker';

export default function CreateCashBox() {
  const router = useRouter();
  const { addCashBox } = useContext(CashBoxesContext);
  const { permissions } = useContext(PermissionsContext);
  
  const [name, setName] = useState('');
  const [imageFileId, setImageFileId] = useState<string | null>(null);
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    if (!permissions.includes('addCashBox')) {
      Alert.alert('Acceso denegado', 'No tienes permiso para crear cajas.');
      router.back();
    }
  }, [permissions]);

  const handleSubmit = async () => {
    if (!name) {
      Alert.alert('Error', 'El nombre es obligatorio');
      return;
    }
    setLoading(true);
    const newCashBox = await addCashBox({ name, image_file_id: imageFileId });
    setLoading(false);
    if (newCashBox) {
      Alert.alert('Ãƒâ€°xito', 'Caja creada exitosamente');
      router.back();
    } else {
      Alert.alert('Error', 'No se pudo crear la caja');
    }
  };

  return (
    <ScrollView contentContainerStyle={styles.container}>
      <Text style={styles.label}>Imagen de la Caja</Text>
      <CircleImagePicker 
        fileId={imageFileId} 
        editable={true}
        size={200} 
        onImageChange={(newId) => setImageFileId(newId)}
      />

      <Text style={styles.label}>Nombre de la Caja</Text>
      <TextInput 
        style={styles.input}
        placeholder="Nombre de la caja"
        value={name}
        onChangeText={setName}
      />

      <TouchableOpacity style={styles.submitButton} onPress={handleSubmit} disabled={loading}>
        {loading ? <ActivityIndicator color="#fff" /> : <Text style={styles.submitButtonText}>Crear Caja</Text>}
      </TouchableOpacity>
    </ScrollView>
  );
}

const styles = StyleSheet.create({
  container: { padding: 16, backgroundColor: '#fff' },
  label: { marginVertical: 8, fontSize: 16 },
  input: { borderWidth: 1, borderColor: '#ccc', borderRadius: 8, padding: 12, marginBottom: 8 },
  submitButton: { marginTop: 16, backgroundColor: '#28a745', padding: 16, borderRadius: 8, alignItems: 'center' },
  submitButtonText: { color: '#fff', fontSize: 16, fontWeight: 'bold' },
});

---
Folder: C:/Users/Mauri/Documents/GitHub/router/app/cash_boxes
File: index.tsx
Content:
// C:/Users/Mauri/Documents/GitHub/router/app/cash_boxes/CashBoxesScreen.tsx
import React, { useContext, useState, useMemo, useEffect } from 'react';
import { View, Text, FlatList, TouchableOpacity, TextInput, StyleSheet, ActivityIndicator, Alert } from 'react-native';
import { useRouter } from 'expo-router';
import Fuse from 'fuse.js';
import CircleImagePicker from '@/components/image/CircleImagePicker';
import { CashBoxesContext, CashBox } from '@/contexts/CashBoxesContext';
import { PermissionsContext } from '@/contexts/PermissionsContext';

export default function CashBoxesScreen() {
  const { cashBoxes, loadCashBoxes, deleteCashBox } = useContext(CashBoxesContext);
  const { permissions } = useContext(PermissionsContext);
  const router = useRouter();
  const [searchQuery, setSearchQuery] = useState('');
  const [loadingId, setLoadingId] = useState<number | null>(null);

  useEffect(() => {
    // Verificamos el permiso para listar cajas
    if (!permissions.includes('listCashBoxes')) {
      Alert.alert('Acceso denegado', 'No tienes permiso para ver las cajas.');
      router.back();
    } else {
      loadCashBoxes();
    }
  }, [permissions]);

  const fuse = new Fuse(cashBoxes, { keys: ['name'] });
  const filteredCashBoxes = useMemo(() => {
    if (!searchQuery) return cashBoxes;
    const results = fuse.search(searchQuery);
    return results.map(result => result.item);
  }, [searchQuery, cashBoxes]);

  const canDeleteCashBox = permissions.includes('deleteCashBox');

  const handleDelete = (id: number) => {
    Alert.alert(
      'Confirmar eliminaciÃƒÂ³n',
      'Ã‚Â¿EstÃƒÂ¡ seguro de que desea eliminar esta caja?',
      [
        { text: 'Cancelar', style: 'cancel' },
        {
          text: 'Eliminar',
          style: 'destructive',
          onPress: async () => {
            setLoadingId(id);
            const success = await deleteCashBox(id);
            setLoadingId(null);
            if (!success) {
              Alert.alert('Error', 'No se pudo eliminar la caja');
            }
          }
        }
      ]
    );
  };

  const renderItem = ({ item }: { item: CashBox }) => (
    <TouchableOpacity style={styles.itemContainer} onPress={() => router.push(`./products_services/${item.id}`)}>
      <CircleImagePicker fileId={item.image_file_id} size={50} />
      <View style={styles.itemInfo}>
        <Text style={styles.itemTitle}>{item.name}</Text>
      </View>
      {canDeleteCashBox && (
        <TouchableOpacity style={styles.deleteButton} onPress={() => handleDelete(item.id)}>
          {loadingId === item.id ? <ActivityIndicator /> : <Text style={styles.deleteText}>Ã°Å¸â€”â€˜</Text>}
        </TouchableOpacity>
      )}
    </TouchableOpacity>
  );

  return (
    <View style={styles.container}>
      <TextInput 
        placeholder="Buscar caja..."
        style={styles.searchInput}
        value={searchQuery}
        onChangeText={setSearchQuery}
      />
      <FlatList 
        data={filteredCashBoxes}
        keyExtractor={(item) => item.id.toString()}
        renderItem={renderItem}
        ListEmptyComponent={<Text style={styles.emptyText}>No se encontraron cajas</Text>}
      />
      <TouchableOpacity style={styles.addButton} onPress={() => router.push('/cash_boxes/create')}>
        <Text style={styles.addButtonText}>Ã¢Å¾â€¢ Agregar Caja</Text>
      </TouchableOpacity>
    </View>
  );
}

const styles = StyleSheet.create({
  container: { flex: 1, padding: 16, backgroundColor: '#fff' },
  searchInput: { borderWidth: 1, borderColor: '#ccc', borderRadius: 8, padding: 12, marginBottom: 12 },
  itemContainer: { flexDirection: 'row', alignItems: 'center', paddingVertical: 8, borderBottomWidth: 1, borderColor: '#eee' },
  itemInfo: { flex: 1, marginLeft: 12 },
  itemTitle: { fontSize: 16, fontWeight: 'bold' },
  deleteButton: { padding: 8 },
  deleteText: { fontSize: 18 },
  addButton: { position: 'absolute', right: 16, bottom: 32, backgroundColor: '#007BFF', padding: 16, borderRadius: 50, alignItems: 'center', justifyContent: 'center' },
  addButtonText: { color: '#fff', fontSize: 16, fontWeight: 'bold' },
  emptyText: { textAlign: 'center', marginTop: 20, fontSize: 16 },
});

---
Folder: C:/Users/Mauri/Documents/GitHub/router/app/cash_boxes
File: output.txt
Content:

---
Folder: C:/Users/Mauri/Documents/GitHub/router/app/cash_boxes
File: [id].tsx
Content:
// C:/Users/Mauri/Documents/GitHub/router/app/cash_boxes/[id].tsx
import React, { useState, useContext, useEffect } from 'react';
import { View, Text, TextInput, TouchableOpacity, StyleSheet, ScrollView, Alert, ActivityIndicator } from 'react-native';
import { useRouter, useLocalSearchParams } from 'expo-router';
import { CashBoxesContext, CashBox } from '@/contexts/CashBoxesContext';
import { PermissionsContext } from '@/contexts/PermissionsContext';
import CircleImagePicker from '@/components/image/CircleImagePicker';

export default function CashBoxDetail() {
  const router = useRouter();
  const { id } = useLocalSearchParams<{ id: string }>();
  const cashBoxId = Number(id);
  const { cashBoxes, updateCashBox, deleteCashBox } = useContext(CashBoxesContext);
  const { permissions } = useContext(PermissionsContext);
  const [name, setName] = useState('');
  const [imageFileId, setImageFileId] = useState<string | null>(null);
  const [loading, setLoading] = useState(false);

  const canEdit = permissions.includes('updateCashBox');
  const canDelete = permissions.includes('deleteCashBox');

  const cashBox = cashBoxes.find(cb => cb.id === cashBoxId);

  useEffect(() => {
    if (!canEdit && !canDelete) {
      Alert.alert('Acceso denegado', 'No tienes permiso para acceder a esta caja.');
      router.back();
    }
  }, [permissions]);

  useEffect(() => {
    if (!cashBox) {
      Alert.alert('Error', 'Caja no encontrada');
      router.back();
    } else {
      setName(cashBox.name);
      setImageFileId(cashBox.image_file_id);
    }
  }, [cashBox]);

  const handleUpdate = () => {
    if (!name) {
      Alert.alert('Error', 'El nombre es obligatorio');
      return;
    }
    Alert.alert(
      'Actualizar',
      'Ã‚Â¿Actualizar esta caja?',
      [
        { text: 'Cancelar', style: 'cancel' },
        {
          text: 'Actualizar',
          onPress: async () => {
            setLoading(true);
            const success = await updateCashBox(cashBoxId, { name, image_file_id: imageFileId });
            setLoading(false);
            if (success) {
              Alert.alert('Ãƒâ€°xito', 'Caja actualizada');
              router.back();
            } else {
              Alert.alert('Error', 'No se pudo actualizar la caja');
            }
          }
        }
      ]
    );
  };

  const handleDelete = () => {
    Alert.alert(
      'Eliminar',
      'Ã‚Â¿Eliminar esta caja?',
      [
        { text: 'Cancelar', style: 'cancel' },
        {
          text: 'Eliminar',
          onPress: async () => {
            setLoading(true);
            const success = await deleteCashBox(cashBoxId);
            setLoading(false);
            if (success) {
              Alert.alert('Ãƒâ€°xito', 'Caja eliminada');
              router.back();
            } else {
              Alert.alert('Error', 'No se pudo eliminar la caja');
            }
          }
        }
      ]
    );
  };

  return (
    <ScrollView contentContainerStyle={styles.container}>
      <Text style={styles.label}>Imagen de la Caja</Text>
      <CircleImagePicker 
        fileId={imageFileId} 
        editable={true}
        size={200} 
        onImageChange={(newId) => setImageFileId(newId)}
      />

      <Text style={styles.label}>Nombre de la Caja</Text>
      <TextInput 
        style={styles.input}
        value={name}
        onChangeText={setName}
      />

      {canEdit && (
        <TouchableOpacity style={styles.submitButton} onPress={handleUpdate}>
          {loading ? <ActivityIndicator color="#fff" /> : <Text style={styles.submitButtonText}>Actualizar Caja</Text>}
        </TouchableOpacity>
      )}

      {canDelete && (
        <TouchableOpacity style={styles.deleteButton} onPress={handleDelete}>
          {loading ? <ActivityIndicator color="#fff" /> : <Text style={styles.deleteButtonText}>Eliminar Caja</Text>}
        </TouchableOpacity>
      )}
    </ScrollView>
  );
}

const styles = StyleSheet.create({
  container: { padding: 16, backgroundColor: '#fff', flexGrow: 1 },
  label: { marginVertical: 8, fontSize: 16 },
  input: { borderWidth: 1, borderColor: '#ccc', borderRadius: 8, padding: 12, marginBottom: 8 },
  submitButton: { marginTop: 16, backgroundColor: '#007BFF', padding: 16, borderRadius: 8, alignItems: 'center' },
  submitButtonText: { color: '#fff', fontSize: 16, fontWeight: 'bold' },
  deleteButton: { marginTop: 16, backgroundColor: '#dc3545', padding: 16, borderRadius: 8, alignItems: 'center' },
  deleteButtonText: { color: '#fff', fontSize: 16, fontWeight: 'bold' },
});

---
Folder: C:/Users/Mauri/Documents/GitHub/router/app/cash_boxes
File: _layout.tsx
Content:
// C:/Users/Mauri/Documents/GitHub/router/app/cash_boxes/_layout.tsx
import React from 'react';
import { Stack } from 'expo-router';

export default function CashBoxesLayout() {
  return (
    <Stack>
      <Stack.Screen name="index" options={{ title: 'Cajas' }} />
      <Stack.Screen name="create" options={{ title: 'Nueva Caja' }} />
      <Stack.Screen name="[id]" options={{ title: 'Editar Caja' }} />
    </Stack>
  );
}

---

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\cash_boxes
File: [id].tsx
Content:
// C:/Users/Mauri/Documents/GitHub/router/app/cash_boxes/[id].tsx
import React, { useState, useContext, useEffect } from 'react';
import { View, Text, TextInput, TouchableOpacity, StyleSheet, ScrollView, Alert, ActivityIndicator } from 'react-native';
import { useRouter, useLocalSearchParams } from 'expo-router';
import { CashBoxesContext, CashBox } from '@/contexts/CashBoxesContext';
import { PermissionsContext } from '@/contexts/PermissionsContext';
import CircleImagePicker from '@/components/CircleImagePicker';

export default function CashBoxDetail() {
  const router = useRouter();
  const { id } = useLocalSearchParams<{ id: string }>();
  const cashBoxId = Number(id);
  const { cashBoxes, updateCashBox, deleteCashBox } = useContext(CashBoxesContext);
  const { permissions } = useContext(PermissionsContext);
  const [name, setName] = useState('');
  const [imageFileId, setImageFileId] = useState<string | null>(null);
  const [loading, setLoading] = useState(false);

  const canEdit = permissions.includes('updateCashBox');
  const canDelete = permissions.includes('deleteCashBox');

  const cashBox = cashBoxes.find(cb => cb.id === cashBoxId);

  useEffect(() => {
    if (!canEdit && !canDelete) {
      Alert.alert('Acceso denegado', 'No tienes permiso para acceder a esta caja.');
      router.back();
    }
  }, [permissions]);

  useEffect(() => {
    if (!cashBox) {
      Alert.alert('Error', 'Caja no encontrada');
      router.back();
    } else {
      setName(cashBox.name);
      setImageFileId(cashBox.image_file_id);
    }
  }, [cashBox]);

  const handleUpdate = () => {
    if (!name) {
      Alert.alert('Error', 'El nombre es obligatorio');
      return;
    }
    Alert.alert(
      'Actualizar',
      'Â¿Actualizar esta caja?',
      [
        { text: 'Cancelar', style: 'cancel' },
        {
          text: 'Actualizar',
          onPress: async () => {
            setLoading(true);
            const success = await updateCashBox(cashBoxId, { name, image_file_id: imageFileId });
            setLoading(false);
            if (success) {
              Alert.alert('Ã‰xito', 'Caja actualizada');
              router.back();
            } else {
              Alert.alert('Error', 'No se pudo actualizar la caja');
            }
          }
        }
      ]
    );
  };

  const handleDelete = () => {
    Alert.alert(
      'Eliminar',
      'Â¿Eliminar esta caja?',
      [
        { text: 'Cancelar', style: 'cancel' },
        {
          text: 'Eliminar',
          onPress: async () => {
            setLoading(true);
            const success = await deleteCashBox(cashBoxId);
            setLoading(false);
            if (success) {
              Alert.alert('Ã‰xito', 'Caja eliminada');
              router.back();
            } else {
              Alert.alert('Error', 'No se pudo eliminar la caja');
            }
          }
        }
      ]
    );
  };

  return (
    <ScrollView contentContainerStyle={styles.container}>
      <Text style={styles.label}>Imagen de la Caja</Text>
      <CircleImagePicker 
        fileId={imageFileId} 
        editable={true}
        size={200} 
        onImageChange={(newId) => setImageFileId(newId)}
      />

      <Text style={styles.label}>Nombre de la Caja</Text>
      <TextInput 
        style={styles.input}
        value={name}
        onChangeText={setName}
      />

      {canEdit && (
        <TouchableOpacity style={styles.submitButton} onPress={handleUpdate}>
          {loading ? <ActivityIndicator color="#fff" /> : <Text style={styles.submitButtonText}>Actualizar Caja</Text>}
        </TouchableOpacity>
      )}

      {canDelete && (
        <TouchableOpacity style={styles.deleteButton} onPress={handleDelete}>
          {loading ? <ActivityIndicator color="#fff" /> : <Text style={styles.deleteButtonText}>Eliminar Caja</Text>}
        </TouchableOpacity>
      )}
    </ScrollView>
  );
}

const styles = StyleSheet.create({
  container: { padding: 16, backgroundColor: '#fff', flexGrow: 1 },
  label: { marginVertical: 8, fontSize: 16 },
  input: { borderWidth: 1, borderColor: '#ccc', borderRadius: 8, padding: 12, marginBottom: 8 },
  submitButton: { marginTop: 16, backgroundColor: '#007BFF', padding: 16, borderRadius: 8, alignItems: 'center' },
  submitButtonText: { color: '#fff', fontSize: 16, fontWeight: 'bold' },
  deleteButton: { marginTop: 16, backgroundColor: '#dc3545', padding: 16, borderRadius: 8, alignItems: 'center' },
  deleteButtonText: { color: '#fff', fontSize: 16, fontWeight: 'bold' },
});

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\cash_boxes
File: _layout.tsx
Content:
// C:/Users/Mauri/Documents/GitHub/router/app/cash_boxes/_layout.tsx
import React from 'react';
import { Stack } from 'expo-router';

export default function CashBoxesLayout() {
  return (
    <Stack>
      <Stack.Screen name="index" options={{ title: 'Cajas' }} />
      <Stack.Screen name="create" options={{ title: 'Nueva Caja' }} />
      <Stack.Screen name="[id]" options={{ title: 'Editar Caja' }} />
    </Stack>
  );
}

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\clients
File: create.tsx
Content:
// /app/clients/create.tsx
import React, { useState, useContext, useEffect } from 'react';
import { View, Text, TextInput, TouchableOpacity, StyleSheet, ScrollView, Alert } from 'react-native';
import { useRouter } from 'expo-router';
import { ClientsContext } from '@/contexts/ClientsContext';
import CircleImagePicker from '@/components/CircleImagePicker';
import { PermissionsContext } from '@/contexts/PermissionsContext';

export default function CreateClientPage() {
  const { permissions } = useContext(PermissionsContext);
  const { addClient } = useContext(ClientsContext);
  const router = useRouter();

  const [businessName, setBusinessName] = useState('');
  const [taxId, setTaxId] = useState('');
  const [email, setEmail] = useState('');
  const [phone, setPhone] = useState('');
  const [address, setAddress] = useState('');
  const [brandFileId, setBrandFileId] = useState<string | null>(null);
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    if (!permissions.includes('addClient')) {
      Alert.alert('Acceso denegado', 'No tienes permiso para crear clientes.');
      router.back();
    }
  }, []);
  const handleSubmit = async () => {
  /*  if (!businessName || !taxId || !email) {
      Alert.alert('Error', 'Por favor ingresa Nombre de Negocio, Tax ID y Email');
      return;
    }*/
    setLoading(true);
    const newClient = await addClient({
      business_name: businessName,
      tax_id: taxId,
      email,
      phone,
      address,
      brand_file_id: brandFileId,
    });
    setLoading(false);
    if (newClient) {
      Alert.alert('Ã‰xito', 'Cliente creado exitosamente');
      router.back();
    } else {
      Alert.alert('Error', 'No se pudo crear el cliente');
    }
  };

  return (
    <ScrollView contentContainerStyle={styles.container}>
      <Text style={styles.label}>Imagen del Cliente</Text>
      <CircleImagePicker 
        fileId={brandFileId} 
        editable={true}
        size={200} 
        onImageChange={(newFileId) => setBrandFileId(newFileId)} 
      />

      <Text style={styles.label}>Nombre del Negocio</Text>
      <TextInput
        style={styles.input}
        placeholder="Nombre del negocio"
        value={businessName}
        onChangeText={setBusinessName}
      />

      <Text style={styles.label}>Tax ID</Text>
      <TextInput
        style={styles.input}
        placeholder="Tax ID"
        value={taxId}
        onChangeText={setTaxId}
      />

      <Text style={styles.label}>Email</Text>
      <TextInput
        style={styles.input}
        placeholder="Email"
        value={email}
        onChangeText={setEmail}
      />

      <Text style={styles.label}>TelÃ©fono</Text>
      <TextInput
        style={styles.input}
        placeholder="TelÃ©fono"
        value={phone}
        onChangeText={setPhone}
      />

      <Text style={styles.label}>DirecciÃ³n</Text>
      <TextInput
        style={styles.input}
        placeholder="DirecciÃ³n"
        value={address}
        onChangeText={setAddress}
      />

      <TouchableOpacity style={styles.submitButton} onPress={handleSubmit} disabled={loading}>
        <Text style={styles.submitButtonText}>{loading ? 'Creando...' : 'Crear Cliente'}</Text>
      </TouchableOpacity>
    </ScrollView>
  );
}

const styles = StyleSheet.create({
  container: { padding: 16, backgroundColor: '#fff' },
  label: { marginVertical: 8, fontSize: 16 },
  input: {
    borderWidth: 1,
    borderColor: '#ccc',
    borderRadius: 8,
    padding: 12,
    marginBottom: 8,
  },
  submitButton: {
    marginTop: 16,
    backgroundColor: '#28a745',
    padding: 16,
    borderRadius: 8,
    alignItems: 'center',
  },
  submitButtonText: { color: '#fff', fontSize: 16, fontWeight: 'bold' },
});

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\clients
File: index.tsx
Content:
// /app/clients/index.tsx
import React, { useContext, useState, useMemo, useEffect } from 'react';
import { View, Text, FlatList, TouchableOpacity, TextInput, StyleSheet, ActivityIndicator, Alert } from 'react-native';
import { ClientsContext, Client } from '@/contexts/ClientsContext';
import { useRouter } from 'expo-router';
import Fuse from 'fuse.js';
import CircleImagePicker from '@/components/CircleImagePicker';
import { PermissionsContext } from '@/contexts/PermissionsContext';

export default function ClientsListPage() {
  const { clients, loadClients, deleteClient } = useContext(ClientsContext);
  const router = useRouter();
  const [searchQuery, setSearchQuery] = useState('');
  const [loadingId, setLoadingId] = useState<number | null>(null);
  const { permissions, loading: permissionsLoading } = useContext(PermissionsContext);

  // Ejemplo de chequeo de permisos:
  const canAddClient = permissions.includes('addClient');
  const canDeleteClient = permissions.includes('deleteClient');

  useEffect(() => {
    loadClients();
  }, []);

  // ConfiguraciÃ³n de Fuse para bÃºsqueda en business_name, tax_id, email y address
  const fuse = new Fuse(clients, {
    keys: ['business_name', 'tax_id', 'email', 'address']
  });
  
  const filteredClients = useMemo(() => {
    if (!searchQuery) return clients;
    const results = fuse.search(searchQuery);
    return results.map(result => result.item);
  }, [searchQuery, clients]);

  const handleDelete = (id: number) => {
    Alert.alert(
      'Confirmar eliminaciÃ³n',
      'Â¿EstÃ¡s seguro de que deseas eliminar este cliente?',
      [
        { text: 'Cancelar', style: 'cancel' },
        {
          text: 'Eliminar',
          style: 'destructive',
          onPress: async () => {
            setLoadingId(id);
            await deleteClient(id);
            setLoadingId(null);
          },
        },
      ]
    );
  };
  const renderItem = ({ item }: { item: Client }) => (
    <TouchableOpacity style={styles.itemContainer} onLongPress={() => router.push(`./clients/${item.id}`)}>
      <CircleImagePicker fileId={item.brand_file_id} size={50} />
      <View style={styles.itemInfo}>
        <Text style={styles.itemTitle}>{item.business_name}</Text>
        <Text>{item.email}</Text>
      </View>
      {canDeleteClient && (
        <TouchableOpacity style={styles.deleteButton} onPress={() => handleDelete(item.id)}>
          {loadingId === item.id ? <ActivityIndicator /> : <Text style={styles.deleteText}>ðŸ—‘ï¸�</Text>}
        </TouchableOpacity>
      )}
    </TouchableOpacity>
  );

  return (
    <View style={styles.container}>
      <TextInput
        placeholder="Buscar cliente..."
        value={searchQuery}
        onChangeText={setSearchQuery}
        style={styles.searchInput}
      />
      <FlatList
        data={filteredClients}
        keyExtractor={(item) => item.id.toString()}
        renderItem={renderItem}
        ListEmptyComponent={<Text style={styles.emptyText}>No se encontraron clientes</Text>}
      />
      {canAddClient && (
        <TouchableOpacity style={styles.addButton} onPress={() => router.push('/clients/create')}>
          <Text style={styles.addButtonText}>âž• Agregar Cliente</Text>
        </TouchableOpacity>
      )}

    </View>
  );
}

const styles = StyleSheet.create({
  container: { flex: 1, padding: 16, backgroundColor: '#fff' },
  searchInput: {
    borderWidth: 1,
    borderColor: '#ccc',
    borderRadius: 8,
    paddingHorizontal: 12,
    paddingVertical: 8,
    marginBottom: 12,
  },
  itemContainer: {
    flexDirection: 'row',
    alignItems: 'center',
    paddingVertical: 8,
    borderBottomWidth: 1,
    borderColor: '#eee',
  },
  itemInfo: { flex: 1, marginLeft: 12 },
  itemTitle: { fontSize: 16, fontWeight: 'bold' },
  deleteButton: { padding: 8 },
  deleteText: { fontSize: 18 },
  addButton: {
    position: 'absolute',
    right: 16,
    bottom: 32,
    backgroundColor: '#007BFF',
    padding: 16,
    borderRadius: 50,
    alignItems: 'center',
    justifyContent: 'center',
  },
  addButtonText: { color: '#fff', fontSize: 16, fontWeight: 'bold' },
  emptyText: { textAlign: 'center', marginTop: 20, fontSize: 16 },
});

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\clients
File: [id].tsx
Content:
// /app/clients/[id].tsx
import { useRouter, useLocalSearchParams } from 'expo-router';
import React, { useState, useContext, useEffect } from 'react';
import { View, Text, TextInput, TouchableOpacity, StyleSheet, ScrollView, Alert, ActivityIndicator } from 'react-native';
import { ClientsContext, Client } from '@/contexts/ClientsContext';
import CircleImagePicker from '@/components/CircleImagePicker';
import { PermissionsContext } from '@/contexts/PermissionsContext';


export default function ClientDetailPage() {
  const { permissions } = useContext(PermissionsContext);
  const canEditClient = permissions.includes('updateClient');
  const canDeleteClient = permissions.includes('deleteClient');

  const router = useRouter();
  const { id } = useLocalSearchParams<{ id: string }>(); // Cambiado aquÃ­
  const clientId = Number(id);
  const { clients, updateClient, deleteClient } = useContext(ClientsContext);

  const client = clients.find(c => c.id === clientId);

  const [businessName, setBusinessName] = useState('');
  const [taxId, setTaxId] = useState('');
  const [email, setEmail] = useState('');
  const [phone, setPhone] = useState('');
  const [address, setAddress] = useState('');
  const [brandFileId, setBrandFileId] = useState<string | null>(null);
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    if (!canEditClient && !canDeleteClient) {
      Alert.alert('Acceso denegado', 'No tienes permiso para acceder a este cliente.');
      router.back();
    }
  }, [permissions]);

  useEffect(() => {
    if (client) {
      setBusinessName(client.business_name);
      setTaxId(client.tax_id);
      setEmail(client.email);
      setPhone(client.phone);
      setAddress(client.address);
      setBrandFileId(client.brand_file_id);
    }
  }, [client]);

  if (!client) {
    return (
      <View style={styles.container}>
        <Text>Cliente no encontrado</Text>
      </View>
    );
  }

  const handleUpdate = () => {
    /*if (!businessName || !taxId || !email) {
      Alert.alert('Error', 'Por favor ingresa Nombre de Negocio, Tax ID y Email');
      return;
    }*/
    Alert.alert(
      'Confirmar actualizaciÃ³n',
      'Â¿EstÃ¡s seguro de que deseas actualizar este cliente?',
      [
        { text: 'Cancelar', style: 'cancel' },
        {
          text: 'Actualizar',
          style: 'default',
          onPress: async () => {
            setLoading(true);
            const success = await updateClient(clientId, {
              business_name: businessName,
              tax_id: taxId,
              email,
              phone,
              address,
              brand_file_id: brandFileId,
            });
            setLoading(false);
            if (success) {
              Alert.alert('Ã‰xito', 'Cliente actualizado');
              router.back();
            } else {
              Alert.alert('Error', 'No se pudo actualizar el cliente');
            }
          },
        },
      ],
      { cancelable: false }
    );
  };
  

  const handleDelete = async () => {
    Alert.alert(
      'Confirmar eliminaciÃ³n',
      'Â¿EstÃ¡s seguro de eliminar este cliente?',
      [
        { text: 'Cancelar', style: 'cancel' },
        { text: 'Eliminar', style: 'destructive', onPress: async () => {
            setLoading(true);
            const success = await deleteClient(clientId);
            setLoading(false);
            if (success) {
              Alert.alert('Ã‰xito', 'Cliente eliminado');
              router.back();
            } else {
              Alert.alert('Error', 'No se pudo eliminar el cliente');
            }
          }
        },
      ]
    );
  };

  return (
    <ScrollView contentContainerStyle={styles.container}>
      <Text style={styles.label}>Imagen del Cliente</Text>
      <CircleImagePicker 
        fileId={brandFileId} 
        editable={true}
        size={200} 
        onImageChange={(newFileId) => setBrandFileId(newFileId)} 
      />

      <Text style={styles.label}>Nombre del Negocio</Text>
      <TextInput
        style={styles.input}
        placeholder="Nombre del negocio"
        value={businessName}
        onChangeText={setBusinessName}
      />

      <Text style={styles.label}>Tax ID</Text>
      <TextInput
        style={styles.input}
        placeholder="Tax ID"
        value={taxId}
        onChangeText={setTaxId}
      />

      <Text style={styles.label}>Email</Text>
      <TextInput
        style={styles.input}
        placeholder="Email"
        value={email}
        onChangeText={setEmail}
      />

      <Text style={styles.label}>TelÃ©fono</Text>
      <TextInput
        style={styles.input}
        placeholder="TelÃ©fono"
        value={phone}
        onChangeText={setPhone}
      />

      <Text style={styles.label}>DirecciÃ³n</Text>
      <TextInput
        style={styles.input}
        placeholder="DirecciÃ³n"
        value={address}
        onChangeText={setAddress}
      />
      {canEditClient && (
        <TouchableOpacity style={styles.submitButton} onPress={handleUpdate}>
          {loading ? <ActivityIndicator color="#fff" /> : <Text style={styles.submitButtonText}>Actualizar Cliente</Text>}
        </TouchableOpacity>
      )}

      {canDeleteClient && (
        <TouchableOpacity style={styles.deleteButton} onPress={handleDelete}>
          {loading ? <ActivityIndicator color="#fff" /> : <Text style={styles.deleteButtonText}>Eliminar Cliente</Text>}
        </TouchableOpacity>
      )}
    </ScrollView>
  );
}

const styles = StyleSheet.create({
  container: { padding: 16, backgroundColor: '#fff', flexGrow: 1 },
  label: { marginVertical: 8, fontSize: 16 },
  input: {
    borderWidth: 1,
    borderColor: '#ccc',
    borderRadius: 8,
    padding: 12,
    marginBottom: 8,
  },
  submitButton: {
    marginTop: 16,
    backgroundColor: '#007BFF',
    padding: 16,
    borderRadius: 8,
    alignItems: 'center',
  },
  submitButtonText: { color: '#fff', fontSize: 16, fontWeight: 'bold' },
  deleteButton: {
    marginTop: 16,
    backgroundColor: '#dc3545',
    padding: 16,
    borderRadius: 8,
    alignItems: 'center',
  },
  deleteButtonText: { color: '#fff', fontSize: 16, fontWeight: 'bold' },
});

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\clients
File: _layout.tsx
Content:
import React from 'react';
import { Stack } from 'expo-router';

export default function ClientsLayout() {
  return (
    <Stack>
      <Stack.Screen name="index" options={{ title: 'Clientes' }} />
      <Stack.Screen name="create" options={{ title: 'Nuevo Cliente' }} />
      <Stack.Screen name="[id]" options={{ title: 'Editar Cliente' }} />
    </Stack>
  );
}

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\folders
File: create.tsx
Content:
import React, { useState, useContext, useEffect } from 'react';
import { View, Text, TextInput, TouchableOpacity, StyleSheet, ScrollView, Alert } from 'react-native';
import { useRouter, useLocalSearchParams } from 'expo-router';
import { FoldersContext } from '@/contexts/FoldersContext';
import { PermissionsContext } from '@/contexts/PermissionsContext';
import CircleImagePicker from '@/components/CircleImagePicker';

export default function CreateFolderPage() {
  const router = useRouter();
  const { client_id, parent_id } = useLocalSearchParams<{ client_id?: string; parent_id?: string }>();
  const { permissions } = useContext(PermissionsContext);
  const { addFolder, folders } = useContext(FoldersContext);

  const parentId = parent_id ? Number(parent_id) : null;
  const folderParent = parentId ? folders.find(f => f.id === parentId) : null;
  const [clientId] = useState<number | null>(
    client_id ? Number(client_id) : folderParent ? folderParent.client_id : null
  );

  const [name, setName] = useState('');
  const [folderImageFileId, setFolderImageFileId] = useState<string | null>(null);
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    if (!permissions.includes('addFolder')) {
      Alert.alert('Acceso denegado', 'No tienes permiso para crear carpetas.');
      router.back();
    }
  }, [permissions]);

  const handleSubmit = async () => {
    if (!name || !clientId) {
      Alert.alert('Error', 'Faltan campos requeridos: nombre y cliente.');
      return;
    }
    setLoading(true);
    const success = await addFolder({
      name,
      client_id: clientId,
      parent_id: parentId,
      folder_image_file_id: folderImageFileId,
    });
    setLoading(false);
    if (success) {
      Alert.alert('Ã‰xito', 'Carpeta creada exitosamente');
      router.back();
    } else {
      Alert.alert('Error', 'No se pudo crear la carpeta');
    }
  };

  return (
    <ScrollView contentContainerStyle={styles.container}>
      <Text style={styles.label}>Imagen de la carpeta</Text>
      <CircleImagePicker fileId={folderImageFileId} editable={true} size={200} onImageChange={setFolderImageFileId} />

      <Text style={styles.label}>Nombre de la carpeta</Text>
      <TextInput style={styles.input} placeholder="Nombre" value={name} onChangeText={setName} />

      <TouchableOpacity style={styles.submitButton} onPress={handleSubmit} disabled={loading}>
        <Text style={styles.submitButtonText}>{loading ? 'Creando...' : 'Crear Carpeta'}</Text>
      </TouchableOpacity>
    </ScrollView>
  );
}

const styles = StyleSheet.create({
  container: { padding: 16, backgroundColor: '#fff' },
  label: { marginVertical: 8, fontSize: 16 },
  input: { borderWidth: 1, borderColor: '#ccc', borderRadius: 8, padding: 12, marginBottom: 8 },
  submitButton: { marginTop: 16, backgroundColor: '#28a745', padding: 16, borderRadius: 8, alignItems: 'center' },
  submitButtonText: { color: '#fff', fontSize: 16, fontWeight: 'bold' },
});

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\folders
File: index.tsx
Content:
// Archivo: app/folders/index.tsx

import React, { useContext, useEffect, useState, useMemo } from 'react';
import { View, FlatList, TextInput, TouchableOpacity, StyleSheet, Text, Alert, ActivityIndicator } from 'react-native';
import { useRouter, useLocalSearchParams } from 'expo-router';
import Fuse from 'fuse.js';
import CircleImagePicker from '@/components/CircleImagePicker';
import { FoldersContext, Folder } from '@/contexts/FoldersContext';
import { ClientsContext, Client } from '@/contexts/ClientsContext';
import { PermissionsContext } from '@/contexts/PermissionsContext';

export default function FoldersPage() {
  const { folders, loadFolders, deleteFolder } = useContext(FoldersContext);
  const { clients, loadClients } = useContext(ClientsContext);
  const { permissions } = useContext(PermissionsContext);
  const [searchQuery, setSearchQuery] = useState('');
  const [loadingId, setLoadingId] = useState<number | null>(null);
  const router = useRouter();
  const params = useLocalSearchParams();

  const client_id = params.client_id as string | undefined;
  const parent_id = params.parent_id as string | undefined;

  const canAddFolder = permissions.includes('addFolder');
  const canDeleteFolder = permissions.includes('deleteFolder');
  const canEditFolder = permissions.includes('updateFolder');

  useEffect(() => {
    loadFolders();
    loadClients();
  }, []);

  const currentFolders: Folder[] = useMemo(() => {
    if (parent_id) {
      return folders.filter(f => f.parent_id === Number(parent_id));
    } else if (client_id) {
      return folders.filter(f => f.client_id === Number(client_id) && f.parent_id === null);
    } else {
      return []; // no folders, show clients instead
    }
  }, [folders, client_id, parent_id]);

  const fuseFolders = new Fuse(currentFolders, { keys: ['name'] });
  const filteredFolders = searchQuery ? fuseFolders.search(searchQuery).map(r => r.item) : currentFolders;

  const fuseClients = new Fuse(clients, { keys: ['business_name', 'email', 'tax_id'] });
  const filteredClients = searchQuery ? fuseClients.search(searchQuery).map(r => r.item) : clients;

  const handleDelete = (id: number) => {
    Alert.alert('Confirmar eliminaciÃ³n', 'Â¿Seguro deseas eliminar la carpeta?', [
      { text: 'Cancelar', style: 'cancel' },
      {
        text: 'Eliminar',
        style: 'destructive',
        onPress: async () => {
          setLoadingId(id);
          await deleteFolder(id);
          setLoadingId(null);
        },
      },
    ]);
  };

  return (
    <View style={styles.container}>
      {(client_id || parent_id) && (
        <TouchableOpacity style={styles.backButton} onPress={() => {
          if (parent_id) {
            const parentFolder = folders.find(f => f.id === Number(parent_id));
            if (parentFolder?.parent_id) {
              router.push({ pathname: '/folders', params: { parent_id: String(parentFolder.parent_id) } });
            } else {
              router.push({ pathname: '/folders', params: { client_id: String(parentFolder?.client_id ?? '') } });
            }
          } else if (client_id) {
            router.push('/folders');
          }
        }}>
          <Text style={styles.backButtonText}>â†� Volver</Text>
        </TouchableOpacity>
      )}

      <TextInput
        placeholder="Buscar..."
        style={styles.search}
        value={searchQuery}
        onChangeText={setSearchQuery}
      />

      {client_id || parent_id ? (
        <FlatList
          data={filteredFolders}
          keyExtractor={(item) => item.id.toString()}
          renderItem={({ item }) => (
            <TouchableOpacity
              style={styles.item}
              onPress={() => router.push({ pathname: '/folders', params: { parent_id: String(item.id) } })}
              onLongPress={() => canEditFolder && router.push(`/folders/${item.id}`)}>
              <CircleImagePicker fileId={item.folder_image_file_id} size={50} />
              <Text style={styles.text}>{item.name}</Text>
              {canDeleteFolder && (
                <TouchableOpacity onPress={() => handleDelete(item.id)}>
                  {loadingId === item.id ? <ActivityIndicator /> : <Text style={styles.delete}>ðŸ—‘ï¸�</Text>}
                </TouchableOpacity>
              )}
            </TouchableOpacity>
          )}
        />
      ) : (
        <FlatList
          data={filteredClients}
          keyExtractor={(item) => item.id.toString()}
          renderItem={({ item }) => (
            <TouchableOpacity
              style={styles.item}
              onPress={() => router.push({ pathname: '/folders', params: { client_id: String(item.id) } })}>
              <CircleImagePicker fileId={item.brand_file_id} size={50} />
              <Text style={styles.text}>{item.business_name}</Text>
            </TouchableOpacity>
          )}
        />
      )}

      {canAddFolder && (client_id || parent_id) && (
        <TouchableOpacity
          style={styles.add}
          onPress={() => {
            const params: Record<string, string> = {};
            if (client_id) params.client_id = client_id;
            if (parent_id) params.parent_id = parent_id;
            router.push({ pathname: '/folders/create', params });
          }}>
          <Text style={styles.addText}>ï¼‹ Agregar carpeta</Text>
        </TouchableOpacity>
      )}
    </View>
  );
}

const styles = StyleSheet.create({
  container: { flex: 1, padding: 16 },
  search: { padding: 10, borderWidth: 1, borderRadius: 8, borderColor: '#ddd', marginBottom: 10 },
  item: { flexDirection: 'row', alignItems: 'center', padding: 10, borderBottomWidth: 1, borderColor: '#eee' },
  text: { flex: 1, marginLeft: 10 },
  delete: { fontSize: 18 },
  add: { position: 'absolute', right: 16, bottom: 32, backgroundColor: '#007BFF', padding: 16, borderRadius: 30 },
  addText: { color: '#fff', fontWeight: 'bold' },
  backButton: { marginBottom: 10, padding: 8, backgroundColor: '#eee', borderRadius: 8 },
  backButtonText: { fontSize: 16 },
}); 
---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\folders
File: [id].tsx
Content:
// Archivo: app/folders/[id].tsx

import { useRouter, useLocalSearchParams } from 'expo-router';
import React, { useContext, useEffect, useState, useMemo } from 'react';
import { View, Text, TextInput, TouchableOpacity, StyleSheet, ScrollView, Alert, ActivityIndicator, Modal, FlatList } from 'react-native';
import { FoldersContext, Folder } from '@/contexts/FoldersContext';
import { ClientsContext } from '@/contexts/ClientsContext';
import { PermissionsContext } from '@/contexts/PermissionsContext';
import CircleImagePicker from '@/components/CircleImagePicker';

export default function FolderDetailPage() {
  const router = useRouter();
  const { id } = useLocalSearchParams<{ id: string }>();
  const folderId = Number(id);
  const { folders, updateFolder, deleteFolder } = useContext(FoldersContext);
  const { clients } = useContext(ClientsContext);
  const { permissions } = useContext(PermissionsContext);

  const folder = folders.find(f => f.id === folderId);
  const [name, setName] = useState('');
  const [parentId, setParentId] = useState<number | null>(null);
  const [folderImageFileId, setFolderImageFileId] = useState<string | null>(null);
  const [selectingParent, setSelectingParent] = useState(false);
  const [loading, setLoading] = useState(false);

  const canEdit = permissions.includes('updateFolder');
  const canDelete = permissions.includes('deleteFolder');

  useEffect(() => {
    if (!canEdit && !canDelete) {
      Alert.alert('Acceso denegado', 'No tienes permiso para ver esta carpeta.');
      router.back();
    }
  }, [permissions]);

  useEffect(() => {
    if (folder) {
      setName(folder.name);
      setParentId(folder.parent_id);
      setFolderImageFileId(folder.folder_image_file_id);
    }
  }, [folder]);

  const clientName = clients.find(c => c.id === folder?.client_id)?.business_name || 'Cliente';

  const buildFolderTree = (parentId: number | null, level = 0): any[] => {
    return folders
      .filter(f => f.parent_id === parentId && f.client_id === folder?.client_id && f.id !== folderId)
      .sort((a, b) => a.name.localeCompare(b.name))
      .flatMap(f => [
        { ...f, level },
        ...buildFolderTree(f.id, level + 1)
      ]);
  };

  const getFolderPath = (id: number | null): string => {
    if (!id) return clientName;
    const stack: string[] = [];
    let current = folders.find(f => f.id === id);
    while (current) {
      stack.unshift(current.name);
      if (!current.parent_id) break;
      current = folders.find(f => f.id === current?.parent_id);
    }
    return `${clientName}/${stack.join('/')}`;
  };

  const handleUpdate = () => {
    if (!folder) return;
    Alert.alert('Actualizar', 'Â¿Actualizar esta carpeta?', [
      { text: 'Cancelar', style: 'cancel' },
      {
        text: 'Actualizar',
        onPress: async () => {
          setLoading(true);
          const success = await updateFolder(folderId, {
            name,
            client_id: folder.client_id,
            parent_id: parentId,
            folder_image_file_id: folderImageFileId,
          });
          setLoading(false);
          if (success) {
            Alert.alert('Actualizado', 'Carpeta actualizada correctamente');
            router.back();
          } else {
            Alert.alert('Error', 'No se pudo actualizar');
          }
        },
      },
    ]);
  };

  const handleDelete = () => {
    Alert.alert('Eliminar', 'Â¿Eliminar esta carpeta?', [
      { text: 'Cancelar', style: 'cancel' },
      {
        text: 'Eliminar',
        style: 'destructive',
        onPress: async () => {
          setLoading(true);
          const success = await deleteFolder(folderId);
          setLoading(false);
          if (success) {
            Alert.alert('Eliminado', 'Carpeta eliminada');
            router.back();
          } else {
            Alert.alert('Error', 'No se pudo eliminar');
          }
        },
      },
    ]);
  };

  const folderTree = [{ id: null, name: clientName, level: 0 }, ...buildFolderTree(null, 1)];

  if (!folder)
    return (
      <View style={styles.container}>
        <Text>Carpeta no encontrada</Text>
      </View>
    );

  return (
    <ScrollView contentContainerStyle={styles.container}>
      <Text style={styles.label}>Imagen de la carpeta</Text>
      <CircleImagePicker fileId={folderImageFileId} editable={true} size={200} onImageChange={setFolderImageFileId} />

      <Text style={styles.label}>Nombre de la carpeta</Text>
      <TextInput style={styles.input} value={name} onChangeText={setName} />

      <Text style={styles.label}>UbicaciÃ³n</Text>
      <TouchableOpacity style={styles.input} onPress={() => setSelectingParent(true)}>
        <Text>{getFolderPath(parentId)}</Text>
      </TouchableOpacity>

      <Modal visible={selectingParent} animationType="slide">
        <View style={styles.modalContainer}>
          <Text style={styles.label}>Selecciona carpeta padre</Text>
          <FlatList
            data={folderTree}
            keyExtractor={(item) => `folder-${item.id}`}
            renderItem={({ item }) => (
              <TouchableOpacity
                style={[styles.item, item.id === null && { backgroundColor: '#eee' }]}
                onPress={() => {
                  setParentId(item.id);
                  setSelectingParent(false);
                }}>
                <Text>{'     '.repeat(item.level)}{item.id === null ? clientName : `â”€ ${item.name}`}</Text>
              </TouchableOpacity>
            )}
          />
          <TouchableOpacity onPress={() => setSelectingParent(false)} style={styles.cancelButton}>
            <Text style={styles.cancelText}>Cancelar</Text>
          </TouchableOpacity>
        </View>
      </Modal>

      {canEdit && (
        <TouchableOpacity style={styles.submitButton} onPress={handleUpdate}>
          {loading ? <ActivityIndicator color="#fff" /> : <Text style={styles.submitButtonText}>Actualizar Carpeta</Text>}
        </TouchableOpacity>
      )}

      {canDelete && (
        <TouchableOpacity style={styles.deleteButton} onPress={handleDelete}>
          {loading ? <ActivityIndicator color="#fff" /> : <Text style={styles.deleteButtonText}>Eliminar Carpeta</Text>}
        </TouchableOpacity>
      )}
    </ScrollView>
  );
}

const styles = StyleSheet.create({
  container: { padding: 16, backgroundColor: '#fff', flexGrow: 1 },
  label: { marginVertical: 8, fontSize: 16 },
  input: { borderWidth: 1, borderColor: '#ccc', borderRadius: 8, padding: 12, marginBottom: 8 },
  submitButton: { marginTop: 16, backgroundColor: '#007BFF', padding: 16, borderRadius: 8, alignItems: 'center' },
  submitButtonText: { color: '#fff', fontSize: 16, fontWeight: 'bold' },
  deleteButton: { marginTop: 16, backgroundColor: '#dc3545', padding: 16, borderRadius: 8, alignItems: 'center' },
  deleteButtonText: { color: '#fff', fontSize: 16, fontWeight: 'bold' },
  modalContainer: { flex: 1, padding: 16, backgroundColor: '#fff' },
  item: { padding: 12, borderBottomWidth: 1, borderColor: '#ddd' },
  cancelButton: { marginTop: 20, padding: 12, backgroundColor: '#ccc', borderRadius: 8, alignItems: 'center' },
  cancelText: { fontWeight: 'bold' },
});

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\folders
File: _layout.tsx
Content:
import React from 'react';
import { Stack } from 'expo-router';

export default function FoldersLayout() {
  return (
    <Stack>
      <Stack.Screen name="index" options={{ title: 'Carpetas' }} />
      <Stack.Screen name="create" options={{ title: 'Nuevo Carpeta' }} />
      <Stack.Screen name="[id]" options={{ title: 'Editar Carpeta' }} />
    </Stack>
  );
}

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\jobs
File: create.tsx
Content:
// C:/Users/Mauri/Documents/GitHub/router/app/jobs/create.tsx
import React, { useState, useContext, useEffect, useMemo } from 'react';
import {
  Text,
  TextInput,
  TouchableOpacity,
  Alert,
  StyleSheet,
  ScrollView,
  Platform,
  View
} from 'react-native';
import { useRouter } from 'expo-router';
import DateTimePicker from '@react-native-community/datetimepicker';
import { Picker } from '@react-native-picker/picker';

import { JobsContext } from '@/contexts/JobsContext';
import { PermissionsContext } from '@/contexts/PermissionsContext';
import { ClientsContext } from '@/contexts/ClientsContext';
import { FoldersContext } from '@/contexts/FoldersContext';
import { ProductsServicesContext } from '@/contexts/ProductsServicesContext';
import { StatusesContext, Status } from '@/contexts/StatusesContext';
import { ModalPicker, ModalPickerItem } from '@/components/ModalPicker';

export default function CreateJobScreen() {
  const router = useRouter();
  const { addJob } = useContext(JobsContext);
  const { permissions } = useContext(PermissionsContext);
  const { clients } = useContext(ClientsContext);
  const { folders } = useContext(FoldersContext);
  const { productsServices } = useContext(ProductsServicesContext);
  const { statuses, loadStatuses } = useContext(StatusesContext);

  // Estados para Cliente, Folder, Producto/Servicio
  const [selectedClient, setSelectedClient] = useState<number | null>(null);
  const [selectedFolder, setSelectedFolder] = useState<number | null>(null);
  const [selectedProduct, setSelectedProduct] = useState<number | null>(null);
  // Para el estado, guardamos el objeto completo del tipo ModalPickerItem
  const [selectedStatus, setSelectedStatus] = useState<ModalPickerItem | null>(null);

  const [typeOfWork, setTypeOfWork] = useState<string>('');
  const [description, setDescription] = useState<string>('');
  const [multiplicativeValue, setMultiplicativeValue] = useState<string>('1.00');
  const [attachedFiles, setAttachedFiles] = useState<string>('');

  // Estados de fecha para inicio y fin
  const [startDate, setStartDate] = useState<Date | null>(null);
  const [endDate, setEndDate] = useState<Date | null>(null);

  // Estados para controlar los pickers de fecha/hora
  const [startPickerShow, setStartPickerShow] = useState<boolean>(false);
  const [startPickerMode, setStartPickerMode] = useState<'date' | 'time'>('date');
  const [endPickerShow, setEndPickerShow] = useState<boolean>(false);
  const [endPickerMode, setEndPickerMode] = useState<'date' | 'time'>('date');

  // Estado de carga
  const [loading, setLoading] = useState<boolean>(false);

  useEffect(() => {
    if (!permissions.includes('addJob')) {
      Alert.alert('Acceso denegado', 'No tienes permiso para agregar trabajos.');
      router.back();
    }
    // Cargamos los estados dinÃ¡micos
    loadStatuses();
  }, [permissions]);

  // Filtrado de carpetas segÃºn el cliente seleccionado
  const filteredFolders = folders.filter(f => {
    if (!selectedClient) return false;
    return f.client_id === selectedClient;
  });

  /**
   * Formatea la fecha a 'YYYY-MM-DD HH:mm:ss'
   */
  const formatDateTime = (date: Date): string => {
    const pad = (n: number) => (n < 10 ? '0' + n : n);
    return `${date.getFullYear()}-${pad(date.getMonth() + 1)}-${pad(date.getDate())} ${pad(date.getHours())}:${pad(date.getMinutes())}:${pad(date.getSeconds())}`;
  };

  /**
   * Formatea solo la hora a 'HH:mm:ss'
   */
  const formatTime = (date: Date): string => {
    const pad = (n: number) => (n < 10 ? '0' + n : n);
    return `${pad(date.getHours())}:${pad(date.getMinutes())}:${pad(date.getSeconds())}`;
  };

  // Funciones para el picker de inicio
  const showStartDatepicker = () => {
    setStartPickerMode('date');
    setStartPickerShow(true);
  };
  const showStartTimepicker = () => {
    setStartPickerMode('time');
    setStartPickerShow(true);
  };
  const onChangeStartPicker = (event: any, selectedDate?: Date) => {
    setStartPickerShow(false);
    if (selectedDate) {
      if (startPickerMode === 'date') {
        let hour: number, minute: number, second: number;
        if (startDate) {
          if (startDate.getHours() === 0 && startDate.getMinutes() === 0 && startDate.getSeconds() === 0) {
            const now = new Date();
            hour = now.getHours();
            minute = now.getMinutes();
            second = now.getSeconds();
          } else {
            hour = startDate.getHours();
            minute = startDate.getMinutes();
            second = startDate.getSeconds();
          }
        } else {
          const now = new Date();
          hour = now.getHours();
          minute = now.getMinutes();
          second = now.getSeconds();
        }
        const newDate = new Date(
          selectedDate.getFullYear(),
          selectedDate.getMonth(),
          selectedDate.getDate(),
          hour,
          minute,
          second
        );
        setStartDate(newDate);
      } else {
        if (startDate) {
          const newDate = new Date(
            startDate.getFullYear(),
            startDate.getMonth(),
            startDate.getDate(),
            selectedDate.getHours(),
            selectedDate.getMinutes(),
            selectedDate.getSeconds()
          );
          setStartDate(newDate);
        } else {
          const today = new Date();
          setStartDate(new Date(
            today.getFullYear(),
            today.getMonth(),
            today.getDate(),
            selectedDate.getHours(),
            selectedDate.getMinutes(),
            selectedDate.getSeconds()
          ));
        }
      }
    }
  };

  // Funciones para el picker de fin
  const showEndDatepicker = () => {
    setEndPickerMode('date');
    setEndPickerShow(true);
  };
  const showEndTimepicker = () => {
    setEndPickerMode('time');
    setEndPickerShow(true);
  };
  const onChangeEndPicker = (event: any, selectedDate?: Date) => {
    setEndPickerShow(false);
    if (selectedDate) {
      if (endPickerMode === 'date') {
        let hour: number, minute: number, second: number;
        if (endDate) {
          if (endDate.getHours() === 0 && endDate.getMinutes() === 0 && endDate.getSeconds() === 0) {
            const now = new Date();
            hour = now.getHours();
            minute = now.getMinutes();
            second = now.getSeconds();
          } else {
            hour = endDate.getHours();
            minute = endDate.getMinutes();
            second = endDate.getSeconds();
          }
        } else {
          const now = new Date();
          hour = now.getHours();
          minute = now.getMinutes();
          second = now.getSeconds();
        }
        const newDate = new Date(
          selectedDate.getFullYear(),
          selectedDate.getMonth(),
          selectedDate.getDate(),
          hour,
          minute,
          second
        );
        setEndDate(newDate);
      } else {
        if (endDate) {
          const newDate = new Date(
            endDate.getFullYear(),
            endDate.getMonth(),
            endDate.getDate(),
            selectedDate.getHours(),
            selectedDate.getMinutes(),
            selectedDate.getSeconds()
          );
          setEndDate(newDate);
        } else {
          const today = new Date();
          setEndDate(new Date(
            today.getFullYear(),
            today.getMonth(),
            today.getDate(),
            selectedDate.getHours(),
            selectedDate.getMinutes(),
            selectedDate.getSeconds()
          ));
        }
      }
    }
  };

  // Botones para limpiar fechas
  const clearStartDateTime = () => setStartDate(null);
  const clearEndDateTime = () => setEndDate(null);

  // Preparar los Ã­tems para el ModalPicker de Estados
  const statusItems: ModalPickerItem[] = useMemo(() => {
    return statuses.map((s: Status) => ({
      id: s.id,
      name: s.label,
      backgroundColor: s.background_color,
    }));
  }, [statuses]);

  // FunciÃ³n para enviar el formulario
  const handleSubmit = async () => {
    if (!selectedClient || selectedStatus === null) {
      Alert.alert('Error', 'Por favor completa los campos obligatorios (Cliente y Estado).');
      return;
    }
    const startDatetime = startDate ? formatDateTime(startDate) : null;
    const endDatetime = endDate ? formatDateTime(endDate) : null;

    setLoading(true);
    const job = await addJob({
      client_id: selectedClient,
      product_service_id: selectedProduct || null,
      folder_id: selectedFolder || null,
      type_of_work: typeOfWork,
      description,
      // Se envÃ­a el id del estado como string
      status: selectedStatus.id.toString(),
      start_datetime: startDatetime,
      end_datetime: endDatetime,
      multiplicative_value: parseFloat(multiplicativeValue || '1.0'),
      attached_files: attachedFiles || null,
    });
    setLoading(false);

    if (job) {
      Alert.alert('Ã‰xito', 'Trabajo creado con Ã©xito.');
      router.back();
    } else {
      Alert.alert('Error', 'No se pudo crear el trabajo.');
    }
  };

  return (
    <ScrollView contentContainerStyle={styles.container}>

      {/* ESTADO - ModalPicker con fondo coloreado */}
      <Text style={styles.label}>Estado</Text>
      <View style={styles.pickerContainer}>
        <ModalPicker
          items={statusItems}
          selectedItem={selectedStatus}
          onSelect={(item: ModalPickerItem) => setSelectedStatus(item)}
          placeholder="-- Selecciona un Estado --"
        />
      </View>

      {/* TIPO DE TRABAJO */}
      <Text style={styles.label}>Tipo de trabajo</Text>
      <TextInput
        style={styles.input}
        placeholder="Ej: ReparaciÃ³n de equipo, etc."
        value={typeOfWork}
        onChangeText={setTypeOfWork}
      />

      {/* DESCRIPCIÃ“N */}
      <Text style={styles.label}>DescripciÃ³n</Text>
      <TextInput
        style={[styles.input, { height: 80 }]}
        value={description}
        multiline
        onChangeText={setDescription}
        placeholder="Describe este trabajo"
      />

      {/* CLIENTE */}
      <Text style={styles.label}>Cliente *</Text>
      <View style={styles.pickerContainer}>
        <Picker
          selectedValue={selectedClient}
          onValueChange={(itemValue) => setSelectedClient(itemValue)}
          style={styles.picker}
        >
          <Picker.Item label="-- Selecciona un Cliente --" value={null} />
          {clients.map(client => (
            <Picker.Item key={client.id} label={client.business_name} value={client.id} />
          ))}
        </Picker>
      </View>

      {/* FOLDER */}
      <Text style={styles.label}>Carpeta</Text>
      <View style={styles.pickerContainer}>
        <Picker
          selectedValue={selectedFolder}
          onValueChange={(itemValue) => setSelectedFolder(itemValue)}
          style={styles.picker}
          enabled={!!selectedClient}
        >
          <Picker.Item label="-- Sin carpeta --" value={null} />
          {filteredFolders.map(folder => (
            <Picker.Item key={folder.id} label={folder.name} value={folder.id} />
          ))}
        </Picker>
      </View>

      {/* PRODUCTO/SERVICIO */}
      <Text style={styles.label}>Producto/Servicio</Text>
      <View style={styles.pickerContainer}>
        <Picker
          selectedValue={selectedProduct}
          onValueChange={(itemValue) => setSelectedProduct(itemValue)}
          style={styles.picker}
        >
          <Picker.Item label="-- Ninguno --" value={null} />
          {productsServices.map(ps => (
            <Picker.Item key={ps.id} label={ps.description} value={ps.id} />
          ))}
        </Picker>
      </View>

      {/* FECHAS Y HORAS - INICIO */}
      <Text style={styles.label}>Fecha de Inicio</Text>
      <TouchableOpacity style={[styles.dateButton, { marginBottom: 6 }]} onPress={showStartDatepicker}>
        <Text style={styles.dateButtonText}>
          {startDate ? startDate.toLocaleDateString() : 'Seleccionar Fecha'}
        </Text>
      </TouchableOpacity>
      <Text style={styles.label}>Hora de Inicio</Text>
      <TouchableOpacity style={[styles.dateButton, { marginBottom: 6 }]} onPress={showStartTimepicker}>
        <Text style={styles.dateButtonText}>
          {startDate ? formatTime(startDate) : 'Seleccionar Hora'}
        </Text>
      </TouchableOpacity>
      {startPickerShow && (
        <DateTimePicker
          value={startDate || new Date()}
          mode={startPickerMode}
          display={Platform.OS === 'ios' ? 'spinner' : 'default'}
          is24Hour
          onChange={onChangeStartPicker}
        />
      )}
      {startDate && (
        <TouchableOpacity style={styles.clearButton} onPress={clearStartDateTime}>
          <Text style={styles.clearButtonText}>Eliminar fecha/hora de Inicio</Text>
        </TouchableOpacity>
      )}

      {/* FECHAS Y HORAS - FIN */}
      <Text style={styles.label}>Fecha de Fin</Text>
      <TouchableOpacity style={[styles.dateButton, { marginBottom: 6 }]} onPress={showEndDatepicker}>
        <Text style={styles.dateButtonText}>
          {endDate ? endDate.toLocaleDateString() : 'Seleccionar Fecha'}
        </Text>
      </TouchableOpacity>
      <Text style={styles.label}>Hora de Fin</Text>
      <TouchableOpacity style={[styles.dateButton, { marginBottom: 6 }]} onPress={showEndTimepicker}>
        <Text style={styles.dateButtonText}>
          {endDate ? formatTime(endDate) : 'Seleccionar Hora'}
        </Text>
      </TouchableOpacity>
      {endPickerShow && (
        <DateTimePicker
          value={endDate || new Date()}
          mode={endPickerMode}
          display={Platform.OS === 'ios' ? 'spinner' : 'default'}
          is24Hour
          onChange={onChangeEndPicker}
        />
      )}
      {endDate && (
        <TouchableOpacity style={styles.clearButton} onPress={clearEndDateTime}>
          <Text style={styles.clearButtonText}>Eliminar fecha/hora de Fin</Text>
        </TouchableOpacity>
      )}

      {/* VALOR MULTIPLICADOR */}
      <Text style={styles.label}>Valor multiplicador</Text>
      <TextInput
        style={styles.input}
        keyboardType="decimal-pad"
        value={multiplicativeValue}
        onChangeText={setMultiplicativeValue}
      />

      {/* ARCHIVOS ADJUNTOS */}
      <Text style={styles.label}>Archivos adjuntos (URL o texto)</Text>
      <TextInput
        style={styles.input}
        value={attachedFiles}
        onChangeText={setAttachedFiles}
        placeholder="Ej: https://archivo.pdf"
      />

      {/* BOTÃ“N CREAR */}
      <TouchableOpacity style={styles.submitButton} onPress={handleSubmit} disabled={loading}>
        <Text style={styles.submitButtonText}>
          {loading ? 'Creando...' : 'Crear Trabajo'}
        </Text>
      </TouchableOpacity>
    </ScrollView>
  );
}

const styles = StyleSheet.create({
  container: { padding: 16, backgroundColor: '#fff' },
  label: { marginTop: 12, fontSize: 16, fontWeight: '600' },
  pickerContainer: {
    borderWidth: 1,
    borderColor: '#ccc',
    borderRadius: 8,
    marginTop: 4,
    marginBottom: 8,
  },
  picker: { height: 60, width: '100%' },
  input: {
    borderWidth: 1,
    borderColor: '#ccc',
    borderRadius: 8,
    padding: 12,
    marginTop: 4,
    marginBottom: 8,
    backgroundColor: '#fff'
  },
  dateButton: {
    borderWidth: 1,
    borderColor: '#ccc',
    borderRadius: 8,
    padding: 12,
    marginBottom: 8,
  },
  dateButtonText: { color: '#555' },
  submitButton: {
    marginTop: 20,
    backgroundColor: '#28a745',
    padding: 16,
    borderRadius: 8,
    alignItems: 'center'
  },
  submitButtonText: { color: '#fff', fontSize: 16, fontWeight: 'bold' },
  clearButton: {
    backgroundColor: '#dc3545',
    padding: 12,
    borderRadius: 8,
    alignItems: 'center',
    marginVertical: 8
  },
  clearButtonText: { color: '#fff', fontSize: 14, fontWeight: 'bold' },
});

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\jobs
File: index.tsx
Content:
// C:/Users/Mauri/Documents/GitHub/router/app/jobs/index.tsx
import React, { useContext, useEffect, useState, useMemo } from 'react';
import { View, Text, FlatList, TouchableOpacity, TextInput, StyleSheet, ActivityIndicator, Alert } from 'react-native';
import { useRouter } from 'expo-router';
import Fuse from 'fuse.js';
import { JobsContext, Job } from '@/contexts/JobsContext';
import { PermissionsContext } from '@/contexts/PermissionsContext';
// Importamos el contexto de estados para poder buscar el color y label correspondiente
import { StatusesContext, Status } from '@/contexts/StatusesContext';

export default function JobsScreen() {
  const { jobs, loadJobs, deleteJob } = useContext(JobsContext);
  const { permissions } = useContext(PermissionsContext);
  const { statuses } = useContext(StatusesContext);
  const router = useRouter();
  const [search, setSearch] = useState('');
  const [loadingId, setLoadingId] = useState<number | null>(null);

  useEffect(() => {
    if (!permissions.includes('listJobs')) {
      Alert.alert('Acceso denegado', 'No tienes permiso para ver trabajos.');
      router.back();
    } else {
      loadJobs();
    }
  }, [permissions]);

  const fuse = new Fuse(jobs, { keys: ['description', 'type_of_work', 'status'] });
  const filteredJobs = useMemo(() => {
    if (!search) return jobs;
    const result = fuse.search(search);
    return result.map(r => r.item);
  }, [search, jobs]);

  // FunciÃ³n para buscar el objeto status que corresponda al trabajo
  const getJobStatus = (job: Job): Status | undefined => {
    // Convertimos el valor de job.status a nÃºmero y lo buscamos en el array statuses.
    return statuses.find(s => s.id === parseInt(job.status));
  };

  const handleDelete = (id: number) => {
    Alert.alert('Eliminar trabajo', 'Â¿EstÃ¡s seguro?', [
      { text: 'Cancelar', style: 'cancel' },
      {
        text: 'Eliminar', style: 'destructive', onPress: async () => {
          setLoadingId(id);
          const success = await deleteJob(id);
          setLoadingId(null);
          if (!success)
            Alert.alert('Error', 'No se pudo eliminar el trabajo.');
        }
      }
    ]);
  };

  const renderItem = ({ item }: { item: Job }) => {
    const jobStatus = getJobStatus(item);

    return (
      <TouchableOpacity
        style={styles.itemContainer}
        onLongPress={() => router.push(`./jobs/${item.id}`)}
      >
        <View style={styles.itemContent}>
          <Text style={styles.title}>{item.type_of_work}</Text>
          <Text style={styles.description}>{item.description}</Text>
          {/* Se crea un recuadro para el estado: se pinta el background con el color obtenido y se muestra el label debajo */}
          {jobStatus ? (
            <View style={[styles.statusContainer, { backgroundColor: jobStatus.background_color }]}>
              <Text style={styles.statusLabel}>{jobStatus.label}</Text>
            </View>
          ) : (
            <Text style={styles.statusFallback}>Estado: {item.status}</Text>
          )}
        </View>
        <TouchableOpacity onPress={() => handleDelete(item.id)}>
          {loadingId === item.id ? (
            <ActivityIndicator color="#fff" />
          ) : (
            <Text style={styles.trash}>ðŸ—‘ï¸�</Text>
          )}
        </TouchableOpacity>
      </TouchableOpacity>
    );
  };

  return (
    <View style={styles.container}>
      <TextInput
        style={styles.search}
        value={search}
        onChangeText={setSearch}
        placeholder="Buscar trabajo..."
      />
      <FlatList
        data={filteredJobs}
        keyExtractor={(item) => item.id.toString()}
        renderItem={renderItem}
        ListEmptyComponent={<Text style={styles.empty}>No hay trabajos cargados</Text>}
      />
      <TouchableOpacity style={styles.addButton} onPress={() => router.push('/jobs/create')}>
        <Text style={styles.addText}>âž• Nuevo Trabajo</Text>
      </TouchableOpacity>
    </View>
  );
}

const styles = StyleSheet.create({
  container: { flex: 1, padding: 16, backgroundColor: '#fff' },
  search: { borderWidth: 1, borderColor: '#ccc', borderRadius: 8, padding: 12, marginBottom: 10 },
  itemContainer: { 
    flexDirection: 'row', 
    alignItems: 'center', 
    justifyContent: 'space-between', 
    borderBottomWidth: 1, 
    borderColor: '#eee', 
    paddingVertical: 12 
  },
  itemContent: { flex: 1, marginRight: 10 },
  title: { fontWeight: 'bold', fontSize: 16 },
  description: { fontSize: 14, color: '#555', marginVertical: 4 },
  statusContainer: {
    marginTop: 4,
    paddingVertical: 4,
    paddingHorizontal: 8,
    borderRadius: 4,
    alignSelf: 'flex-start'
  },
  statusLabel: { color: '#fff', fontSize: 12, fontWeight: 'bold' },
  statusFallback: { fontSize: 12, color: '#888', marginTop: 4 },
  trash: { fontSize: 18, color: 'red', paddingHorizontal: 12 },
  addButton: { 
    backgroundColor: '#007BFF', 
    padding: 16, 
    borderRadius: 30, 
    position: 'absolute', 
    right: 16, 
    bottom: 32, 
    alignItems: 'center'
  },
  addText: { color: '#fff', fontWeight: 'bold', fontSize: 16 },
  empty: { marginTop: 20, textAlign: 'center', fontSize: 16 },
});

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\jobs
File: output.txt
Content:
Folder: C:/Users/Mauri/Documents/GitHub/router/app/jobs
File: create.tsx
Content:
// C:/Users/Mauri/Documents/GitHub/router/app/jobs/create.tsx
import React, { useState, useContext, useEffect } from 'react';
import { View, Text, TextInput, TouchableOpacity, Alert, StyleSheet, ScrollView, Platform } from 'react-native';
import { useRouter } from 'expo-router';
import DateTimePicker from '@react-native-community/datetimepicker';
import { Picker } from '@react-native-picker/picker'; 
import { JobsContext } from '@/contexts/JobsContext';
import { PermissionsContext } from '@/contexts/PermissionsContext';
import { ClientsContext } from '@/contexts/ClientsContext';
import { FoldersContext } from '@/contexts/FoldersContext';
import { ProductsServicesContext } from '@/contexts/ProductsServicesContext';

export default function CreateJobScreen() {
  const router = useRouter();
  const { addJob } = useContext(JobsContext);
  const { permissions } = useContext(PermissionsContext);
  const { clients } = useContext(ClientsContext);
  const { folders } = useContext(FoldersContext);
  const { productsServices } = useContext(ProductsServicesContext);

  // Opciones de estado predefinidas
  const STATUS_OPTIONS = [
    { label: 'Pendiente', value: 'Pendiente' },
    { label: 'En progreso', value: 'En progreso' },
    { label: 'Completado', value: 'Completado' },
    { label: 'Cancelado', value: 'Cancelado' },
  ];

  // Estados del formulario
  const [selectedClient, setSelectedClient] = useState<number | null>(null);
  const [selectedFolder, setSelectedFolder] = useState<number | null>(null);
  const [selectedProduct, setSelectedProduct] = useState<number | null>(null);
  const [status, setStatus] = useState<string>('Pendiente');
  const [typeOfWork, setTypeOfWork] = useState<string>('');
  const [description, setDescription] = useState<string>('');
  const [multiplicativeValue, setMultiplicativeValue] = useState<string>('1.00');
  const [attachedFiles, setAttachedFiles] = useState<string>('');
  
  // Estados de fecha para inicio y fin (almacenan el objeto Date)
  const [startDate, setStartDate] = useState<Date | null>(null);
  const [endDate, setEndDate] = useState<Date | null>(null);

  // Estados para controlar la visibilidad y modo de los pickers (fecha o hora) para inicio
  const [startPickerShow, setStartPickerShow] = useState<boolean>(false);
  const [startPickerMode, setStartPickerMode] = useState<'date' | 'time'>('date');

  // Estados para controlar la visibilidad y modo de los pickers (fecha o hora) para fin
  const [endPickerShow, setEndPickerShow] = useState<boolean>(false);
  const [endPickerMode, setEndPickerMode] = useState<'date' | 'time'>('date');

  // Estado de carga
  const [loading, setLoading] = useState<boolean>(false);

  useEffect(() => {
    if (!permissions.includes('addJob')) {
      Alert.alert('Acceso denegado', 'No tienes permiso para agregar trabajos.');
      router.back();
    }
  }, [permissions]);

  // Filtra las carpetas segÃƒÂºn el cliente seleccionado
  const filteredFolders = folders.filter(f => {
    if (!selectedClient) return false;
    return f.client_id === selectedClient;
  });

  /**
   * FunciÃƒÂ³n auxiliar que formatea la fecha a 'YYYY-MM-DD HH:mm:ss'
   */
  const formatDateTime = (date: Date): string => {
    const pad = (n: number) => (n < 10 ? '0' + n : n);
    const year = date.getFullYear();
    const month = pad(date.getMonth() + 1);
    const day = pad(date.getDate());
    const hour = pad(date.getHours());
    const minutes = pad(date.getMinutes());
    const seconds = pad(date.getSeconds());
    return `${year}-${month}-${day} ${hour}:${minutes}:${seconds}`;
  };

  /**
   * FunciÃƒÂ³n auxiliar que formatea solo la hora en formato HH:mm:ss
   */
  const formatTime = (date: Date): string => {
    const pad = (n: number) => (n < 10 ? '0' + n : n);
    const hour = pad(date.getHours());
    const minutes = pad(date.getMinutes());
    const seconds = pad(date.getSeconds());
    return `${hour}:${minutes}:${seconds}`;
  };

  // Funciones para mostrar el picker de fecha y hora de inicio
  const showStartDatepicker = () => {
    setStartPickerMode('date');
    setStartPickerShow(true);
  };

  const showStartTimepicker = () => {
    setStartPickerMode('time');
    setStartPickerShow(true);
  };

  // FunciÃƒÂ³n onChange para el picker de inicio
  const onChangeStartPicker = (event: any, selectedDate?: Date) => {
    setStartPickerShow(false);
    if (selectedDate) {
      if (startPickerMode === 'date') {
        // Si se selecciona la fecha, usar la hora actual si es que la hora es 00:00
        let hour: number, minute: number, second: number;
        if (startDate) {
          if (startDate.getHours() === 0 && startDate.getMinutes() === 0 && startDate.getSeconds() === 0) {
            const now = new Date();
            hour = now.getHours();
            minute = now.getMinutes();
            second = now.getSeconds();
          } else {
            hour = startDate.getHours();
            minute = startDate.getMinutes();
            second = startDate.getSeconds();
          }
        } else {
          const now = new Date();
          hour = now.getHours();
          minute = now.getMinutes();
          second = now.getSeconds();
        }
        const newDate = new Date(
          selectedDate.getFullYear(),
          selectedDate.getMonth(),
          selectedDate.getDate(),
          hour,
          minute,
          second
        );
        setStartDate(newDate);
      } else { // modo "time"
        if (startDate) {
          const newDate = new Date(
            startDate.getFullYear(),
            startDate.getMonth(),
            startDate.getDate(),
            selectedDate.getHours(),
            selectedDate.getMinutes(),
            selectedDate.getSeconds()
          );
          setStartDate(newDate);
        } else {
          const today = new Date();
          setStartDate(new Date(
            today.getFullYear(),
            today.getMonth(),
            today.getDate(),
            selectedDate.getHours(),
            selectedDate.getMinutes(),
            selectedDate.getSeconds()
          ));
        }
      }
    }
  };

  // Funciones para mostrar el picker de fecha y hora de fin
  const showEndDatepicker = () => {
    setEndPickerMode('date');
    setEndPickerShow(true);
  };

  const showEndTimepicker = () => {
    setEndPickerMode('time');
    setEndPickerShow(true);
  };

  // FunciÃƒÂ³n onChange para el picker de fin
  const onChangeEndPicker = (event: any, selectedDate?: Date) => {
    setEndPickerShow(false);
    if (selectedDate) {
      if (endPickerMode === 'date') {
        // Si se selecciona la fecha, usar la hora actual si es que la hora es 00:00
        let hour: number, minute: number, second: number;
        if (endDate) {
          if (endDate.getHours() === 0 && endDate.getMinutes() === 0 && endDate.getSeconds() === 0) {
            const now = new Date();
            hour = now.getHours();
            minute = now.getMinutes();
            second = now.getSeconds();
          } else {
            hour = endDate.getHours();
            minute = endDate.getMinutes();
            second = endDate.getSeconds();
          }
        } else {
          const now = new Date();
          hour = now.getHours();
          minute = now.getMinutes();
          second = now.getSeconds();
        }
        const newDate = new Date(
          selectedDate.getFullYear(),
          selectedDate.getMonth(),
          selectedDate.getDate(),
          hour,
          minute,
          second
        );
        setEndDate(newDate);
      } else { // modo "time"
        if (endDate) {
          const newDate = new Date(
            endDate.getFullYear(),
            endDate.getMonth(),
            endDate.getDate(),
            selectedDate.getHours(),
            selectedDate.getMinutes(),
            selectedDate.getSeconds()
          );
          setEndDate(newDate);
        } else {
          const today = new Date();
          setEndDate(new Date(
            today.getFullYear(),
            today.getMonth(),
            today.getDate(),
            selectedDate.getHours(),
            selectedDate.getMinutes(),
            selectedDate.getSeconds()
          ));
        }
      }
    }
  };

  // Botones adicionales para eliminar fecha y hora
  const clearStartDateTime = () => {
    setStartDate(null);
  };

  const clearEndDateTime = () => {
    setEndDate(null);
  };

  // Al confirmar envÃƒÂ­o:
  const handleSubmit = async () => {
    // Validamos lo mÃƒÂ­nimo
    if (!selectedClient /*|| !typeOfWork || !description || !status*/) {
      Alert.alert('Error', 'Por favor completa los campos obligatorios (Cliente).');
      return;
    }
    // ConversiÃƒÂ³n a string con formato MySQL para fechas, si estÃƒÂ¡n definidas
    const startDatetime = startDate ? formatDateTime(startDate) : null;
    const endDatetime = endDate ? formatDateTime(endDate) : null;

    setLoading(true);
    const job = await addJob({
      client_id: selectedClient,
      product_service_id: selectedProduct || null,
      folder_id: selectedFolder || null,
      type_of_work: typeOfWork,
      description,
      status,
      start_datetime: startDatetime,
      end_datetime: endDatetime,
      multiplicative_value: parseFloat(multiplicativeValue || '1.0'),
      attached_files: attachedFiles || null,
    });
    setLoading(false);

    if (job) {
      Alert.alert('Ãƒâ€°xito', 'Trabajo creado con ÃƒÂ©xito.');
      router.back();
    } else {
      Alert.alert('Error', 'No se pudo crear el trabajo.');
    }
  };

  return (
    <ScrollView contentContainerStyle={styles.container}>
      {/* CLIENTE */}
      <Text style={styles.label}>Cliente *</Text>
      <View style={styles.pickerContainer}>
        <Picker
          selectedValue={selectedClient}
          onValueChange={(itemValue) => setSelectedClient(itemValue)}
          style={styles.picker}
        >
          <Picker.Item label="-- Selecciona un Cliente --" value={null} />
          {clients.map(client => (
            <Picker.Item
              key={client.id}
              label={client.business_name}
              value={client.id}
            />
          ))}
        </Picker>
      </View>

      {/* FOLDER */}
      <Text style={styles.label}>Carpeta (Opcional)</Text>
      <View style={styles.pickerContainer}>
        <Picker
          selectedValue={selectedFolder}
          onValueChange={(itemValue) => setSelectedFolder(itemValue)}
          style={styles.picker}
          enabled={!!selectedClient}
        >
          <Picker.Item label="-- Sin carpeta --" value={null} />
          {filteredFolders.map(folder => (
            <Picker.Item key={folder.id} label={folder.name} value={folder.id} />
          ))}
        </Picker>
      </View>

      {/* PRODUCT/SERVICE */}
      <Text style={styles.label}>Producto/Servicio (Opcional)</Text>
      <View style={styles.pickerContainer}>
        <Picker
          selectedValue={selectedProduct}
          onValueChange={(itemValue) => setSelectedProduct(itemValue)}
          style={styles.picker}
        >
          <Picker.Item label="-- Ninguno --" value={null} />
          {productsServices.map(ps => (
            <Picker.Item key={ps.id} label={ps.description} value={ps.id} />
          ))}
        </Picker>
      </View>

      {/* ESTADO */}
      <Text style={styles.label}>Estado *</Text>
      <View style={styles.pickerContainer}>
        <Picker
          selectedValue={status}
          onValueChange={(itemValue) => setStatus(itemValue)}
          style={styles.picker}
        >
          {STATUS_OPTIONS.map(st => (
            <Picker.Item key={st.value} label={st.label} value={st.value} />
          ))}
        </Picker>
      </View>

      {/* TIPO DE TRABAJO */}
      <Text style={styles.label}>Tipo de trabajo *</Text>
      <TextInput
        style={styles.input}
        placeholder="Ej: ReparaciÃƒÂ³n de equipo, etc."
        value={typeOfWork}
        onChangeText={setTypeOfWork}
      />

      {/* DESCRIPCIÃƒâ€œN */}
      <Text style={styles.label}>DescripciÃƒÂ³n *</Text>
      <TextInput
        style={[styles.input, { height: 80 }]}
        value={description}
        multiline
        onChangeText={setDescription}
        placeholder="Describe este trabajo"
      />

      {/* SECCIÃƒâ€œN DE FECHAS Y HORAS */}
      {/* INICIO */}
      <Text style={styles.label}>Fecha de Inicio</Text>
      <TouchableOpacity style={[styles.dateButton, { marginBottom: 6 }]} onPress={showStartDatepicker}>
        <Text style={styles.dateButtonText}>
          {startDate ? startDate.toLocaleDateString() : 'Seleccionar Fecha'}
        </Text>
      </TouchableOpacity>
      <Text style={styles.label}>Hora de Inicio</Text>
      <TouchableOpacity style={[styles.dateButton, { marginBottom: 6 }]} onPress={showStartTimepicker}>
        <Text style={styles.dateButtonText}>
          {startDate ? formatTime(startDate) : 'Seleccionar Hora'}
        </Text>
      </TouchableOpacity>
      {startPickerShow && (
        <DateTimePicker
          value={startDate || new Date()}
          mode={startPickerMode}
          display={Platform.OS === 'ios' ? 'spinner' : 'default'}
          is24Hour={true}
          onChange={onChangeStartPicker}
        />
      )}
      {/* BotÃƒÂ³n para eliminar fecha y hora de inicio */}
      {startDate && (
        <TouchableOpacity style={styles.clearButton} onPress={clearStartDateTime}>
          <Text style={styles.clearButtonText}>Eliminar fecha/hora de Inicio</Text>
        </TouchableOpacity>
      )}

      {/* FIN */}
      <Text style={styles.label}>Fecha de Fin</Text>
      <TouchableOpacity style={[styles.dateButton, { marginBottom: 6 }]} onPress={showEndDatepicker}>
        <Text style={styles.dateButtonText}>
          {endDate ? endDate.toLocaleDateString() : 'Seleccionar Fecha'}
        </Text>
      </TouchableOpacity>
      <Text style={styles.label}>Hora de Fin</Text>
      <TouchableOpacity style={[styles.dateButton, { marginBottom: 6 }]} onPress={showEndTimepicker}>
        <Text style={styles.dateButtonText}>
          {endDate ? formatTime(endDate) : 'Seleccionar Hora'}
        </Text>
      </TouchableOpacity>
      {endPickerShow && (
        <DateTimePicker
          value={endDate || new Date()}
          mode={endPickerMode}
          display={Platform.OS === 'ios' ? 'spinner' : 'default'}
          is24Hour={true}
          onChange={onChangeEndPicker}
        />
      )}
      {/* BotÃƒÂ³n para eliminar fecha y hora de fin */}
      {endDate && (
        <TouchableOpacity style={styles.clearButton} onPress={clearEndDateTime}>
          <Text style={styles.clearButtonText}>Eliminar fecha/hora de Fin</Text>
        </TouchableOpacity>
      )}

      {/* VALOR MULTIPLICADOR */}
      <Text style={styles.label}>Valor multiplicador</Text>
      <TextInput
        style={styles.input}
        keyboardType="decimal-pad"
        value={multiplicativeValue}
        onChangeText={setMultiplicativeValue}
      />

      {/* ARCHIVOS ADJUNTOS */}
      <Text style={styles.label}>Archivos adjuntos (URL o texto)</Text>
      <TextInput
        style={styles.input}
        value={attachedFiles}
        onChangeText={setAttachedFiles}
        placeholder="Ej: https://archivo.pdf"
      />

      {/* BOTÃƒâ€œN CREAR */}
      <TouchableOpacity style={styles.submitButton} onPress={handleSubmit} disabled={loading}>
        <Text style={styles.submitButtonText}>
          {loading ? 'Creando...' : 'Crear Trabajo'}
        </Text>
      </TouchableOpacity>
    </ScrollView>
  );
}

const styles = StyleSheet.create({
  container: {
    padding: 16,
    backgroundColor: '#fff'
  },
  label: {
    marginTop: 12,
    fontSize: 16,
    fontWeight: '600'
  },
  pickerContainer: {
    borderWidth: 1,
    borderColor: '#ccc',
    borderRadius: 8,
    marginTop: 4,
    marginBottom: 8,
  },
  picker: {
    height: 60,
    width: '100%',
  },
  input: {
    borderWidth: 1,
    borderColor: '#ccc',
    borderRadius: 8,
    padding: 12,
    marginTop: 4,
    marginBottom: 8,
  },
  dateButton: {
    borderColor: '#ccc',
    borderWidth: 1,
    borderRadius: 8,
    padding: 12,
    marginBottom: 8,
  },
  dateButtonText: {
    color: '#555',
  },
  submitButton: {
    marginTop: 20,
    backgroundColor: '#28a745',
    padding: 16,
    borderRadius: 8,
    alignItems: 'center'
  },
  submitButtonText: {
    color: '#fff',
    fontSize: 16,
    fontWeight: 'bold'
  },
  clearButton: {
    backgroundColor: '#dc3545',
    padding: 12,
    borderRadius: 8,
    alignItems: 'center',
    marginTop: 8,
    marginBottom: 8
  },
  clearButtonText: {
    color: '#fff',
    fontSize: 14,
    fontWeight: 'bold'
  },
});

---
Folder: C:/Users/Mauri/Documents/GitHub/router/app/jobs
File: index.tsx
Content:
// C:/Users/Mauri/Documents/GitHub/router/app/jobs/index.tsx
import React, { useContext, useEffect, useState, useMemo } from 'react';
import { View, Text, FlatList, TouchableOpacity, StyleSheet, TextInput, Alert, ActivityIndicator } from 'react-native';
import { useRouter } from 'expo-router';
import { JobsContext, Job } from '@/contexts/JobsContext';
import { PermissionsContext } from '@/contexts/PermissionsContext';
import Fuse from 'fuse.js';

export default function JobsScreen() {
  const { jobs, loadJobs, deleteJob } = useContext(JobsContext);
  const { permissions } = useContext(PermissionsContext);
  const router = useRouter();
  const [search, setSearch] = useState('');
  const [loadingId, setLoadingId] = useState<number | null>(null);

  useEffect(() => {
    if (!permissions.includes('listJobs')) {
      Alert.alert('Acceso denegado', 'No tienes permiso para ver trabajos.');
      router.back();
    } else {
      loadJobs();
    }
  }, [permissions]);

  const fuse = new Fuse(jobs, { keys: ['description', 'type_of_work', 'status'] });
  const filteredJobs = useMemo(() => {
    if (!search) return jobs;
    const result = fuse.search(search);
    return result.map(r => r.item);
  }, [search, jobs]);

  const handleDelete = (id: number) => {
    Alert.alert('Eliminar trabajo', 'Ã‚Â¿EstÃƒÂ¡s seguro?', [
      { text: 'Cancelar', style: 'cancel' },
      {
        text: 'Eliminar', style: 'destructive', onPress: async () => {
          setLoadingId(id);
          const success = await deleteJob(id);
          setLoadingId(null);
          if (!success) Alert.alert('Error', 'No se pudo eliminar el trabajo.');
        }
      }
    ]);
  };

  const renderItem = ({ item }: { item: Job }) => (
    <TouchableOpacity
      style={styles.item}
      onLongPress={() => router.push(`./jobs/${item.id}`)}
    >
      <View style={{ flex: 1 }}>
        <Text style={styles.title}>{item.type_of_work}</Text>
        <Text>{item.description}</Text>
        <Text style={styles.status}>{item.status}</Text>
      </View>
      <TouchableOpacity onPress={() => handleDelete(item.id)}>
        {loadingId === item.id ? <ActivityIndicator /> : <Text style={styles.trash}>Ã°Å¸â€”â€˜</Text>}
      </TouchableOpacity>
    </TouchableOpacity>
  );

  return (
    <View style={styles.container}>
      <TextInput style={styles.search} value={search} onChangeText={setSearch} placeholder="Buscar trabajo..." />
      <FlatList
        data={filteredJobs}
        keyExtractor={(item) => item.id.toString()}
        renderItem={renderItem}
        ListEmptyComponent={<Text style={styles.empty}>No hay trabajos cargados</Text>}
      />
      <TouchableOpacity style={styles.addButton} onPress={() => router.push('/jobs/create')}>
        <Text style={styles.addText}>Ã¢Å¾â€¢ Nuevo Trabajo</Text>
      </TouchableOpacity>
    </View>
  );
}

const styles = StyleSheet.create({
  container: { flex: 1, padding: 16, backgroundColor: '#fff' },
  item: { flexDirection: 'row', alignItems: 'center', justifyContent: 'space-between', borderBottomWidth: 1, borderColor: '#eee', paddingVertical: 12 },
  title: { fontWeight: 'bold', fontSize: 16 },
  status: { fontSize: 12, color: 'gray' },
  trash: { fontSize: 18, color: 'red', paddingHorizontal: 12 },
  search: { borderWidth: 1, borderColor: '#ccc', borderRadius: 8, padding: 12, marginBottom: 10 },
  addButton: { backgroundColor: '#007BFF', padding: 16, borderRadius: 30, position: 'absolute', right: 16, bottom: 32 },
  addText: { color: '#fff', fontWeight: 'bold' },
  empty: { marginTop: 20, textAlign: 'center' },
});

---
Folder: C:/Users/Mauri/Documents/GitHub/router/app/jobs
File: output.txt
Content:
Folder: C:/Users/Mauri/Documents/GitHub/router/app/jobs
File: create.tsx
Content:
// C:/Users/Mauri/Documents/GitHub/router/app/jobs/create.tsx
import React, { useState, useContext, useEffect } from 'react';
import { View, Text, TextInput, TouchableOpacity, Alert, StyleSheet, ScrollView, Platform } from 'react-native';
import { useRouter } from 'expo-router';
import DateTimePicker from '@react-native-community/datetimepicker';
import { Picker } from '@react-native-picker/picker'; 
import { JobsContext } from '@/contexts/JobsContext';
import { PermissionsContext } from '@/contexts/PermissionsContext';
import { ClientsContext } from '@/contexts/ClientsContext';
import { FoldersContext } from '@/contexts/FoldersContext';
import { ProductsServicesContext } from '@/contexts/ProductsServicesContext';

export default function CreateJobScreen() {
  const router = useRouter();
  const { addJob } = useContext(JobsContext);
  const { permissions } = useContext(PermissionsContext);
  const { clients } = useContext(ClientsContext);
  const { folders } = useContext(FoldersContext);
  const { productsServices } = useContext(ProductsServicesContext);

  // Opciones de estado predefinidas
  const STATUS_OPTIONS = [
    { label: 'Pendiente', value: 'Pendiente' },
    { label: 'En progreso', value: 'En progreso' },
    { label: 'Completado', value: 'Completado' },
    { label: 'Cancelado', value: 'Cancelado' },
  ];

  // Estados del formulario
  const [selectedClient, setSelectedClient] = useState<number | null>(null);
  const [selectedFolder, setSelectedFolder] = useState<number | null>(null);
  const [selectedProduct, setSelectedProduct] = useState<number | null>(null);
  const [status, setStatus] = useState<string>('Pendiente');
  const [typeOfWork, setTypeOfWork] = useState<string>('');
  const [description, setDescription] = useState<string>('');
  const [multiplicativeValue, setMultiplicativeValue] = useState<string>('1.00');
  const [attachedFiles, setAttachedFiles] = useState<string>('');
  
  // Estados de fecha para inicio y fin (almacenan el objeto Date)
  const [startDate, setStartDate] = useState<Date | null>(null);
  const [endDate, setEndDate] = useState<Date | null>(null);

  // Estados para controlar la visibilidad y modo de los pickers (fecha o hora) para inicio
  const [startPickerShow, setStartPickerShow] = useState<boolean>(false);
  const [startPickerMode, setStartPickerMode] = useState<'date' | 'time'>('date');

  // Estados para controlar la visibilidad y modo de los pickers (fecha o hora) para fin
  const [endPickerShow, setEndPickerShow] = useState<boolean>(false);
  const [endPickerMode, setEndPickerMode] = useState<'date' | 'time'>('date');

  // Estado de carga
  const [loading, setLoading] = useState<boolean>(false);

  useEffect(() => {
    if (!permissions.includes('addJob')) {
      Alert.alert('Acceso denegado', 'No tienes permiso para agregar trabajos.');
      router.back();
    }
  }, [permissions]);

  // Filtra las carpetas segÃƒÆ’Ã‚Âºn el cliente seleccionado
  const filteredFolders = folders.filter(f => {
    if (!selectedClient) return false;
    return f.client_id === selectedClient;
  });

  /**
   * FunciÃƒÆ’Ã‚Â³n auxiliar que formatea la fecha a 'YYYY-MM-DD HH:mm:ss'
   */
  const formatDateTime = (date: Date): string => {
    const pad = (n: number) => (n < 10 ? '0' + n : n);
    const year = date.getFullYear();
    const month = pad(date.getMonth() + 1);
    const day = pad(date.getDate());
    const hour = pad(date.getHours());
    const minutes = pad(date.getMinutes());
    const seconds = pad(date.getSeconds());
    return `${year}-${month}-${day} ${hour}:${minutes}:${seconds}`;
  };

  /**
   * FunciÃƒÆ’Ã‚Â³n auxiliar que formatea solo la hora en formato HH:mm:ss
   */
  const formatTime = (date: Date): string => {
    const pad = (n: number) => (n < 10 ? '0' + n : n);
    const hour = pad(date.getHours());
    const minutes = pad(date.getMinutes());
    const seconds = pad(date.getSeconds());
    return `${hour}:${minutes}:${seconds}`;
  };

  // Funciones para mostrar el picker de fecha y hora de inicio
  const showStartDatepicker = () => {
    setStartPickerMode('date');
    setStartPickerShow(true);
  };

  const showStartTimepicker = () => {
    setStartPickerMode('time');
    setStartPickerShow(true);
  };

  // FunciÃƒÆ’Ã‚Â³n onChange para el picker de inicio
  const onChangeStartPicker = (event: any, selectedDate?: Date) => {
    setStartPickerShow(false);
    if (selectedDate) {
      if (startPickerMode === 'date') {
        // Si se selecciona la fecha, usar la hora actual si es que la hora es 00:00
        let hour: number, minute: number, second: number;
        if (startDate) {
          if (startDate.getHours() === 0 && startDate.getMinutes() === 0 && startDate.getSeconds() === 0) {
            const now = new Date();
            hour = now.getHours();
            minute = now.getMinutes();
            second = now.getSeconds();
          } else {
            hour = startDate.getHours();
            minute = startDate.getMinutes();
            second = startDate.getSeconds();
          }
        } else {
          const now = new Date();
          hour = now.getHours();
          minute = now.getMinutes();
          second = now.getSeconds();
        }
        const newDate = new Date(
          selectedDate.getFullYear(),
          selectedDate.getMonth(),
          selectedDate.getDate(),
          hour,
          minute,
          second
        );
        setStartDate(newDate);
      } else { // modo "time"
        if (startDate) {
          const newDate = new Date(
            startDate.getFullYear(),
            startDate.getMonth(),
            startDate.getDate(),
            selectedDate.getHours(),
            selectedDate.getMinutes(),
            selectedDate.getSeconds()
          );
          setStartDate(newDate);
        } else {
          const today = new Date();
          setStartDate(new Date(
            today.getFullYear(),
            today.getMonth(),
            today.getDate(),
            selectedDate.getHours(),
            selectedDate.getMinutes(),
            selectedDate.getSeconds()
          ));
        }
      }
    }
  };

  // Funciones para mostrar el picker de fecha y hora de fin
  const showEndDatepicker = () => {
    setEndPickerMode('date');
    setEndPickerShow(true);
  };

  const showEndTimepicker = () => {
    setEndPickerMode('time');
    setEndPickerShow(true);
  };

  // FunciÃƒÆ’Ã‚Â³n onChange para el picker de fin
  const onChangeEndPicker = (event: any, selectedDate?: Date) => {
    setEndPickerShow(false);
    if (selectedDate) {
      if (endPickerMode === 'date') {
        // Si se selecciona la fecha, usar la hora actual si es que la hora es 00:00
        let hour: number, minute: number, second: number;
        if (endDate) {
          if (endDate.getHours() === 0 && endDate.getMinutes() === 0 && endDate.getSeconds() === 0) {
            const now = new Date();
            hour = now.getHours();
            minute = now.getMinutes();
            second = now.getSeconds();
          } else {
            hour = endDate.getHours();
            minute = endDate.getMinutes();
            second = endDate.getSeconds();
          }
        } else {
          const now = new Date();
          hour = now.getHours();
          minute = now.getMinutes();
          second = now.getSeconds();
        }
        const newDate = new Date(
          selectedDate.getFullYear(),
          selectedDate.getMonth(),
          selectedDate.getDate(),
          hour,
          minute,
          second
        );
        setEndDate(newDate);
      } else { // modo "time"
        if (endDate) {
          const newDate = new Date(
            endDate.getFullYear(),
            endDate.getMonth(),
            endDate.getDate(),
            selectedDate.getHours(),
            selectedDate.getMinutes(),
            selectedDate.getSeconds()
          );
          setEndDate(newDate);
        } else {
          const today = new Date();
          setEndDate(new Date(
            today.getFullYear(),
            today.getMonth(),
            today.getDate(),
            selectedDate.getHours(),
            selectedDate.getMinutes(),
            selectedDate.getSeconds()
          ));
        }
      }
    }
  };

  // Botones adicionales para eliminar fecha y hora
  const clearStartDateTime = () => {
    setStartDate(null);
  };

  const clearEndDateTime = () => {
    setEndDate(null);
  };

  // Al confirmar envÃƒÆ’Ã‚Â­o:
  const handleSubmit = async () => {
    // Validamos lo mÃƒÆ’Ã‚Â­nimo
    if (!selectedClient /*|| !typeOfWork || !description || !status*/) {
      Alert.alert('Error', 'Por favor completa los campos obligatorios (Cliente).');
      return;
    }
    // ConversiÃƒÆ’Ã‚Â³n a string con formato MySQL para fechas, si estÃƒÆ’Ã‚Â¡n definidas
    const startDatetime = startDate ? formatDateTime(startDate) : null;
    const endDatetime = endDate ? formatDateTime(endDate) : null;

    setLoading(true);
    const job = await addJob({
      client_id: selectedClient,
      product_service_id: selectedProduct || null,
      folder_id: selectedFolder || null,
      type_of_work: typeOfWork,
      description,
      status,
      start_datetime: startDatetime,
      end_datetime: endDatetime,
      multiplicative_value: parseFloat(multiplicativeValue || '1.0'),
      attached_files: attachedFiles || null,
    });
    setLoading(false);

    if (job) {
      Alert.alert('ÃƒÆ’Ã¢â‚¬Â°xito', 'Trabajo creado con ÃƒÆ’Ã‚Â©xito.');
      router.back();
    } else {
      Alert.alert('Error', 'No se pudo crear el trabajo.');
    }
  };

  return (
    <ScrollView contentContainerStyle={styles.container}>
      {/* CLIENTE */}
      <Text style={styles.label}>Cliente *</Text>
      <View style={styles.pickerContainer}>
        <Picker
          selectedValue={selectedClient}
          onValueChange={(itemValue) => setSelectedClient(itemValue)}
          style={styles.picker}
        >
          <Picker.Item label="-- Selecciona un Cliente --" value={null} />
          {clients.map(client => (
            <Picker.Item
              key={client.id}
              label={client.business_name}
              value={client.id}
            />
          ))}
        </Picker>
      </View>

      {/* FOLDER */}
      <Text style={styles.label}>Carpeta (Opcional)</Text>
      <View style={styles.pickerContainer}>
        <Picker
          selectedValue={selectedFolder}
          onValueChange={(itemValue) => setSelectedFolder(itemValue)}
          style={styles.picker}
          enabled={!!selectedClient}
        >
          <Picker.Item label="-- Sin carpeta --" value={null} />
          {filteredFolders.map(folder => (
            <Picker.Item key={folder.id} label={folder.name} value={folder.id} />
          ))}
        </Picker>
      </View>

      {/* PRODUCT/SERVICE */}
      <Text style={styles.label}>Producto/Servicio (Opcional)</Text>
      <View style={styles.pickerContainer}>
        <Picker
          selectedValue={selectedProduct}
          onValueChange={(itemValue) => setSelectedProduct(itemValue)}
          style={styles.picker}
        >
          <Picker.Item label="-- Ninguno --" value={null} />
          {productsServices.map(ps => (
            <Picker.Item key={ps.id} label={ps.description} value={ps.id} />
          ))}
        </Picker>
      </View>

      {/* ESTADO */}
      <Text style={styles.label}>Estado *</Text>
      <View style={styles.pickerContainer}>
        <Picker
          selectedValue={status}
          onValueChange={(itemValue) => setStatus(itemValue)}
          style={styles.picker}
        >
          {STATUS_OPTIONS.map(st => (
            <Picker.Item key={st.value} label={st.label} value={st.value} />
          ))}
        </Picker>
      </View>

      {/* TIPO DE TRABAJO */}
      <Text style={styles.label}>Tipo de trabajo *</Text>
      <TextInput
        style={styles.input}
        placeholder="Ej: ReparaciÃƒÆ’Ã‚Â³n de equipo, etc."
        value={typeOfWork}
        onChangeText={setTypeOfWork}
      />

      {/* DESCRIPCIÃƒÆ’Ã¢â‚¬Å“N */}
      <Text style={styles.label}>DescripciÃƒÆ’Ã‚Â³n *</Text>
      <TextInput
        style={[styles.input, { height: 80 }]}
        value={description}
        multiline
        onChangeText={setDescription}
        placeholder="Describe este trabajo"
      />

      {/* SECCIÃƒÆ’Ã¢â‚¬Å“N DE FECHAS Y HORAS */}
      {/* INICIO */}
      <Text style={styles.label}>Fecha de Inicio</Text>
      <TouchableOpacity style={[styles.dateButton, { marginBottom: 6 }]} onPress={showStartDatepicker}>
        <Text style={styles.dateButtonText}>
          {startDate ? startDate.toLocaleDateString() : 'Seleccionar Fecha'}
        </Text>
      </TouchableOpacity>
      <Text style={styles.label}>Hora de Inicio</Text>
      <TouchableOpacity style={[styles.dateButton, { marginBottom: 6 }]} onPress={showStartTimepicker}>
        <Text style={styles.dateButtonText}>
          {startDate ? formatTime(startDate) : 'Seleccionar Hora'}
        </Text>
      </TouchableOpacity>
      {startPickerShow && (
        <DateTimePicker
          value={startDate || new Date()}
          mode={startPickerMode}
          display={Platform.OS === 'ios' ? 'spinner' : 'default'}
          is24Hour={true}
          onChange={onChangeStartPicker}
        />
      )}
      {/* BotÃƒÆ’Ã‚Â³n para eliminar fecha y hora de inicio */}
      {startDate && (
        <TouchableOpacity style={styles.clearButton} onPress={clearStartDateTime}>
          <Text style={styles.clearButtonText}>Eliminar fecha/hora de Inicio</Text>
        </TouchableOpacity>
      )}

      {/* FIN */}
      <Text style={styles.label}>Fecha de Fin</Text>
      <TouchableOpacity style={[styles.dateButton, { marginBottom: 6 }]} onPress={showEndDatepicker}>
        <Text style={styles.dateButtonText}>
          {endDate ? endDate.toLocaleDateString() : 'Seleccionar Fecha'}
        </Text>
      </TouchableOpacity>
      <Text style={styles.label}>Hora de Fin</Text>
      <TouchableOpacity style={[styles.dateButton, { marginBottom: 6 }]} onPress={showEndTimepicker}>
        <Text style={styles.dateButtonText}>
          {endDate ? formatTime(endDate) : 'Seleccionar Hora'}
        </Text>
      </TouchableOpacity>
      {endPickerShow && (
        <DateTimePicker
          value={endDate || new Date()}
          mode={endPickerMode}
          display={Platform.OS === 'ios' ? 'spinner' : 'default'}
          is24Hour={true}
          onChange={onChangeEndPicker}
        />
      )}
      {/* BotÃƒÆ’Ã‚Â³n para eliminar fecha y hora de fin */}
      {endDate && (
        <TouchableOpacity style={styles.clearButton} onPress={clearEndDateTime}>
          <Text style={styles.clearButtonText}>Eliminar fecha/hora de Fin</Text>
        </TouchableOpacity>
      )}

      {/* VALOR MULTIPLICADOR */}
      <Text style={styles.label}>Valor multiplicador</Text>
      <TextInput
        style={styles.input}
        keyboardType="decimal-pad"
        value={multiplicativeValue}
        onChangeText={setMultiplicativeValue}
      />

      {/* ARCHIVOS ADJUNTOS */}
      <Text style={styles.label}>Archivos adjuntos (URL o texto)</Text>
      <TextInput
        style={styles.input}
        value={attachedFiles}
        onChangeText={setAttachedFiles}
        placeholder="Ej: https://archivo.pdf"
      />

      {/* BOTÃƒÆ’Ã¢â‚¬Å“N CREAR */}
      <TouchableOpacity style={styles.submitButton} onPress={handleSubmit} disabled={loading}>
        <Text style={styles.submitButtonText}>
          {loading ? 'Creando...' : 'Crear Trabajo'}
        </Text>
      </TouchableOpacity>
    </ScrollView>
  );
}

const styles = StyleSheet.create({
  container: {
    padding: 16,
    backgroundColor: '#fff'
  },
  label: {
    marginTop: 12,
    fontSize: 16,
    fontWeight: '600'
  },
  pickerContainer: {
    borderWidth: 1,
    borderColor: '#ccc',
    borderRadius: 8,
    marginTop: 4,
    marginBottom: 8,
  },
  picker: {
    height: 60,
    width: '100%',
  },
  input: {
    borderWidth: 1,
    borderColor: '#ccc',
    borderRadius: 8,
    padding: 12,
    marginTop: 4,
    marginBottom: 8,
  },
  dateButton: {
    borderColor: '#ccc',
    borderWidth: 1,
    borderRadius: 8,
    padding: 12,
    marginBottom: 8,
  },
  dateButtonText: {
    color: '#555',
  },
  submitButton: {
    marginTop: 20,
    backgroundColor: '#28a745',
    padding: 16,
    borderRadius: 8,
    alignItems: 'center'
  },
  submitButtonText: {
    color: '#fff',
    fontSize: 16,
    fontWeight: 'bold'
  },
  clearButton: {
    backgroundColor: '#dc3545',
    padding: 12,
    borderRadius: 8,
    alignItems: 'center',
    marginTop: 8,
    marginBottom: 8
  },
  clearButtonText: {
    color: '#fff',
    fontSize: 14,
    fontWeight: 'bold'
  },
});

---
Folder: C:/Users/Mauri/Documents/GitHub/router/app/jobs
File: [id].tsx
Content:
// C:/Users/Mauri/Documents/GitHub/router/app/jobs/[id].tsx
import React, { useState, useContext, useEffect, useMemo } from 'react';
import {
  View,
  Text,
  TextInput,
  TouchableOpacity,
  Alert,
  StyleSheet,
  ScrollView,
  Platform,
  ActivityIndicator,
} from 'react-native';
import { useRouter, useLocalSearchParams } from 'expo-router';
import DateTimePicker from '@react-native-community/datetimepicker';
// Eliminamos el Picker convencional ya que usaremos el ModalPicker
// import { Picker } from '@react-native-picker/picker';

import { JobsContext } from '@/contexts/JobsContext';
import { PermissionsContext } from '@/contexts/PermissionsContext';
import { ClientsContext } from '@/contexts/ClientsContext';
import { FoldersContext } from '@/contexts/FoldersContext';
import { ProductsServicesContext } from '@/contexts/ProductsServicesContext';

// Importamos nuestro nuevo componente
import { ModalPicker, ModalPickerItem } from '@/components/ModalPicker';

export default function EditJobScreen() {
  const router = useRouter();
  const { id } = useLocalSearchParams<{ id: string }>();
  const jobId = Number(id);

  // Contextos
  const { jobs, updateJob, deleteJob } = useContext(JobsContext);
  const { permissions } = useContext(PermissionsContext);
  const { clients } = useContext(ClientsContext);
  const { folders } = useContext(FoldersContext);
  const { productsServices } = useContext(ProductsServicesContext);

  // Encontramos el job actual
  const job = jobs.find((j) => j.id === jobId);

  // Permisos
  const canEdit = permissions.includes('updateJob');
  const canDelete = permissions.includes('deleteJob');

  // Estado local
  const [loading, setLoading] = useState(false);

  const STATUS_OPTIONS = [
    { id: 0, label: 'Pendiente', value: 'Pendiente', backgroundColor: '#9C27B0' },    // PÃƒÂºrpura intermedio
    { id: 1, label: 'En progreso', value: 'En progreso', backgroundColor: '#66BB6A' },    // Verde intermedio
    { id: 2, label: 'En espera', value: 'En espera', backgroundColor: '#FBC02D' },        // Ãƒï¿½mbar intermedio
    { id: 3, label: 'En revisiÃƒÂ³n', value: 'En revisiÃƒÂ³n', backgroundColor: '#FFB74D' },    // Naranja intermedio
    { id: 4, label: 'Aprobado', value: 'Aprobado', backgroundColor: '#26A69A' },          // Teal intermedio
    { id: 5, label: 'Completado', value: 'Completado', backgroundColor: '#42A5F5' },      // Azul intermedio
    { id: 6, label: 'Cancelado', value: 'Cancelado', backgroundColor: '#EF5350' },        // Rojo intermedio
    { id: 7, label: 'Rechazado', value: 'Rechazado', backgroundColor: '#EC407A' }         // Rosa intermedio
  ];  

  // Creamos estados para los selectores usando ModalPickerItem  
  const [selectedClient, setSelectedClient] = useState<ModalPickerItem | null>(null);
  const [selectedFolder, setSelectedFolder] = useState<ModalPickerItem | null>(null);
  const [selectedProduct, setSelectedProduct] = useState<ModalPickerItem | null>(null);
  const [selectedStatus, setSelectedStatus] = useState<ModalPickerItem | null>(null);

  // Los demÃƒÂ¡s campos se mantienen
  const [typeOfWork, setTypeOfWork] = useState<string>('');
  const [description, setDescription] = useState<string>('');
  const [multiplicativeValue, setMultiplicativeValue] = useState<string>('1.00');
  const [attachedFiles, setAttachedFiles] = useState<string>('');

  const [startDate, setStartDate] = useState<Date | null>(null);
  const [endDate, setEndDate] = useState<Date | null>(null);

  // Control de los pickers para fecha/hora (inicio)
  const [startPickerShow, setStartPickerShow] = useState<boolean>(false);
  const [startPickerMode, setStartPickerMode] = useState<'date' | 'time'>('date');

  // Control de los pickers para fecha/hora (fin)
  const [endPickerShow, setEndPickerShow] = useState<boolean>(false);
  const [endPickerMode, setEndPickerMode] = useState<'date' | 'time'>('date');

  useEffect(() => {
    if (!canEdit && !canDelete) {
      Alert.alert('Acceso denegado', 'No tienes permiso para acceder.');
      router.back();
    }
  }, [permissions]);

  // Convertimos la informaciÃƒÂ³n de los contextos a arrays de ModalPickerItem
  const clientItems: ModalPickerItem[] = useMemo(() => 
    clients.map(c => ({
      id: c.id,
      name: c.business_name,
   //   imageFileId: c.imageFileId || null,  // Si tienes propiedad de imagen, de lo contrario null
    })), [clients]);

  const folderItems: ModalPickerItem[] = useMemo(() =>
    // Se usa el arreglo filtrado de carpetas segÃƒÂºn el cliente seleccionado
    folders
      .filter(f => selectedClient ? f.client_id === selectedClient.id : false)
      .map(f => ({
        id: f.id,
        name: f.name,
   //     imageFileId: f.imageFileId || null,
      })), [folders, selectedClient]);

  const productItems: ModalPickerItem[] = useMemo(() =>
    productsServices.map(ps => ({
      id: ps.id,
      name: ps.description,
 //     imageFileId: ps.imageFileId || null,
    })), [productsServices]);

  const statusItems: ModalPickerItem[] = useMemo(() =>
    STATUS_OPTIONS.map(opt => ({
      id: opt.id,
      name: opt.label,
      imageFileId: null,
      backgroundColor: opt.backgroundColor,
    })), []);

  // Inicializa el formulario con los datos del job
  useEffect(() => {
    if (!job) {
      Alert.alert('Error', 'Trabajo no encontrado.');
      router.back();
      return;
    }

    // Buscamos y asignamos el item correspondiente para cada selector
    const clientObj = clients.find(c => c.id === job.client_id);
    setSelectedClient(clientObj ? {
      id: clientObj.id,
      name: clientObj.business_name,
 //     imageFileId: clientObj.imageFileId || null,
  //    backgroundColor: clientObj.backgroundColor || '#fff',
    } : null);

    const folderObj = folders.find(f => f.id === job.folder_id);
    setSelectedFolder(folderObj ? {
      id: folderObj.id,
      name: folderObj.name,
 //     imageFileId: folderObj.imageFileId || null,
    } : null);

    const productObj = productsServices.find(ps => ps.id === job.product_service_id);
    setSelectedProduct(productObj ? {
      id: productObj.id,
      name: productObj.description,
  //    imageFileId: productObj.imageFileId || null,
    } : null);

    // Para estado, usamos el propio valor de job.status
    setSelectedStatus(job.status ? {
      id: job.status,
      name: job.status,
      imageFileId: null,
      backgroundColor: '#fff',
    } : null);

    // Otros campos
    setTypeOfWork(job.type_of_work || '');
    setDescription(job.description || '');
    setMultiplicativeValue(job.multiplicative_value.toString());
    setAttachedFiles(job.attached_files || '');

    // Parseamos fechas a Date
    setStartDate(job.start_datetime ? parseDateTime(job.start_datetime) : null);
    setEndDate(job.end_datetime ? parseDateTime(job.end_datetime) : null);
  }, [job, clients, folders, productsServices]);

  // Helpers
  function parseDateTime(datetimeString: string): Date {
    // Asumiendo formato 'YYYY-MM-DD HH:mm:ss'
    // ConversiÃƒÂ³n bÃƒÂ¡sica: '2023-07-13 14:30:00' => '2023-07-13T14:30:00'
    const fixedString = datetimeString.replace(' ', 'T');
    return new Date(fixedString);
  }

  function formatDateTime(date: Date): string {
    const pad = (n: number) => (n < 10 ? '0' + n : n);
    const year = date.getFullYear();
    const month = pad(date.getMonth() + 1);
    const day = pad(date.getDate());
    const hour = pad(date.getHours());
    const minutes = pad(date.getMinutes());
    const seconds = pad(date.getSeconds());
    return `${year}-${month}-${day} ${hour}:${minutes}:${seconds}`;
  }

  function formatTime(date: Date): string {
    const pad = (n: number) => (n < 10 ? '0' + n : n);
    const hour = pad(date.getHours());
    const minutes = pad(date.getMinutes());
    const seconds = pad(date.getSeconds());
    return `${hour}:${minutes}:${seconds}`;
  }

  // Funciones para mostrar el picker de fecha/hora de inicio
  const showStartDatepicker = () => {
    setStartPickerMode('date');
    setStartPickerShow(true);
  };

  const showStartTimepicker = () => {
    setStartPickerMode('time');
    setStartPickerShow(true);
  };

  // FunciÃƒÂ³n onChange para el picker de inicio
  const onChangeStartPicker = (event: any, selectedDate?: Date) => {
    setStartPickerShow(false);
    if (selectedDate) {
      if (startPickerMode === 'date') {
        // Si se selecciona la fecha y la hora es 00:00, se asigna la hora actual
        let hour: number, minute: number, second: number;
        if (startDate) {
          if (
            startDate.getHours() === 0 &&
            startDate.getMinutes() === 0 &&
            startDate.getSeconds() === 0
          ) {
            const now = new Date();
            hour = now.getHours();
            minute = now.getMinutes();
            second = now.getSeconds();
          } else {
            hour = startDate.getHours();
            minute = startDate.getMinutes();
            second = startDate.getSeconds();
          }
        } else {
          const now = new Date();
          hour = now.getHours();
          minute = now.getMinutes();
          second = now.getSeconds();
        }
        const newDate = new Date(
          selectedDate.getFullYear(),
          selectedDate.getMonth(),
          selectedDate.getDate(),
          hour,
          minute,
          second
        );
        setStartDate(newDate);
      } else {
        // Modo "time"
        if (startDate) {
          const newDate = new Date(
            startDate.getFullYear(),
            startDate.getMonth(),
            startDate.getDate(),
            selectedDate.getHours(),
            selectedDate.getMinutes(),
            selectedDate.getSeconds()
          );
          setStartDate(newDate);
        } else {
          const today = new Date();
          setStartDate(
            new Date(
              today.getFullYear(),
              today.getMonth(),
              today.getDate(),
              selectedDate.getHours(),
              selectedDate.getMinutes(),
              selectedDate.getSeconds()
            )
          );
        }
      }
    }
  };

  // Funciones para mostrar el picker de fecha/hora de fin
  const showEndDatepicker = () => {
    setEndPickerMode('date');
    setEndPickerShow(true);
  };

  const showEndTimepicker = () => {
    setEndPickerMode('time');
    setEndPickerShow(true);
  };

  // FunciÃƒÂ³n onChange para el picker de fin
  const onChangeEndPicker = (event: any, selectedDate?: Date) => {
    setEndPickerShow(false);
    if (selectedDate) {
      if (endPickerMode === 'date') {
        // Si se selecciona la fecha y la hora es 00:00, se asigna la hora actual
        let hour: number, minute: number, second: number;
        if (endDate) {
          if (
            endDate.getHours() === 0 &&
            endDate.getMinutes() === 0 &&
            endDate.getSeconds() === 0
          ) {
            const now = new Date();
            hour = now.getHours();
            minute = now.getMinutes();
            second = now.getSeconds();
          } else {
            hour = endDate.getHours();
            minute = endDate.getMinutes();
            second = endDate.getSeconds();
          }
        } else {
          const now = new Date();
          hour = now.getHours();
          minute = now.getMinutes();
          second = now.getSeconds();
        }
        const newDate = new Date(
          selectedDate.getFullYear(),
          selectedDate.getMonth(),
          selectedDate.getDate(),
          hour,
          minute,
          second
        );
        setEndDate(newDate);
      } else {
        // Modo "time"
        if (endDate) {
          const newDate = new Date(
            endDate.getFullYear(),
            endDate.getMonth(),
            endDate.getDate(),
            selectedDate.getHours(),
            selectedDate.getMinutes(),
            selectedDate.getSeconds()
          );
          setEndDate(newDate);
        } else {
          const today = new Date();
          setEndDate(
            new Date(
              today.getFullYear(),
              today.getMonth(),
              today.getDate(),
              selectedDate.getHours(),
              selectedDate.getMinutes(),
              selectedDate.getSeconds()
            )
          );
        }
      }
    }
  };

  // Botones para eliminar fecha/hora
  const clearStartDateTime = () => {
    setStartDate(null);
  };

  const clearEndDateTime = () => {
    setEndDate(null);
  };

  // Actualizar
  const handleUpdate = () => {
    Alert.alert('Actualizar trabajo', 'Ã‚Â¿Deseas guardar los cambios?', [
      { text: 'Cancelar', style: 'cancel' },
      {
        text: 'Actualizar',
        onPress: async () => {
          setLoading(true);

          const updated = await updateJob(jobId, {
            // Al actualizar, extraemos el id de cada selecciÃƒÂ³n
            client_id: selectedClient ? Number(selectedClient.id) : null,
            product_service_id: selectedProduct ? Number(selectedProduct.id) : null,
            folder_id: selectedFolder ? Number(selectedFolder.id) : null,
            type_of_work: typeOfWork,
            description,
            status: selectedStatus ? String(selectedStatus.id) : '',
            start_datetime: startDate ? formatDateTime(startDate) : null,
            end_datetime: endDate ? formatDateTime(endDate) : null,
            multiplicative_value: parseFloat(multiplicativeValue),
            attached_files: attachedFiles || null,
          });

          setLoading(false);
          if (updated) {
            Alert.alert('Ãƒâ€°xito', 'Trabajo actualizado.');
            router.back();
          } else {
            Alert.alert('Error', 'No se pudo actualizar el trabajo.');
          }
        },
      },
    ]);
  };

  // Eliminar
  const handleDelete = () => {
    Alert.alert('Eliminar trabajo', 'Ã‚Â¿Deseas eliminar este trabajo?', [
      { text: 'Cancelar', style: 'cancel' },
      {
        text: 'Eliminar',
        style: 'destructive',
        onPress: async () => {
          setLoading(true);
          const success = await deleteJob(jobId);
          setLoading(false);
          if (success) {
            Alert.alert('Ãƒâ€°xito', 'Trabajo eliminado.');
            router.back();
          } else {
            Alert.alert('Error', 'No se pudo eliminar el trabajo.');
          }
        },
      },
    ]);
  };

  return (
    <ScrollView contentContainerStyle={styles.container}>
      {/* CLIENTE */}
      <Text style={styles.label}>Cliente *</Text>
      <View style={styles.pickerContainer}>
        <ModalPicker
          items={clientItems}
          selectedItem={selectedClient}
          onSelect={setSelectedClient}
          placeholder="-- Selecciona un Cliente --"
        />
      </View>

      {/* CARPETA */}
      <Text style={styles.label}>Carpeta (Opcional)</Text>
      <View style={styles.pickerContainer}>
        <ModalPicker
          items={folderItems}
          selectedItem={selectedFolder}
          onSelect={setSelectedFolder}
          placeholder="-- Sin carpeta --"
        />
      </View>

      {/* PRODUCTO/SERVICIO */}
      <Text style={styles.label}>Producto/Servicio (Opcional)</Text>
      <View style={styles.pickerContainer}>
        <ModalPicker
          items={productItems}
          selectedItem={selectedProduct}
          onSelect={setSelectedProduct}
          placeholder="-- Ninguno --"
        />
      </View>

      {/* ESTADO */}
      <Text style={styles.label}>Estado *</Text>
      <View style={styles.pickerContainer}>
        <ModalPicker
          items={statusItems}
          selectedItem={selectedStatus}
          onSelect={setSelectedStatus}
          placeholder="-- Selecciona un Estado --"
        />
      </View>

      {/* TIPO DE TRABAJO */}
      <Text style={styles.label}>Tipo de trabajo *</Text>
      <View style={styles.pickerContainer}>
        <TextInput
          style={styles.input}
          value={typeOfWork}
          onChangeText={setTypeOfWork}
          editable={canEdit}
        />
      </View>

      {/* DESCRIPCIÃƒâ€œN */}
      <Text style={styles.label}>DescripciÃƒÂ³n *</Text>
      <TextInput
        style={[styles.input, { height: 80 }]}
        multiline
        value={description}
        onChangeText={setDescription}
        editable={canEdit}
      />

      {/* SECCIÃƒâ€œN DE FECHA/HORA INICIO */}
      <Text style={styles.label}>Fecha de Inicio</Text>
      <TouchableOpacity style={styles.dateButton} onPress={() => canEdit && showStartDatepicker()}>
        <Text style={styles.dateButtonText}>
          {startDate ? startDate.toLocaleDateString() : 'Seleccionar Fecha'}
        </Text>
      </TouchableOpacity>
      <Text style={styles.label}>Hora de Inicio</Text>
      <TouchableOpacity style={styles.dateButton} onPress={() => canEdit && showStartTimepicker()}>
        <Text style={styles.dateButtonText}>
          {startDate ? formatTime(startDate) : 'Seleccionar Hora'}
        </Text>
      </TouchableOpacity>
      {startPickerShow && (
        <DateTimePicker
          value={startDate || new Date()}
          mode={startPickerMode}
          display={Platform.OS === 'ios' ? 'spinner' : 'default'}
          is24Hour={true}
          onChange={onChangeStartPicker}
        />
      )}
      {startDate && (
        <TouchableOpacity style={styles.clearButton} onPress={clearStartDateTime}>
          <Text style={styles.clearButtonText}>Eliminar fecha/hora de Inicio</Text>
        </TouchableOpacity>
      )}

      {/* SECCIÃƒâ€œN DE FECHA/HORA FIN */}
      <Text style={styles.label}>Fecha de Fin</Text>
      <TouchableOpacity style={styles.dateButton} onPress={() => canEdit && showEndDatepicker()}>
        <Text style={styles.dateButtonText}>
          {endDate ? endDate.toLocaleDateString() : 'Seleccionar Fecha'}
        </Text>
      </TouchableOpacity>
      <Text style={styles.label}>Hora de Fin</Text>
      <TouchableOpacity style={styles.dateButton} onPress={() => canEdit && showEndTimepicker()}>
        <Text style={styles.dateButtonText}>
          {endDate ? formatTime(endDate) : 'Seleccionar Hora'}
        </Text>
      </TouchableOpacity>
      {endPickerShow && (
        <DateTimePicker
          value={endDate || new Date()}
          mode={endPickerMode}
          display={Platform.OS === 'ios' ? 'spinner' : 'default'}
          is24Hour={true}
          onChange={onChangeEndPicker}
        />
      )}
      {endDate && (
        <TouchableOpacity style={styles.clearButton} onPress={clearEndDateTime}>
          <Text style={styles.clearButtonText}>Eliminar fecha/hora de Fin</Text>
        </TouchableOpacity>
      )}

      {/* VALOR MULTIPLICADOR */}
      <Text style={styles.label}>Valor multiplicador</Text>
      <TextInput
        style={styles.input}
        keyboardType="decimal-pad"
        value={multiplicativeValue}
        onChangeText={setMultiplicativeValue}
        editable={canEdit}
      />

      {/* ARCHIVOS ADJUNTOS */}
      <Text style={styles.label}>Archivos adjuntos</Text>
      <TextInput
        style={styles.input}
        value={attachedFiles}
        onChangeText={setAttachedFiles}
        editable={canEdit}
      />

      {/* BOTÃƒâ€œN ACTUALIZAR */}
      {canEdit && (
        <TouchableOpacity style={styles.buttonPrimary} onPress={handleUpdate} disabled={loading}>
          {loading ? (
            <ActivityIndicator color="#fff" />
          ) : (
            <Text style={styles.buttonText}>Actualizar</Text>
          )}
        </TouchableOpacity>
      )}

      {/* BOTÃƒâ€œN ELIMINAR */}
      {canDelete && (
        <TouchableOpacity style={styles.buttonDanger} onPress={handleDelete} disabled={loading}>
          {loading ? (
            <ActivityIndicator color="#fff" />
          ) : (
            <Text style={styles.buttonText}>Eliminar</Text>
          )}
        </TouchableOpacity>
      )}
    </ScrollView>
  );
}

const styles = StyleSheet.create({
  container: {
    padding: 16,
    backgroundColor: '#fff',
    flexGrow: 1,
  },
  label: {
    marginTop: 12,
    fontSize: 16,
    fontWeight: '600',
  },
  pickerContainer: {
    marginTop: 4,
    marginBottom: 8,
  },
  input: {
    borderWidth: 1,
    borderColor: '#ccc',
    borderRadius: 8,
    padding: 12,
    marginTop: 4,
    marginBottom: 8,
  },
  dateButton: {
    borderColor: '#ccc',
    borderWidth: 1,
    borderRadius: 8,
    padding: 12,
    marginBottom: 8,
  },
  dateButtonText: {
    color: '#555',
  },
  buttonPrimary: {
    marginTop: 20,
    backgroundColor: '#007BFF',
    padding: 16,
    borderRadius: 8,
    alignItems: 'center',
  },
  buttonDanger: {
    marginTop: 10,
    backgroundColor: '#dc3545',
    padding: 16,
    borderRadius: 8,
    alignItems: 'center',
  },
  buttonText: {
    color: '#fff',
    fontSize: 16,
    fontWeight: 'bold',
  },
  clearButton: {
    backgroundColor: '#dc3545',
    padding: 12,
    borderRadius: 8,
    alignItems: 'center',
    marginTop: 8,
    marginBottom: 8,
  },
  clearButtonText: {
    color: '#fff',
    fontSize: 14,
    fontWeight: 'bold',
  },
});

---
Folder: C:/Users/Mauri/Documents/GitHub/router/app/jobs
File: _layout.tsx
Content:
// C:/Users/Mauri/Documents/GitHub/router/app/jobs/_layout.tsx
import React from 'react';
import { Stack } from 'expo-router';

export default function JobsLayout() {
  return (
    <Stack>
      <Stack.Screen name="index" options={{ title: 'Trabajos' }} />
      <Stack.Screen name="create" options={{ title: 'Nueva Trabajo' }} />
      <Stack.Screen name="[id]" options={{ title: 'Editar Trabajo' }} />
    </Stack>
  );
}

---

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\jobs
File: [id].tsx
Content:
// C:/Users/Mauri/Documents/GitHub/router/app/jobs/[id].tsx
import React, { useState, useContext, useEffect, useMemo } from 'react';
import {
  Text,
  TextInput,
  TouchableOpacity,
  Alert,
  StyleSheet,
  ScrollView,
  Platform,
  ActivityIndicator,
  View
} from 'react-native';
import { useRouter, useLocalSearchParams } from 'expo-router';
import DateTimePicker from '@react-native-community/datetimepicker';
import { ModalPicker, ModalPickerItem } from '@/components/ModalPicker';

import { JobsContext } from '@/contexts/JobsContext';
import { PermissionsContext } from '@/contexts/PermissionsContext';
import { ClientsContext } from '@/contexts/ClientsContext';
import { FoldersContext } from '@/contexts/FoldersContext';
import { ProductsServicesContext } from '@/contexts/ProductsServicesContext';
import { StatusesContext, Status } from '@/contexts/StatusesContext';

export default function EditJobScreen() {
  const router = useRouter();
  const { id } = useLocalSearchParams<{ id: string }>();
  const jobId = Number(id);

  // Contextos
  const { jobs, updateJob, deleteJob } = useContext(JobsContext);
  const { permissions } = useContext(PermissionsContext);
  const { clients } = useContext(ClientsContext);
  const { folders } = useContext(FoldersContext);
  const { productsServices } = useContext(ProductsServicesContext);
  const { statuses, loadStatuses } = useContext(StatusesContext);

  // Buscamos el trabajo a editar
  const job = jobs.find((j) => j.id === jobId);

  // Permisos
  const canEdit = permissions.includes('updateJob');
  const canDelete = permissions.includes('deleteJob');

  // Estados para los selectores (usamos ModalPickerItem para tener toda la info)
  const [selectedClient, setSelectedClient] = useState<ModalPickerItem | null>(null);
  const [selectedFolder, setSelectedFolder] = useState<ModalPickerItem | null>(null);
  const [selectedProduct, setSelectedProduct] = useState<ModalPickerItem | null>(null);
  // Para el estado, se guarda el objeto completo y se usarÃ¡ su propiedad para mostrar color y label
  const [selectedStatus, setSelectedStatus] = useState<ModalPickerItem | null>(null);

  // Otros campos
  const [typeOfWork, setTypeOfWork] = useState<string>('');
  const [description, setDescription] = useState<string>('');
  const [multiplicativeValue, setMultiplicativeValue] = useState<string>('1.00');
  const [attachedFiles, setAttachedFiles] = useState<string>('');

  // Fechas
  const [startDate, setStartDate] = useState<Date | null>(null);
  const [endDate, setEndDate] = useState<Date | null>(null);

  // Control de pickers de fecha/hora
  const [startPickerShow, setStartPickerShow] = useState<boolean>(false);
  const [startPickerMode, setStartPickerMode] = useState<'date' | 'time'>('date');
  const [endPickerShow, setEndPickerShow] = useState<boolean>(false);
  const [endPickerMode, setEndPickerMode] = useState<'date' | 'time'>('date');

  const [loading, setLoading] = useState<boolean>(false);

  // Al cargar el componente, si no se encuentra el trabajo se vuelve atrÃ¡s;
  // ademÃ¡s, asignamos al estado cada campo usando la informaciÃ³n del trabajo.
  useEffect(() => {
    if (!job) {
      Alert.alert('Error', 'Trabajo no encontrado.');
      router.back();
      return;
    }

    // Cliente
    const clientObj = clients.find(c => c.id === job.client_id);
    setSelectedClient(clientObj ? { id: clientObj.id, name: clientObj.business_name } : null);

    // Carpeta
    const folderObj = folders.find(f => f.id === job.folder_id);
    setSelectedFolder(folderObj ? { id: folderObj.id, name: folderObj.name } : null);

    // Producto/Servicio
    const productObj = productsServices.find(ps => ps.id === job.product_service_id);
    setSelectedProduct(productObj ? { id: productObj.id, name: productObj.description } : null);

    // Estado: se asume que job.status es un string que contiene el id del estado.
    const statusIdNum = job.status ? parseInt(job.status) : null;
    const statusObj = statuses.find(s => s.id === statusIdNum);
    setSelectedStatus(statusObj ? { id: statusObj.id, name: statusObj.label, backgroundColor: statusObj.background_color } : null);

    // Otros campos
    setTypeOfWork(job.type_of_work || '');
    setDescription(job.description || '');
    setMultiplicativeValue(job.multiplicative_value.toString());
    setAttachedFiles(job.attached_files || '');

    // Fechas
    setStartDate(job.start_datetime ? parseDateTime(job.start_datetime) : null);
    setEndDate(job.end_datetime ? parseDateTime(job.end_datetime) : null);
  }, [job, clients, folders, productsServices, statuses]);

  // Cargar estados dinÃ¡micos al montar, en caso que no se hayan cargado
  useEffect(() => {
    loadStatuses();
  }, []);

  // Helpers: parse y formatea fechas
  function parseDateTime(datetimeString: string): Date {
    return new Date(datetimeString.replace(' ', 'T'));
  }
  function formatDateTime(date: Date): string {
    const pad = (n: number) => (n < 10 ? '0' + n : n);
    return `${date.getFullYear()}-${pad(date.getMonth() + 1)}-${pad(date.getDate())} ${pad(date.getHours())}:${pad(date.getMinutes())}:${pad(date.getSeconds())}`;
  }
  function formatTime(date: Date): string {
    const pad = (n: number) => (n < 10 ? '0' + n : n);
    return `${pad(date.getHours())}:${pad(date.getMinutes())}:${pad(date.getSeconds())}`;
  }

  // Funciones para pickers de inicio
  const showStartDatepicker = () => { setStartPickerMode('date'); setStartPickerShow(true); };
  const showStartTimepicker = () => { setStartPickerMode('time'); setStartPickerShow(true); };
  const onChangeStartPicker = (event: any, selectedDate?: Date) => {
    setStartPickerShow(false);
    if (selectedDate) {
      if (startPickerMode === 'date') {
        let hour: number, minute: number, second: number;
        if (startDate) {
          if (startDate.getHours() === 0 && startDate.getMinutes() === 0 && startDate.getSeconds() === 0) {
            const now = new Date();
            hour = now.getHours();
            minute = now.getMinutes();
            second = now.getSeconds();
          } else {
            hour = startDate.getHours();
            minute = startDate.getMinutes();
            second = startDate.getSeconds();
          }
        } else {
          const now = new Date();
          hour = now.getHours();
          minute = now.getMinutes();
          second = now.getSeconds();
        }
        const newDate = new Date(
          selectedDate.getFullYear(),
          selectedDate.getMonth(),
          selectedDate.getDate(),
          hour,
          minute,
          second
        );
        setStartDate(newDate);
      } else {
        if (startDate) {
          const newDate = new Date(
            startDate.getFullYear(),
            startDate.getMonth(),
            startDate.getDate(),
            selectedDate.getHours(),
            selectedDate.getMinutes(),
            selectedDate.getSeconds()
          );
          setStartDate(newDate);
        } else {
          const today = new Date();
          setStartDate(new Date(
            today.getFullYear(),
            today.getMonth(),
            today.getDate(),
            selectedDate.getHours(),
            selectedDate.getMinutes(),
            selectedDate.getSeconds()
          ));
        }
      }
    }
  };

  // Funciones para pickers de fin
  const showEndDatepicker = () => { setEndPickerMode('date'); setEndPickerShow(true); };
  const showEndTimepicker = () => { setEndPickerMode('time'); setEndPickerShow(true); };
  const onChangeEndPicker = (event: any, selectedDate?: Date) => {
    setEndPickerShow(false);
    if (selectedDate) {
      if (endPickerMode === 'date') {
        let hour: number, minute: number, second: number;
        if (endDate) {
          if (endDate.getHours() === 0 && endDate.getMinutes() === 0 && endDate.getSeconds() === 0) {
            const now = new Date();
            hour = now.getHours();
            minute = now.getMinutes();
            second = now.getSeconds();
          } else {
            hour = endDate.getHours();
            minute = endDate.getMinutes();
            second = endDate.getSeconds();
          }
        } else {
          const now = new Date();
          hour = now.getHours();
          minute = now.getMinutes();
          second = now.getSeconds();
        }
        const newDate = new Date(
          selectedDate.getFullYear(),
          selectedDate.getMonth(),
          selectedDate.getDate(),
          hour,
          minute,
          second
        );
        setEndDate(newDate);
      } else {
        if (endDate) {
          const newDate = new Date(
            endDate.getFullYear(),
            endDate.getMonth(),
            endDate.getDate(),
            selectedDate.getHours(),
            selectedDate.getMinutes(),
            selectedDate.getSeconds()
          );
          setEndDate(newDate);
        } else {
          const today = new Date();
          setEndDate(new Date(
            today.getFullYear(),
            today.getMonth(),
            today.getDate(),
            selectedDate.getHours(),
            selectedDate.getMinutes(),
            selectedDate.getSeconds()
          ));
        }
      }
    }
  };

  // Limpia fechas
  const clearStartDateTime = () => setStartDate(null);
  const clearEndDateTime = () => setEndDate(null);

  // PreparaciÃ³n de Ã­tems para los ModalPicker de cada selector
  const clientItems: ModalPickerItem[] = useMemo(() => 
    clients.map(c => ({ id: c.id, name: c.business_name })), [clients]);
  const folderItems: ModalPickerItem[] = useMemo(() =>
    folders.filter(f => selectedClient ? f.client_id === selectedClient.id : false)
      .map(f => ({ id: f.id, name: f.name })), [folders, selectedClient]);
  const productItems: ModalPickerItem[] = useMemo(() =>
    productsServices.map(ps => ({ id: ps.id, name: ps.description })), [productsServices]);
  const statusItems: ModalPickerItem[] = useMemo(() =>
    statuses.map(s => ({ id: s.id, name: s.label, backgroundColor: s.background_color })), [statuses]);

  // FunciÃ³n para enviar la actualizaciÃ³n
  const handleSubmit = async () => {
    if (!selectedClient || selectedStatus === null) {
      Alert.alert('Error', 'Por favor completa los campos obligatorios (Cliente y Estado).');
      return;
    }
    const startDatetime = startDate ? formatDateTime(startDate) : null;
    const endDatetime = endDate ? formatDateTime(endDate) : null;
  
    setLoading(true);
    const updated = await updateJob(jobId, {
      client_id: selectedClient ? Number(selectedClient.id) : null,
      product_service_id: selectedProduct ? Number(selectedProduct.id) : null,
      folder_id: selectedFolder ? Number(selectedFolder.id) : null,
      type_of_work: typeOfWork,
      description,
      // Se envÃ­a el id del estado convertido a string
      status: selectedStatus.id.toString(),
      start_datetime: startDatetime,
      end_datetime: endDatetime,
      multiplicative_value: parseFloat(multiplicativeValue),
      attached_files: attachedFiles || null,
    });
    setLoading(false);
    if (updated) {
      Alert.alert('Ã‰xito', 'Trabajo actualizado.');
      router.back();
    } else {
      Alert.alert('Error', 'No se pudo actualizar el trabajo.');
    }
  };

  // FunciÃ³n para eliminar el trabajo
  const handleDelete = () => {
    Alert.alert('Eliminar trabajo', 'Â¿Deseas eliminar este trabajo?', [
      { text: 'Cancelar', style: 'cancel' },
      {
        text: 'Eliminar',
        style: 'destructive',
        onPress: async () => {
          setLoading(true);
          const success = await deleteJob(jobId);
          setLoading(false);
          if (success) {
            Alert.alert('Ã‰xito', 'Trabajo eliminado.');
            router.back();
          } else {
            Alert.alert('Error', 'No se pudo eliminar el trabajo.');
          }
        },
      },
    ]);
  };

  return (
    <ScrollView contentContainerStyle={styles.container}>

      {/* ESTADO */}
      <Text style={styles.label}>Estado</Text>
      <View style={styles.pickerContainer}>
        <ModalPicker
          items={statusItems}
          selectedItem={selectedStatus}
          onSelect={(item: ModalPickerItem) => setSelectedStatus(item)}
          placeholder="-- Selecciona un Estado --"
        />
      </View>


      {/* TIPO DE TRABAJO */}
      <Text style={styles.label}>Trabajo</Text>
      <TextInput
        style={styles.input}
        value={typeOfWork}
        onChangeText={setTypeOfWork}
        editable={canEdit}
        placeholder="Ej: ReparaciÃ³n de equipo, etc."
      />

      {/* DESCRIPCIÃ“N */}
      <Text style={styles.label}>DescripciÃ³n</Text>
      <TextInput
        style={[styles.input, { height: 80 }]}
        multiline
        value={description}
        onChangeText={setDescription}
        editable={canEdit}
        placeholder="Describe este trabajo"
      />

      {/* CLIENTE */}
      <Text style={styles.label}>Cliente *</Text>
      <View style={styles.pickerContainer}>
        <ModalPicker
          items={clientItems}
          selectedItem={selectedClient}
          onSelect={setSelectedClient}
          placeholder="-- Selecciona un Cliente --"
        />
      </View>

      {/* CARPETA */}
      <Text style={styles.label}>Carpeta</Text>
      <View style={styles.pickerContainer}>
        <ModalPicker
          items={folderItems}
          selectedItem={selectedFolder}
          onSelect={setSelectedFolder}
          placeholder="-- Sin carpeta --"
        />
      </View>

      {/* PRODUCTO/SERVICIO */}
      <Text style={styles.label}>Producto/Servicio</Text>
      <View style={styles.pickerContainer}>
        <ModalPicker
          items={productItems}
          selectedItem={selectedProduct}
          onSelect={setSelectedProduct}
          placeholder="-- Ninguno --"
        />
      </View>

      {/* FECHAS Y HORAS - INICIO */}
      <Text style={styles.label}>Fecha de Inicio</Text>
      <TouchableOpacity style={[styles.dateButton, { marginBottom: 6 }]} onPress={() => canEdit && showStartDatepicker()}>
        <Text style={styles.dateButtonText}>
          {startDate ? startDate.toLocaleDateString() : 'Seleccionar Fecha'}
        </Text>
      </TouchableOpacity>
      <Text style={styles.label}>Hora de Inicio</Text>
      <TouchableOpacity style={[styles.dateButton, { marginBottom: 6 }]} onPress={() => canEdit && showStartTimepicker()}>
        <Text style={styles.dateButtonText}>
          {startDate ? formatTime(startDate) : 'Seleccionar Hora'}
        </Text>
      </TouchableOpacity>
      {startPickerShow && (
        <DateTimePicker
          value={startDate || new Date()}
          mode={startPickerMode}
          display={Platform.OS === 'ios' ? 'spinner' : 'default'}
          is24Hour
          onChange={onChangeStartPicker}
        />
      )}
      {startDate && (
        <TouchableOpacity style={styles.clearButton} onPress={clearStartDateTime}>
          <Text style={styles.clearButtonText}>Eliminar fecha/hora de Inicio</Text>
        </TouchableOpacity>
      )}

      {/* FECHAS Y HORAS - FIN */}
      <Text style={styles.label}>Fecha de Fin</Text>
      <TouchableOpacity style={[styles.dateButton, { marginBottom: 6 }]} onPress={() => canEdit && showEndDatepicker()}>
        <Text style={styles.dateButtonText}>
          {endDate ? endDate.toLocaleDateString() : 'Seleccionar Fecha'}
        </Text>
      </TouchableOpacity>
      <Text style={styles.label}>Hora de Fin</Text>
      <TouchableOpacity style={[styles.dateButton, { marginBottom: 6 }]} onPress={() => canEdit && showEndTimepicker()}>
        <Text style={styles.dateButtonText}>
          {endDate ? formatTime(endDate) : 'Seleccionar Hora'}
        </Text>
      </TouchableOpacity>
      {endPickerShow && (
        <DateTimePicker
          value={endDate || new Date()}
          mode={endPickerMode}
          display={Platform.OS === 'ios' ? 'spinner' : 'default'}
          is24Hour
          onChange={onChangeEndPicker}
        />
      )}
      {endDate && (
        <TouchableOpacity style={styles.clearButton} onPress={clearEndDateTime}>
          <Text style={styles.clearButtonText}>Eliminar fecha/hora de Fin</Text>
        </TouchableOpacity>
      )}

      {/* VALOR MULTIPLICADOR */}
      <Text style={styles.label}>Valor multiplicador</Text>
      <TextInput
        style={styles.input}
        keyboardType="decimal-pad"
        value={multiplicativeValue}
        onChangeText={setMultiplicativeValue}
        editable={canEdit}
      />

      {/* ARCHIVOS ADJUNTOS */}
      <Text style={styles.label}>Archivos adjuntos (URL o texto)</Text>
      <TextInput
        style={styles.input}
        value={attachedFiles}
        onChangeText={setAttachedFiles}
        placeholder="Ej: https://archivo.pdf"
        editable={canEdit}
      />

      {/* BOTÃ“N ACTUALIZAR */}
      {canEdit && (
        <TouchableOpacity style={styles.buttonPrimary} onPress={handleSubmit} disabled={loading}>
          {loading ? (
            <ActivityIndicator color="#fff" />
          ) : (
            <Text style={styles.buttonText}>Actualizar</Text>
          )}
        </TouchableOpacity>
      )}

      {/* BOTÃ“N ELIMINAR */}
      {canDelete && (
        <TouchableOpacity style={styles.buttonDanger} onPress={handleDelete} disabled={loading}>
          {loading ? (
            <ActivityIndicator color="#fff" />
          ) : (
            <Text style={styles.buttonText}>Eliminar</Text>
          )}
        </TouchableOpacity>
      )}
    </ScrollView>
  );
}

const styles = StyleSheet.create({
  container: { padding: 16, backgroundColor: '#fff', flexGrow: 1 },
  label: { marginVertical: 8, fontSize: 16, fontWeight: '600' },
  pickerContainer: { marginTop: 4, marginBottom: 8 },
  input: { borderWidth: 1, borderColor: '#ccc', borderRadius: 8, padding: 12, marginVertical: 4, backgroundColor: '#fff' },
  dateButton: { borderWidth: 1, borderColor: '#ccc', borderRadius: 8, padding: 12, marginBottom: 8 },
  dateButtonText: { color: '#555' },
  buttonPrimary: { marginTop: 20, backgroundColor: '#007BFF', padding: 16, borderRadius: 8, alignItems: 'center' },
  buttonDanger: { marginTop: 10, backgroundColor: '#dc3545', padding: 16, borderRadius: 8, alignItems: 'center' },
  buttonText: { color: '#fff', fontSize: 16, fontWeight: 'bold' },
  clearButton: { backgroundColor: '#dc3545', padding: 12, borderRadius: 8, alignItems: 'center', marginVertical: 8 },
  clearButtonText: { color: '#fff', fontSize: 14, fontWeight: 'bold' },
  // Preview de estado
  statusPreview: {
    paddingVertical: 4,
    paddingHorizontal: 8,
    borderRadius: 4,
    alignSelf: 'flex-start',
    marginTop: 4,
  },
  statusPreviewText: { color: '#fff', fontSize: 12, fontWeight: 'bold' },
});

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\jobs
File: _layout.tsx
Content:
// C:/Users/Mauri/Documents/GitHub/router/app/jobs/_layout.tsx
import React from 'react';
import { Stack } from 'expo-router';

export default function JobsLayout() {
  return (
    <Stack>
      <Stack.Screen name="index" options={{ title: 'Trabajos' }} />
      <Stack.Screen name="create" options={{ title: 'Nueva Trabajo' }} />
      <Stack.Screen name="[id]" options={{ title: 'Editar Trabajo' }} />
    </Stack>
  );
}

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\login
File: ForgotPassword.tsx
Content:
// app/login/ForgotPassword.tsx
import React, { useState } from 'react';
import { View, TextInput, Button, Alert, StyleSheet } from 'react-native';
import { useRouter } from 'expo-router';
import { BASE_URL } from '@/config/Index';
import globalStyles from '@/styles/GlobalStyles';

const ForgotPassword: React.FC = () => {
  const router = useRouter();
  const [email, setEmail] = useState('');

  const handleForgotPassword = async () => {
    if (!email) {
      Alert.alert('Error', 'Por favor ingresa tu email');
      return;
    }
    try {
      const response = await fetch(`${BASE_URL}/forgot_password`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email }),
      });
      const result = await response.json();
      if (response.ok) {
        Alert.alert('Ã‰xito', result.message || 'Email de recuperaciÃ³n enviado');
        router.back();
      } else {
        Alert.alert('Error', result.error || 'Error al enviar la solicitud');
      }
    } catch (error: any) {
      Alert.alert('Error', error.message);
    }
  };

  return (
    <View style={globalStyles.container}>
      <TextInput
        placeholder="Ingresa tu email"
        style={globalStyles.input}
        value={email}
        keyboardType="email-address"
        onChangeText={setEmail}
      />
      <Button title="Enviar recuperaciÃ³n" onPress={handleForgotPassword} />
    </View>
  );
};

export default ForgotPassword;

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\login
File: Login.tsx
Content:
import React, { useState, useContext } from 'react';
import { View, TextInput, Button, Alert, TouchableOpacity, StyleSheet } from 'react-native';
import { Ionicons } from '@expo/vector-icons';
import { useRouter } from 'expo-router';
import { AuthContext } from '@/contexts/AuthContext';
import globalStyles from '@/styles/GlobalStyles';

const Login: React.FC = () => {
  const { login } = useContext(AuthContext);
  const router = useRouter();
  const [username, setUsername] = useState('');
  const [password, setPassword] = useState('');
  const [showPassword, setShowPassword] = useState(false);

  const handleLogin = async () => {
    if (!username || !password) {
      Alert.alert('Error', 'Ingresa username y contraseÃ±a');
      return;
    }
    await login(username, password);
    router.replace('./');
  };

  return (
    <View style={globalStyles.container}>
      <TextInput
        style={globalStyles.input}
        placeholder="Username"
        value={username}
        onChangeText={setUsername}
      />
      <View style={localStyles.passwordContainer}>
        <TextInput
          style={[globalStyles.input, localStyles.passwordInput]}
          placeholder="ContraseÃ±a"
          secureTextEntry={!showPassword}
          value={password}
          onChangeText={setPassword}
        />
        <TouchableOpacity 
          onPress={() => setShowPassword(prev => !prev)}
          style={localStyles.eyeIcon}
        >
          <Ionicons name={showPassword ? 'eye-off' : 'eye'} size={24} color="gray" />
        </TouchableOpacity>
      </View>
      <View style={globalStyles.button}>
        <Button title="Ingresar" onPress={handleLogin} />
      </View>
      <View style={globalStyles.button}>
        <Button title="Registrarse" onPress={() => router.push('/login/Register')} />
      </View>
      <View style={globalStyles.button}>
        <Button title="OlvidÃ© mi contraseÃ±a" onPress={() => router.push('/login/ForgotPassword')} />
      </View>
    </View>
  );
};

const localStyles = StyleSheet.create({
  passwordContainer: {
    position: 'relative',
    flexDirection: 'row',
    alignItems: 'center',
  },
  passwordInput: {
    flex: 1,
    marginBottom: 0,
  },
  eyeIcon: {
    position: 'absolute',
    right: 10,
  },
});

export default Login;

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\login
File: Register.tsx
Content:
import React, { useState } from 'react';
import { View, TextInput, Button, Alert, StyleSheet, TouchableOpacity } from 'react-native';
import { Ionicons } from '@expo/vector-icons';
import { useRouter } from 'expo-router';
import { BASE_URL } from '@/config/Index';
import globalStyles from '@/styles/GlobalStyles';

const Register: React.FC = () => {
  const router = useRouter();
  const [username, setUsername] = useState('');
  const [email, setEmail] = useState('@gmail.com');
  const [password, setPassword] = useState('');
  const [showPassword, setShowPassword] = useState(false);

  const isValidPassword = (password: string): boolean => {
    return /^(?=.*[A-Z])(?=.*\d).{8,}$/.test(password);
  };

  const handleRegister = async () => {
    if (!username || !email || !password) {
      Alert.alert('Error', 'Todos los campos son requeridos');
      return;
    }
    if (!isValidPassword(password)) {
      Alert.alert('Error', 'La contraseÃ±a debe tener al menos 8 caracteres, una mayÃºscula y un nÃºmero.');
      return;
    }
    try {
      const response = await fetch(`${BASE_URL}/register`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, email, password }),
      });
      const result = await response.json();
      if (response.ok) {
        Alert.alert('Ã‰xito', result.message || 'Usuario registrado. Revisa tu email para activar la cuenta.');
        router.back();
      } else {
        Alert.alert('Error', result.error || 'Error en el registro');
      }
    } catch (error: any) {
      Alert.alert('Error', error.message);
    }
  };

  return (
    <View style={globalStyles.container}>
      <TextInput
        placeholder="Nombre de usuario"
        style={globalStyles.input}
        value={username}
        onChangeText={setUsername}
      />
      <TextInput
        placeholder="Correo electrÃ³nico"
        style={globalStyles.input}
        value={email}
        keyboardType="email-address"
        onChangeText={setEmail}
      />
      <View style={globalStyles.passwordContainer}>
        <TextInput
          placeholder="ContraseÃ±a"
          secureTextEntry={!showPassword}
          style={[globalStyles.input, globalStyles.passwordInput]}
          value={password}
          onChangeText={setPassword}
        />
        <TouchableOpacity 
          onPress={() => setShowPassword(prev => !prev)}
          style={globalStyles.eyeIcon}
        >
          <Ionicons name={showPassword ? 'eye-off' : 'eye'} size={24} color="gray" />
        </TouchableOpacity>
      </View>
      <View style={globalStyles.button}>
        <Button title="Registrar" onPress={handleRegister} />
      </View>

    </View>
  );
};

export default Register;

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\login
File: UserStatus.tsx
Content:
// app/login/EstadoUsuario.tsx
import React, { useContext } from 'react';
import { View, Text, Button, ActivityIndicator, StyleSheet } from 'react-native';
import { AuthContext } from '@/contexts/AuthContext';

const EstadoUsuario: React.FC = () => {
  const { userId, isLoading, logout } = useContext(AuthContext);

  if (isLoading) {
    return (
      <View style={styles.center}>
        <ActivityIndicator size="large" />
      </View>
    );
  }

  return (
    <View style={styles.container}>
      {userId ? (
        <>
          <Text style={styles.text}>Bienvenido, tu ID de usuario es: {userId}</Text>
          <Button title="Cerrar sesiÃ³n" onPress={logout} />
        </>
      ) : (
        <Text style={styles.text}>No hay usuario autenticado</Text>
      )}
    </View>
  );
};

export default EstadoUsuario;

const styles = StyleSheet.create({
  container: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
    padding: 20,
  },
  center: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
  },
  text: {
    fontSize: 18,
    marginBottom: 20,
  },
});

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\login
File: _layout.tsx
Content:
import React from 'react';
import { Stack } from 'expo-router';

export default function LoginLayout() {
  return (
    <Stack>
      <Stack.Screen name="Login" options={{ title: 'Iniciar SesiÃ³n' }} />
      <Stack.Screen name="Register" options={{ title: 'Registrate' }} />
      <Stack.Screen name="ForgotPassword" options={{ title: 'Recuperar ContraseÃ±a' }} />
    </Stack>
  );
}

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\permission
File: PermissionScreen.tsx
Content:
import React, { useState, useEffect, useContext, useCallback } from 'react';
import { View, Text, ScrollView, StyleSheet, Alert, ActivityIndicator } from 'react-native';
import Checkbox from 'expo-checkbox';
import UserSelector from './UserSelector'; // AsegÃºrate de que la ruta sea correcta
import { AuthContext } from '@/contexts/AuthContext';
import { BASE_URL } from '@/config/Index';

// DefiniciÃ³n de grupos de permisos. Cada grupo contiene una lista de "sectors" (cadenas que representan los permisos)
const PERMISSION_GROUPS = [
  { group: "Permissions", permissions: ['listGlobalPermissions','listPermissionsByUser','listPermissions', 'addPermission', 'deletePermission','listAllProfiles'] },
  { group: "Files", permissions: ['uploadFile', 'downloadFile'] },
  { group: "Clients", permissions: ['getClient', 'addClient', 'updateClient', 'deleteClient', 'listClients'] },
  { group: "Folders", permissions: ['listFolders', 'getFolder', 'addFolder', 'updateFolder', 'deleteFolder', 'listFolderHistory', 'listFoldersByClient'] },
  { group: "Cash Boxes", permissions: ['listCashBoxes', 'getCashBox', 'addCashBox', 'updateCashBox', 'deleteCashBox', 'listCashBoxHistory'] },
  { group: "Sales", permissions: ['listSales', 'getSale', 'addSale', 'updateSale', 'deleteSale', 'listSaleHistory'] },
  { group: "Products / Services", permissions: ['listProductsServices', 'getProductService', 'addProductService', 'updateProductService', 'deleteProductService', 'listProductServiceHistory'] },
  { group: "Jobs", permissions: ['listJobs', 'getJob', 'addJob', 'updateJob', 'deleteJob', 'listJobHistory'] },
  { group: "Expenses", permissions: ['listExpenses', 'getExpense', 'addExpense', 'updateExpense', 'deleteExpense', 'listExpenseHistory'] },
  { group: "Appointments", permissions: ['listAppointments', 'getAppointment', 'addAppointment', 'updateAppointment', 'deleteAppointment', 'listAppointmentHistory'] },
  { group: "Accounting Closings", permissions: ['listClosings', 'getClosing', 'addClosing', 'updateClosing', 'deleteClosing', 'listClosingHistory'] },
  { group: "User Profile", permissions: ['listUserProfiles', 'getUserProfile', 'addUserProfile'] },
  { group: "User Configurations", permissions: ['listUserConfigurations', 'getUserConfigurations', 'addUserConfigurations'] },
  { group: "Statuses", permissions: ['listStatuses', 'getStatus', 'addStatus', 'updateStatus', 'deleteStatus', 'reorderStatuses'] },
];

interface AssignedPermission {
  id: number;
  sector: string;
}

const PermissionScreen: React.FC = () => {
  const { token } = useContext(AuthContext);
  const [selectedUser, setSelectedUser] = useState<{ id: number; username: string } | null>(null);
  const [assignedPermissions, setAssignedPermissions] = useState<Record<string, AssignedPermission>>({});
  const [loading, setLoading] = useState(false);

  // FunciÃ³n para cargar permisos del usuario seleccionado (o global si id === 0)
  const loadPermissions = useCallback(() => {
    if (!token || selectedUser === null) return;
    setLoading(true);
    const url = selectedUser.id === 0 
      ? `${BASE_URL}/permissions/global` 
      : `${BASE_URL}/permissions/user/${selectedUser.id}`;

    return fetch(url, {
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      }
    })
      .then(res => res.json())
      .then(data => {
        const permissionsMap: Record<string, AssignedPermission> = {};
        data.permissions.forEach((perm: AssignedPermission) => {
          permissionsMap[perm.sector] = perm;
        });
        setAssignedPermissions(permissionsMap);
      })
      .catch(err => {
        console.error('Error loading permissions:', err);
        Alert.alert('Error', 'No se pudieron cargar los permisos.');
      })
      .finally(() => setLoading(false));
  }, [token, selectedUser]);

  useEffect(() => {
    if (selectedUser) {
      loadPermissions();
    } else {
      setAssignedPermissions({});
    }
  }, [selectedUser, loadPermissions]);

  // FunciÃ³n para agregar un permiso; se retorna la promesa
  const addPermission = (sector: string) => {
    if (!token || selectedUser === null) return Promise.resolve();
    const bodyData: any = { sector };
  
    if (selectedUser.id !== 0) {
      bodyData.user_id = selectedUser.id;
    }
  
    return fetch(`${BASE_URL}/permissions`, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(bodyData),
    })
      .then(res => res.json())
      .then(data => {
        if (data.id) {
          setAssignedPermissions(prev => ({
            ...prev,
            [sector]: { id: data.id, sector }
          }));
        }
      })
      .catch(err => {
        console.error(`Error adding permission ${sector}:`, err);
        Alert.alert('Error', `No se pudo agregar el permiso ${sector}`);
      });
  };
  
  // FunciÃ³n para eliminar un permiso; se retorna la promesa
  const removePermission = (sector: string) => {
    if (!token || selectedUser === null) return Promise.resolve();
    const perm = assignedPermissions[sector];
    if (!perm) return Promise.resolve();
    return fetch(`${BASE_URL}/permissions/${perm.id}`, {
      method: 'DELETE',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      },
    })
      .then(async res => {
        const text = await res.text();
        return text ? JSON.parse(text) : {};
      })
      .then(() => {
        setAssignedPermissions(prev => {
          const newPerms = { ...prev };
          delete newPerms[sector];
          return newPerms;
        });
      })
      .catch(err => {
        console.error(`Error deleting permission ${sector}:`, err);
        Alert.alert('Error', `No se pudo eliminar el permiso ${sector}`);
      });
  };

  // Actualiza el estado de forma optimista y luego llama a la API,
  // y finalmente recarga la lista de permisos.
  const togglePermission = (sector: string, value: boolean) => {
    // ActualizaciÃ³n optimista: actualizamos el estado de inmediato
    setAssignedPermissions(prev => {
      const newState = { ...prev };
      if (value) {
        newState[sector] = { id: -Date.now(), sector }; // id temporal
      } else {
        delete newState[sector];
      }
      return newState;
    });

    // Luego se realiza la llamada a la API y se refresca la lista
    if (value) {
      addPermission(sector).then(() => loadPermissions());
    } else {
      removePermission(sector).then(() => loadPermissions());
    }
  };

  const toggleGroup = (groupPermissions: string[], value: boolean) => {
    groupPermissions.forEach(sector => {
      const isAssigned = !!assignedPermissions[sector];
      if (value && !isAssigned) {
        togglePermission(sector, true);
      } else if (!value && isAssigned) {
        togglePermission(sector, false);
      }
    });
  };

  const isGroupChecked = (groupPermissions: string[]) => {
    return groupPermissions.every(sector => !!assignedPermissions[sector]);
  };

  return (
    <ScrollView style={styles.container}>
      <Text style={styles.title}>AdministraciÃ³n de Permisos</Text>
      <UserSelector onSelect={(user) => {
        if (user) {
          setSelectedUser({ id: user.id, username: user.username });
        } else {
          setSelectedUser({ id: 0, username: 'Global' }); // <-- Nunca mÃ¡s null
        }
      }} />

      
      {selectedUser ? (
        loading ? (
          <ActivityIndicator size="large" color="#007BFF" />
        ) : (
          PERMISSION_GROUPS.map(group => (
            <View key={group.group} style={styles.groupContainer}>
              <View style={styles.groupHeader}>
                <Checkbox
                  value={isGroupChecked(group.permissions)}
                  onValueChange={(value) => toggleGroup(group.permissions, value)}
                  style={styles.checkbox}
                />
                <Text style={styles.groupTitle}>{group.group}</Text>
              </View>
              {group.permissions.map(sector => (
                <View key={sector} style={styles.permissionRow}>
                  <Checkbox
                    value={!!assignedPermissions[sector]}
                    onValueChange={(value) => togglePermission(sector, value)}
                    style={styles.checkbox}
                  />
                  <Text style={styles.permissionLabel}>{sector}</Text>
                </View>
              ))}
            </View>
          ))
        )
      ) : (
        <Text style={styles.infoText}>Selecciona un usuario o Global para administrar permisos.</Text>
      )}
    </ScrollView>
  );
};

export default PermissionScreen;

const styles = StyleSheet.create({
  container: {
    flex: 1,
    padding: 20,
    backgroundColor: '#fff'
  },
  title: {
    fontSize: 26,
    fontWeight: 'bold',
    textAlign: 'center',
    marginBottom: 20
  },
  infoText: {
    fontSize: 16,
    textAlign: 'center',
    marginTop: 20
  },
  groupContainer: {
    marginBottom: 20,
    borderWidth: 1,
    borderColor: '#ddd',
    borderRadius: 8,
    padding: 10,
    backgroundColor: '#f9f9f9'
  },
  groupHeader: {
    flexDirection: 'row',
    alignItems: 'center',
    marginBottom: 10
  },
  groupTitle: {
    fontSize: 18,
    fontWeight: 'bold',
    marginLeft: 8
  },
  permissionRow: {
    flexDirection: 'row',
    alignItems: 'center',
    marginBottom: 5,
    marginLeft: 20
  },
  permissionLabel: {
    fontSize: 16,
    marginLeft: 8
  },
  checkbox: {
    marginRight: 8,
  },
});

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\permission
File: UserSelector.tsx
Content:
import React, { useEffect, useState, useContext } from 'react';
import { View, Text, StyleSheet, TouchableOpacity, Modal, FlatList, Pressable } from 'react-native';
import { AuthContext } from '@/contexts/AuthContext';
import { BASE_URL } from '@/config/Index';

interface Profile {
  id: number;
  username: string;
  email: string;
  activated: number;
}

interface UserSelectorProps {
  onSelect: (user: Profile | null) => void;
}

const UserSelector: React.FC<UserSelectorProps> = ({ onSelect }) => {
  const { token } = useContext(AuthContext);
  const [profiles, setProfiles] = useState<Profile[]>([]);
  const [selectedProfile, setSelectedProfile] = useState<Profile | null>(null);
  const [modalVisible, setModalVisible] = useState(false);

  useEffect(() => {
    if (!token) return;

    fetch(`${BASE_URL}/profiles`, {
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      }
    })
      .then(response => response.json())
      .then(data => {
        const globalOption: Profile = {
          id: 0,
          username: 'Global',
          email: '',
          activated: 1,
        };
        const fetchedProfiles = data.profiles.map((profile: any) => ({
          ...profile,
          id: Number(profile.id),
        }));
        setProfiles([globalOption, ...fetchedProfiles]);
      })
      .catch(error => {
        console.error('Error fetching profiles:', error);
      });
  }, [token]);

  const handleSelect = (profile: Profile) => {
    setSelectedProfile(profile);
    setModalVisible(false);
    onSelect(profile.id === 0 ? null : profile);
  };

  return (
    <View style={styles.container}>
      <Text style={styles.label}>Selecciona un usuario:</Text>
      <TouchableOpacity style={styles.selector} onPress={() => setModalVisible(true)}>
        <Text>{selectedProfile ? selectedProfile.username : 'Elegir usuario...'}</Text>
      </TouchableOpacity>

      <Modal visible={modalVisible} animationType="slide" transparent>
        <View style={styles.modalContainer}>
          <View style={styles.modalContent}>
            <FlatList
              data={profiles}
              keyExtractor={item => item.id.toString()}
              renderItem={({ item }) => (
                <Pressable onPress={() => handleSelect(item)} style={styles.item}>
                  <Text>{item.username}</Text>
                </Pressable>
              )}
            />
            <TouchableOpacity onPress={() => setModalVisible(false)} style={styles.cancelButton}>
              <Text style={{ color: 'white' }}>Cancelar</Text>
            </TouchableOpacity>
          </View>
        </View>
      </Modal>
    </View>
  );
};

const styles = StyleSheet.create({
  container: {
    marginVertical: 10,
  },
  label: {
    fontSize: 16,
    marginBottom: 5,
  },
  selector: {
    borderWidth: 1,
    borderColor: '#ccc',
    padding: 10,
    borderRadius: 5,
  },
  modalContainer: {
    flex: 1,
    backgroundColor: '#000000aa',
    justifyContent: 'center',
  },
  modalContent: {
    marginHorizontal: 30,
    backgroundColor: 'white',
    padding: 20,
    borderRadius: 10,
    maxHeight: '70%',
  },
  item: {
    paddingVertical: 10,
  },
  cancelButton: {
    marginTop: 10,
    backgroundColor: '#444',
    padding: 10,
    borderRadius: 5,
    alignItems: 'center',
  }
});

export default UserSelector;

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\permission
File: _layout.tsx
Content:
import React from 'react';
import { Stack } from 'expo-router';

export default function PermissionLayout() {
  return (
    <Stack>
      <Stack.Screen name="PermissionScreen" />
    </Stack>
  );
}

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\products_services
File: create.tsx
Content:
// C:/Users/Mauri/Documents/GitHub/router/app/products_services/create.tsx
import React, { useState, useContext, useEffect } from 'react';
import { View, Text, TextInput, TouchableOpacity, StyleSheet, ScrollView, Alert, ActivityIndicator } from 'react-native';
import { useRouter } from 'expo-router';
import { ProductsServicesContext } from '@/contexts/ProductsServicesContext';
import { PermissionsContext } from '@/contexts/PermissionsContext';
import CircleImagePicker from '@/components/CircleImagePicker';

export default function CreateProductService() {
  const router = useRouter();
  const { addProductService, loadProductsServices } = useContext(ProductsServicesContext);
  const { permissions } = useContext(PermissionsContext);

  const [description, setDescription] = useState('');
  const [category, setCategory] = useState('');
  const [price, setPrice] = useState('');
  const [cost, setCost] = useState('');
  const [difficulty, setDifficulty] = useState('');
  const [itemType, setItemType] = useState<'product' | 'service'>('product');
  const [stock, setStock] = useState('');
  const [productImageFileId, setProductImageFileId] = useState<string | null>(null);
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    if (!permissions.includes('addProductService')) {
      Alert.alert('Acceso denegado', 'No tienes permiso para crear productos o servicios.');
      router.back();
    }
  }, [permissions]);

  const handleSubmit = async () => {
  /*  if (!description || !category || !price || !cost || !difficulty || !itemType) {
      Alert.alert('Error', 'Por favor completa todos los campos obligatorios.');
      return;
    }*/
    setLoading(true);
    const newItem = await addProductService({
      description,
      category,
      price: parseFloat(price),
      cost: parseFloat(cost),
      difficulty,
      item_type: itemType,
      stock: stock ? parseInt(stock) : null,
      product_image_file_id: productImageFileId,
    });
    await loadProductsServices();
    setLoading(false);
    if (newItem) {
      Alert.alert('Ã‰xito', 'Producto/servicio creado correctamente.');
      router.back();
    } else {
      Alert.alert('Error', 'No se pudo crear el producto/servicio.');
    }
  };

  return (
    <ScrollView contentContainerStyle={styles.container}>
      <Text style={styles.label}>Imagen</Text>
      <CircleImagePicker 
        fileId={productImageFileId} 
        editable={true} 
        size={200} 
        onImageChange={setProductImageFileId} 
      />

      <Text style={styles.label}>DescripciÃ³n</Text>
      <TextInput style={styles.input} value={description} onChangeText={setDescription} placeholder="DescripciÃ³n" />

      <Text style={styles.label}>CategorÃ­a</Text>
      <TextInput style={styles.input} value={category} onChangeText={setCategory} placeholder="CategorÃ­a" />

      <Text style={styles.label}>Precio</Text>
      <TextInput style={styles.input} keyboardType="decimal-pad" value={price} onChangeText={setPrice} placeholder="Precio" />

      <Text style={styles.label}>Costo</Text>
      <TextInput style={styles.input} keyboardType="decimal-pad" value={cost} onChangeText={setCost} placeholder="Costo" />

      <Text style={styles.label}>Dificultad</Text>
      <TextInput style={styles.input} value={difficulty} onChangeText={setDifficulty} placeholder="Dificultad" />

      <Text style={styles.label}>Tipo</Text>
      <View style={styles.row}>
        <TouchableOpacity onPress={() => setItemType('product')} style={[styles.radio, itemType === 'product' && styles.radioSelected]}><Text>Producto</Text></TouchableOpacity>
        <TouchableOpacity onPress={() => setItemType('service')} style={[styles.radio, itemType === 'service' && styles.radioSelected]}><Text>Servicio</Text></TouchableOpacity>
      </View>

      <Text style={styles.label}>Stock (opcional)</Text>
      <TextInput style={styles.input} keyboardType="numeric" value={stock} onChangeText={setStock} placeholder="Stock disponible" />

      <TouchableOpacity style={styles.submitButton} onPress={handleSubmit} disabled={loading}>
        {loading ? <ActivityIndicator color="#fff" /> : <Text style={styles.submitButtonText}>Crear</Text>}
      </TouchableOpacity>
    </ScrollView>
  );
}

const styles = StyleSheet.create({
  container: { padding: 16, backgroundColor: '#fff' },
  label: { marginVertical: 8, fontSize: 16 },
  input: { borderWidth: 1, borderColor: '#ccc', borderRadius: 8, padding: 12, marginBottom: 8 },
  row: { flexDirection: 'row', gap: 16, marginVertical: 8 },
  radio: { padding: 10, borderRadius: 8, borderWidth: 1, borderColor: '#007BFF' },
  radioSelected: { backgroundColor: '#007BFF22' },
  submitButton: { marginTop: 16, backgroundColor: '#28a745', padding: 16, borderRadius: 8, alignItems: 'center' },
  submitButtonText: { color: '#fff', fontSize: 16, fontWeight: 'bold' },
});
---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\products_services
File: index.tsx
Content:
// C:/Users/Mauri/Documents/GitHub/router/app/products_services/index.tsx
import React, { useContext, useState, useMemo, useEffect } from 'react';
import { View, Text, FlatList, TouchableOpacity, TextInput, StyleSheet, ActivityIndicator, Alert } from 'react-native';
import { useRouter } from 'expo-router';
import Fuse from 'fuse.js';
import CircleImagePicker from '@/components/CircleImagePicker';
import { PermissionsContext } from '@/contexts/PermissionsContext';
import { ProductsServicesContext, ProductService } from '@/contexts/ProductsServicesContext';

export default function ProductsServicesScreen() {
  const { productsServices, loadProductsServices, deleteProductService } = useContext(ProductsServicesContext);
  const { permissions } = useContext(PermissionsContext);
  const router = useRouter();
  const [searchQuery, setSearchQuery] = useState('');
  const [loadingId, setLoadingId] = useState<number | null>(null);

  useEffect(() => {
    if (!permissions.includes('listProductsServices')) {
      Alert.alert('Acceso denegado', 'No tienes permiso para ver productos y servicios.');
      router.back();
    } else {
      loadProductsServices();
    }
  }, [permissions]);

  const fuse = new Fuse(productsServices, { keys: ['description', 'category'] });
  const filteredItems = useMemo(() => {
    if (!searchQuery) return productsServices;
    const results = fuse.search(searchQuery);
    return results.map(result => result.item);
  }, [searchQuery, productsServices]);

  const canDelete = permissions.includes('deleteProductService');

  const handleDelete = (id: number) => {
    Alert.alert(
      'Confirmar eliminaciÃ³n',
      'Â¿EstÃ¡s seguro de que deseas eliminar este Ã­tem?',
      [
        { text: 'Cancelar', style: 'cancel' },
        {
          text: 'Eliminar',
          style: 'destructive',
          onPress: async () => {
            setLoadingId(id);
            const success = await deleteProductService(id);
            setLoadingId(null);
            if (!success) {
              Alert.alert('Error', 'No se pudo eliminar el producto/servicio');
            }
          }
        }
      ]
    );
  };

  const renderItem = ({ item }: { item: ProductService }) => (
    <TouchableOpacity style={styles.itemContainer} onLongPress={() => router.push(`./products_services/${item.id}`)}>
      <CircleImagePicker fileId={item.product_image_file_id} size={50} />
      <View style={styles.itemInfo}>
        <Text style={styles.itemTitle}>{item.description}</Text>
        {/*<Text>{item.category}</Text>*/}
        <Text>${item.price}</Text>
      </View>
      {canDelete && (
        <TouchableOpacity style={styles.deleteButton} onPress={() => handleDelete(item.id)}>
          {loadingId === item.id ? <ActivityIndicator /> : <Text style={styles.deleteText}>ðŸ—‘</Text>}
        </TouchableOpacity>
      )}
    </TouchableOpacity>
  );

  return (
    <View style={styles.container}>
      <TextInput
        placeholder="Buscar producto o servicio..."
        style={styles.searchInput}
        value={searchQuery}
        onChangeText={setSearchQuery}
      />
      <FlatList
        data={filteredItems}
        keyExtractor={(item) => item.id.toString()}
        renderItem={renderItem}
        ListEmptyComponent={<Text style={styles.emptyText}>No se encontraron registros</Text>}
      />
      <TouchableOpacity style={styles.addButton} onPress={() => router.push('/products_services/create')}>
        <Text style={styles.addButtonText}>âž• Agregar</Text>
      </TouchableOpacity>
    </View>
  );
}

const styles = StyleSheet.create({
  container: { flex: 1, padding: 16, backgroundColor: '#fff' },
  searchInput: { borderWidth: 1, borderColor: '#ccc', borderRadius: 8, padding: 12, marginBottom: 12 },
  itemContainer: { flexDirection: 'row', alignItems: 'center', paddingVertical: 8, borderBottomWidth: 1, borderColor: '#eee' },
  itemInfo: { flex: 1, marginLeft: 12 },
  itemTitle: { fontSize: 16, fontWeight: 'bold' },
  deleteButton: { padding: 8 },
  deleteText: { fontSize: 18 },
  addButton: { position: 'absolute', right: 16, bottom: 32, backgroundColor: '#28a745', padding: 16, borderRadius: 50, alignItems: 'center', justifyContent: 'center' },
  addButtonText: { color: '#fff', fontSize: 16, fontWeight: 'bold' },
  emptyText: { textAlign: 'center', marginTop: 20, fontSize: 16 },
});

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\products_services
File: [id].tsx
Content:
// C:/Users/Mauri/Documents/GitHub/router/app/products_services/[id].tsx
import React, { useState, useContext, useEffect } from 'react';
import { View, Text, TextInput, TouchableOpacity, StyleSheet, ScrollView, Alert, ActivityIndicator } from 'react-native';
import { useRouter, useLocalSearchParams } from 'expo-router';
import { ProductsServicesContext } from '@/contexts/ProductsServicesContext';
import { PermissionsContext } from '@/contexts/PermissionsContext';
import CircleImagePicker from '@/components/CircleImagePicker';

export default function ProductServiceDetail() {
  const router = useRouter();
  const { id } = useLocalSearchParams<{ id: string }>();
  const itemId = Number(id);
  const { productsServices, loadProductsServices, updateProductService, deleteProductService } = useContext(ProductsServicesContext);
  const { permissions } = useContext(PermissionsContext);

  const [loading, setLoading] = useState(false);
  const item = productsServices.find(p => p.id === itemId);

  const [description, setDescription] = useState('');
  const [category, setCategory] = useState('');
  const [price, setPrice] = useState('');
  const [cost, setCost] = useState('');
  const [difficulty, setDifficulty] = useState('');
  const [itemType, setItemType] = useState<'product' | 'service'>('product');
  const [stock, setStock] = useState('');
  const [productImageFileId, setProductImageFileId] = useState<string | null>(null);

  const canEdit = permissions.includes('updateProductService');
  const canDelete = permissions.includes('deleteProductService');

  useEffect(() => {
    if (!canEdit && !canDelete) {
      Alert.alert('Acceso denegado', 'No tienes permiso para acceder.');
      router.back();
    }
  }, [permissions]);

  useEffect(() => {
    if (!item) {
      Alert.alert('Error', 'Producto o servicio no encontrado.');
      router.back();
    } else {
      setDescription(item.description);
      setCategory(item.category);
      setPrice(String(item.price));
      setCost(String(item.cost));
      setDifficulty(item.difficulty);
      setItemType(item.item_type);
      setStock(item.stock?.toString() || '');
      setProductImageFileId(item.product_image_file_id);
    }
  }, [item]);

  const handleUpdate = () => {
  /*  if (!description || !category || !price || !cost || !difficulty || !itemType) {
      Alert.alert('Error', 'Completa todos los campos obligatorios.');
      return;
    }*/
    Alert.alert('Actualizar', 'Â¿Actualizar este Ã­tem?', [
      { text: 'Cancelar', style: 'cancel' },
      {
        text: 'Actualizar',
        onPress: async () => {
          setLoading(true);
          const success = await updateProductService(itemId, {
            description,
            category,
            price: parseFloat(price),
            cost: parseFloat(cost),
            difficulty,
            item_type: itemType,
            stock: stock ? parseInt(stock) : null,
            product_image_file_id: productImageFileId
          });
          setLoading(false);
          if (success) {
            Alert.alert('Ã‰xito', 'Actualizado correctamente.');
            await loadProductsServices(); 
            router.back();
          } else {
            Alert.alert('Error', 'No se pudo actualizar.');
          }
        }
      }
    ]);
  };

  const handleDelete = () => {
    Alert.alert('Eliminar', 'Â¿Eliminar este Ã­tem?', [
      { text: 'Cancelar', style: 'cancel' },
      {
        text: 'Eliminar', style: 'destructive', onPress: async () => {
          setLoading(true);
          const success = await deleteProductService(itemId);
          setLoading(false);
          if (success) {
            Alert.alert('Ã‰xito', 'Eliminado correctamente.');
            router.back();
          } else {
            Alert.alert('Error', 'No se pudo eliminar.');
          }
        }
      }
    ]);
  };

  return (
    <ScrollView contentContainerStyle={styles.container}>
      <Text style={styles.label}>Imagen</Text>
      <CircleImagePicker fileId={productImageFileId} editable={true} size={200} onImageChange={setProductImageFileId} />

      <Text style={styles.label}>DescripciÃ³n</Text>
      <TextInput style={styles.input} value={description} onChangeText={setDescription} placeholder="DescripciÃ³n" />

      <Text style={styles.label}>CategorÃ­a</Text>
      <TextInput style={styles.input} value={category} onChangeText={setCategory} placeholder="CategorÃ­a" />

      <Text style={styles.label}>Precio</Text>
      <TextInput style={styles.input} keyboardType="decimal-pad" value={price} onChangeText={setPrice} placeholder="Precio" />

      <Text style={styles.label}>Costo</Text>
      <TextInput style={styles.input} keyboardType="decimal-pad" value={cost} onChangeText={setCost} placeholder="Costo" />

      <Text style={styles.label}>Dificultad</Text>
      <TextInput style={styles.input} value={difficulty} onChangeText={setDifficulty} placeholder="Dificultad" />

      <Text style={styles.label}>Tipo</Text>
      <View style={styles.row}>
        <TouchableOpacity onPress={() => setItemType('product')} style={[styles.radio, itemType === 'product' && styles.radioSelected]}><Text>Producto</Text></TouchableOpacity>
        <TouchableOpacity onPress={() => setItemType('service')} style={[styles.radio, itemType === 'service' && styles.radioSelected]}><Text>Servicio</Text></TouchableOpacity>
      </View>

      <Text style={styles.label}>Stock (opcional)</Text>
      <TextInput style={styles.input} keyboardType="numeric" value={stock} onChangeText={setStock} placeholder="Stock disponible" />

      {canEdit && (
        <TouchableOpacity style={styles.submitButton} onPress={handleUpdate}>
          {loading ? <ActivityIndicator color="#fff" /> : <Text style={styles.submitButtonText}>Actualizar</Text>}
        </TouchableOpacity>
      )}

      {canDelete && (
        <TouchableOpacity style={styles.deleteButton} onPress={handleDelete}>
          {loading ? <ActivityIndicator color="#fff" /> : <Text style={styles.deleteButtonText}>Eliminar</Text>}
        </TouchableOpacity>
      )}
    </ScrollView>
  );
}

const styles = StyleSheet.create({
  container: { padding: 16, backgroundColor: '#fff', flexGrow: 1 },
  label: { marginVertical: 8, fontSize: 16 },
  input: { borderWidth: 1, borderColor: '#ccc', borderRadius: 8, padding: 12, marginBottom: 8 },
  row: { flexDirection: 'row', gap: 16, marginVertical: 8 },
  radio: { padding: 10, borderRadius: 8, borderWidth: 1, borderColor: '#007BFF' },
  radioSelected: { backgroundColor: '#007BFF22' },
  submitButton: { marginTop: 16, backgroundColor: '#007BFF', padding: 16, borderRadius: 8, alignItems: 'center' },
  submitButtonText: { color: '#fff', fontSize: 16, fontWeight: 'bold' },
  deleteButton: { marginTop: 16, backgroundColor: '#dc3545', padding: 16, borderRadius: 8, alignItems: 'center' },
  deleteButtonText: { color: '#fff', fontSize: 16, fontWeight: 'bold' },
});

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\products_services
File: _layout.tsx
Content:
// C:/Users/Mauri/Documents/GitHub/router/app/cash_boxes/_layout.tsx
import React from 'react';
import { Stack } from 'expo-router';

export default function CashBoxesLayout() {
  return (
    <Stack>
      <Stack.Screen name="index" options={{ title: 'Productos y Servicios' }} />
      <Stack.Screen name="create" options={{ title: 'Nuevo Producto/Servicio' }} />
      <Stack.Screen name="[id]" options={{ title: 'Editar Producto/Servicio' }} />
    </Stack>
  );
}

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\statuses
File: create.tsx
Content:
// app/statuses/create.tsx
import React, { useState, useContext, useEffect } from 'react';
import { View, Text, TextInput, TouchableOpacity, StyleSheet, ScrollView, Alert, ActivityIndicator } from 'react-native';
import { useRouter } from 'expo-router';
import { StatusesContext } from '@/contexts/StatusesContext';
import { PermissionsContext } from '@/contexts/PermissionsContext';

export default function CreateStatus() {
  const router = useRouter();
  const { addStatus } = useContext(StatusesContext);
  const { permissions } = useContext(PermissionsContext);

  const [label, setLabel] = useState('');
  const [value, setValue] = useState('');
  const [backgroundColor, setBackgroundColor] = useState('#ffffff');
  const [orderIndex, setOrderIndex] = useState('0');
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    if (!permissions.includes('addStatus')) {
      Alert.alert('Acceso denegado', 'No tienes permiso para agregar estados.');
      router.back();
    }
  }, [permissions]);

  const handleSubmit = async () => {
    if (!label || !value || !backgroundColor || orderIndex === '') {
      Alert.alert('Error', 'Completa todos los campos requeridos.');
      return;
    }
    setLoading(true);
    const newStatus = await addStatus({
      label,
      value,
      background_color: backgroundColor,
      order_index: parseInt(orderIndex, 10),
    });
    setLoading(false);
    if (newStatus) {
      Alert.alert('Ã‰xito', 'Estado creado correctamente.');
      router.back();
    } else {
      Alert.alert('Error', 'No se pudo crear el estado.');
    }
  };

  return (
    <ScrollView contentContainerStyle={styles.container}>
      <Text style={styles.label}>Etiqueta</Text>
      <TextInput
        style={styles.input}
        placeholder="Etiqueta del estado"
        value={label}
        onChangeText={setLabel}
      />

      <Text style={styles.label}>Valor</Text>
      <TextInput
        style={styles.input}
        placeholder="Valor del estado"
        value={value}
        onChangeText={setValue}
      />

      <Text style={styles.label}>Color de Fondo (HEX)</Text>
      <TextInput
        style={styles.input}
        placeholder="#ffffff"
        value={backgroundColor}
        onChangeText={setBackgroundColor}
      />

      <Text style={styles.label}>Orden (Ã�ndice)</Text>
      <TextInput
        style={styles.input}
        placeholder="Orden de visualizaciÃ³n"
        value={orderIndex}
        keyboardType="numeric"
        onChangeText={setOrderIndex}
      />

      <TouchableOpacity style={styles.submitButton} onPress={handleSubmit} disabled={loading}>
        {loading ? <ActivityIndicator color="#fff" /> : <Text style={styles.submitButtonText}>Crear Estado</Text>}
      </TouchableOpacity>
    </ScrollView>
  );
}

const styles = StyleSheet.create({
  container: { padding: 16, backgroundColor: '#fff' },
  label: { marginVertical: 8, fontSize: 16 },
  input: { borderWidth: 1, borderColor: '#ccc', borderRadius: 8, padding: 12, marginBottom: 8 },
  submitButton: { marginTop: 16, backgroundColor: '#28a745', padding: 16, borderRadius: 8, alignItems: 'center' },
  submitButtonText: { color: '#fff', fontSize: 16, fontWeight: 'bold' },
});

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\statuses
File: index.tsx
Content:
// app/statuses/index.tsx
import React, { useContext, useEffect, useState, useMemo } from 'react';
import { View, Text, FlatList, TouchableOpacity, TextInput, StyleSheet, ActivityIndicator, Alert } from 'react-native';
import { useRouter } from 'expo-router';
import { StatusesContext } from '@/contexts/StatusesContext';
import { PermissionsContext } from '@/contexts/PermissionsContext';
import Fuse from 'fuse.js';
import { Alert as RNAlert } from 'react-native';

export default function StatusesScreen() {
  const { statuses, loadStatuses, deleteStatus } = useContext(StatusesContext);
  const { permissions } = useContext(PermissionsContext);
  const router = useRouter();
  const [search, setSearch] = useState('');
  const [loadingId, setLoadingId] = useState<number | null>(null);

  useEffect(() => {
    if (!permissions.includes('listStatuses')) {
      Alert.alert('Acceso denegado', 'No tienes permiso para ver los estados.');
      router.back();
    } else {
      loadStatuses();
    }
  }, [permissions]);

  const fuse = new Fuse(statuses, { keys: ['label', 'value'] });
  const filteredStatuses = useMemo(() => {
    if (!search) return statuses;
    const result = fuse.search(search);
    return result.map(r => r.item);
  }, [search, statuses]);

  const canDelete = permissions.includes('deleteStatus');

  const handleDelete = (id: number) => {
    Alert.alert(
      'Confirmar eliminaciÃ³n',
      'Â¿EstÃ¡s seguro de eliminar este estado?',
      [
        { text: 'Cancelar', style: 'cancel' },
        {
          text: 'Eliminar',
          style: 'destructive',
          onPress: async () => {
            setLoadingId(id);
            const success = await deleteStatus(id);
            setLoadingId(null);
            if (!success) {
              Alert.alert('Error', 'No se pudo eliminar el estado.');
            }
          }
        }
      ]
    );
  };

  const renderItem = ({ item }: { item: any }) => (
    <TouchableOpacity style={styles.itemContainer} onLongPress={() => router.push(`/statuses/${item.id}`)}>
      <View style={[styles.colorBox, { backgroundColor: item.background_color }]} />
      <View style={styles.itemContent}>
        <Text style={styles.itemLabel}>{item.label}</Text>
        <Text style={styles.itemValue}>{item.value}</Text>
      </View>
      {canDelete && (
        <TouchableOpacity style={styles.deleteButton} onPress={() => handleDelete(item.id)}>
          {loadingId === item.id ? <ActivityIndicator color="#fff" /> : <Text style={styles.deleteButtonText}>Eliminar</Text>}
        </TouchableOpacity>
      )}
    </TouchableOpacity>
  );

  return (
    <View style={styles.container}>
      <TextInput
        style={styles.searchInput}
        placeholder="Buscar estados..."
        value={search}
        onChangeText={setSearch}
      />
      <FlatList
        data={filteredStatuses}
        keyExtractor={(item) => item.id.toString()}
        renderItem={renderItem}
        ListEmptyComponent={<Text style={styles.emptyText}>No se encontraron estados</Text>}
      />
      <TouchableOpacity style={styles.addButton} onPress={() => router.push('/statuses/create')}>
        <Text style={styles.addButtonText}>Agregar Estado</Text>
      </TouchableOpacity>
    </View>
  );
}

const styles = StyleSheet.create({
  container: { flex: 1, padding: 16, backgroundColor: '#fff' },
  searchInput: {
    borderWidth: 1,
    borderColor: '#ccc',
    borderRadius: 8,
    padding: 12,
    marginBottom: 12,
  },
  itemContainer: {
    flexDirection: 'row',
    alignItems: 'center',
    paddingVertical: 10,
    borderBottomWidth: 1,
    borderColor: '#eee',
  },
  colorBox: {
    width: 40,
    height: 40,
    borderRadius: 4,
  },
  itemContent: {
    flex: 1,
    marginLeft: 12,
  },
  itemLabel: {
    fontSize: 16,
    fontWeight: 'bold',
  },
  itemValue: {
    fontSize: 14,
    color: '#555',
  },
  deleteButton: {
    backgroundColor: '#dc3545',
    padding: 8,
    borderRadius: 4,
  },
  deleteButtonText: {
    color: '#fff',
  },
  addButton: {
    position: 'absolute',
    right: 16,
    bottom: 32,
    backgroundColor: '#007BFF',
    padding: 16,
    borderRadius: 50,
    alignItems: 'center',
  },
  addButtonText: {
    color: '#fff',
    fontSize: 16,
    fontWeight: 'bold',
  },
  emptyText: {
    textAlign: 'center',
    marginTop: 20,
  },
});

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\statuses
File: [id].tsx
Content:
// app/statuses/[id].tsx
import React, { useState, useContext, useEffect } from 'react';
import { View, Text, TextInput, TouchableOpacity, StyleSheet, ScrollView, Alert, ActivityIndicator } from 'react-native';
import { useRouter, useLocalSearchParams } from 'expo-router';
import { StatusesContext } from '@/contexts/StatusesContext';
import { PermissionsContext } from '@/contexts/PermissionsContext';

export default function EditStatus() {
  const router = useRouter();
  const { id } = useLocalSearchParams<{ id: string }>();
  const statusId = Number(id);
  const { statuses, updateStatus, deleteStatus } = useContext(StatusesContext);
  const { permissions } = useContext(PermissionsContext);

  const statusItem = statuses.find(s => s.id === statusId);

  const [label, setLabel] = useState('');
  const [value, setValue] = useState('');
  const [backgroundColor, setBackgroundColor] = useState('#ffffff');
  const [orderIndex, setOrderIndex] = useState('0');
  const [loading, setLoading] = useState(false);

  const canEdit = permissions.includes('updateStatus');
  const canDelete = permissions.includes('deleteStatus');

  useEffect(() => {
    if (!canEdit && !canDelete) {
      Alert.alert('Acceso denegado', 'No tienes permiso para acceder a este estado.');
      router.back();
    }
  }, [permissions]);

  useEffect(() => {
    if (statusItem) {
      setLabel(statusItem.label);
      setValue(statusItem.value);
      setBackgroundColor(statusItem.background_color);
      setOrderIndex(statusItem.order_index.toString());
    } else {
      Alert.alert('Error', 'Estado no encontrado.');
      router.back();
    }
  }, [statusItem]);

  const handleUpdate = () => {
    if (!label || !value || !backgroundColor || orderIndex === '') {
      Alert.alert('Error', 'Completa todos los campos requeridos.');
      return;
    }
    Alert.alert('Actualizar Estado', 'Â¿Deseas actualizar este estado?', [
      { text: 'Cancelar', style: 'cancel' },
      {
        text: 'Actualizar',
        onPress: async () => {
          setLoading(true);
          const success = await updateStatus(statusId, {
            label,
            value,
            background_color: backgroundColor,
            order_index: parseInt(orderIndex, 10),
          });
          setLoading(false);
          if (success) {
            Alert.alert('Ã‰xito', 'Estado actualizado correctamente.');
            router.back();
          } else {
            Alert.alert('Error', 'No se pudo actualizar el estado.');
          }
        }
      }
    ]);
  };

  const handleDelete = () => {
    Alert.alert('Eliminar Estado', 'Â¿Deseas eliminar este estado?', [
      { text: 'Cancelar', style: 'cancel' },
      {
        text: 'Eliminar',
        style: 'destructive',
        onPress: async () => {
          setLoading(true);
          const success = await deleteStatus(statusId);
          setLoading(false);
          if (success) {
            Alert.alert('Ã‰xito', 'Estado eliminado correctamente.');
            router.back();
          } else {
            Alert.alert('Error', 'No se pudo eliminar el estado.');
          }
        }
      }
    ]);
  };

  return (
    <ScrollView contentContainerStyle={styles.container}>
      <Text style={styles.label}>Etiqueta</Text>
      <TextInput style={styles.input} value={label} onChangeText={setLabel} placeholder="Etiqueta" />

      <Text style={styles.label}>Valor</Text>
      <TextInput style={styles.input} value={value} onChangeText={setValue} placeholder="Valor" />

      <Text style={styles.label}>Color de Fondo (HEX)</Text>
      <TextInput style={styles.input} value={backgroundColor} onChangeText={setBackgroundColor} placeholder="#ffffff" />

      <Text style={styles.label}>Orden (Ã�ndice)</Text>
      <TextInput style={styles.input} value={orderIndex} keyboardType="numeric" onChangeText={setOrderIndex} placeholder="Orden" />

      {canEdit && (
        <TouchableOpacity style={styles.submitButton} onPress={handleUpdate} disabled={loading}>
          {loading ? <ActivityIndicator color="#fff" /> : <Text style={styles.submitButtonText}>Actualizar Estado</Text>}
        </TouchableOpacity>
      )}
      {canDelete && (
        <TouchableOpacity style={styles.deleteButton} onPress={handleDelete} disabled={loading}>
          {loading ? <ActivityIndicator color="#fff" /> : <Text style={styles.deleteButtonText}>Eliminar Estado</Text>}
        </TouchableOpacity>
      )}
    </ScrollView>
  );
}

const styles = StyleSheet.create({
  container: { padding: 16, backgroundColor: '#fff' },
  label: { marginVertical: 8, fontSize: 16 },
  input: { borderWidth: 1, borderColor: '#ccc', borderRadius: 8, padding: 12, marginBottom: 8 },
  submitButton: { marginTop: 16, backgroundColor: '#007BFF', padding: 16, borderRadius: 8, alignItems: 'center' },
  submitButtonText: { color: '#fff', fontSize: 16, fontWeight: 'bold' },
  deleteButton: { marginTop: 16, backgroundColor: '#dc3545', padding: 16, borderRadius: 8, alignItems: 'center' },
  deleteButtonText: { color: '#fff', fontSize: 16, fontWeight: 'bold' },
});

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\statuses
File: _layout.tsx
Content:
// app/statuses/_layout.tsx
import React from 'react';
import { Stack } from 'expo-router';

export default function StatusesLayout() {
  return (
    <Stack>
      <Stack.Screen name="index" options={{ title: 'Estados' }} />
      <Stack.Screen name="create" options={{ title: 'Nuevo Estado' }} />
      <Stack.Screen name="[id]" options={{ title: 'Editar Estado' }} />
    </Stack>
  );
}

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\user
File: ConfigScreen.tsx
Content:
// app/user/ConfigScreen.tsx
import React, { useContext, useEffect, useState } from 'react';
import { View, Text, StyleSheet, ScrollView, Button, Alert, TextInput, TouchableOpacity } from 'react-native';
import { ConfigContext, ConfigForm } from '@/contexts/ConfigContext';
import globalStyles from '@/styles/GlobalStyles';

const ConfigScreen: React.FC = () => {
  const { configDetails, loadConfig, updateConfig } = useContext(ConfigContext)!;
  const [editConfig, setEditConfig] = useState<boolean>(false);
  const [configForm, setConfigForm] = useState<ConfigForm>({
    role: '',
    view_type: '',
    theme: '',
    font_size: '',
  });

  useEffect(() => {
    // Cargamos la configuraciÃ³n (loadConfig se ejecuta al montar el provider, pero aquÃ­ se puede refrescar)
    loadConfig();
  }, []);

  useEffect(() => {
    if (configDetails) {
      setConfigForm({
        role: configDetails.role || '',
        view_type: configDetails.view_type || '',
        theme: configDetails.theme || '',
        font_size: configDetails.font_size || '',
      });
    }
  }, [configDetails]);

  return (
    <ScrollView style={styles.container}>
      <Text style={styles.subtitle}>ConfiguraciÃ³n</Text>
      {configDetails ? (
        <View style={styles.dataContainer}>
          {editConfig ? (
            <>
              <TextInput
                style={styles.input}
                value={configForm.role}
                onChangeText={(text) => setConfigForm({ ...configForm, role: text })}
                placeholder="Rol"
              />
              <TextInput
                style={styles.input}
                value={configForm.view_type}
                onChangeText={(text) => setConfigForm({ ...configForm, view_type: text })}
                placeholder="Tipo de vista"
              />
              <TextInput
                style={styles.input}
                value={configForm.theme}
                onChangeText={(text) => setConfigForm({ ...configForm, theme: text })}
                placeholder="Tema"
              />
              <TextInput
                style={styles.input}
                value={configForm.font_size}
                onChangeText={(text) => setConfigForm({ ...configForm, font_size: text })}
                placeholder="TamaÃ±o de fuente"
              />
              <Button
                title="Guardar ConfiguraciÃ³n"
                onPress={() => {
                  void updateConfig(configForm);
                  setEditConfig(false);
                }}
              />
            </>
          ) : (
            <>
              <Text style={styles.infoText}>Rol: {configDetails.role}</Text>
              <Text style={styles.infoText}>Tipo de vista: {configDetails.view_type}</Text>
              <Text style={styles.infoText}>Tema: {configDetails.theme}</Text>
              <Text style={styles.infoText}>TamaÃ±o de fuente: {configDetails.font_size}</Text>
              <TouchableOpacity style={styles.editButton} onPress={() => setEditConfig(true)}>
                <Text style={styles.editButtonText}>Editar ConfiguraciÃ³n</Text>
              </TouchableOpacity>
            </>
          )}
        </View>
      ) : (
        <Text style={styles.infoText}>Cargando configuraciÃ³n...</Text>
      )}
    </ScrollView>
  );
};

const styles = StyleSheet.create({
  container: { flex: 1, padding: 20 },
  subtitle: {
    fontSize: 22,
    fontWeight: 'bold',
    marginBottom: 10,
  },
  dataContainer: {
    backgroundColor: '#f5f5f5',
    padding: 15,
    borderRadius: 10,
    marginBottom: 20,
    justifyContent: 'center',
  },
  infoText: { fontSize: 18, marginVertical: 5 },
  input: {
    borderWidth: 1,
    padding: 10,
    marginVertical: 8,
    borderRadius: 5,
    fontSize: 16,
    backgroundColor: '#fff',
  },
  editButton: {
    backgroundColor: '#007BFF',
    borderRadius: 10,
    padding: 15,
    marginTop: 10,
    alignItems: 'center',
  },
  editButtonText: {
    color: '#fff',
    fontSize: 18,
  },
});

export default ConfigScreen;

---
Folder: C:/Users/Mauri/Documents/GitHub/sisa.ui/app\user
File: ProfileScreen.tsx
Content:
import React, { useContext, useEffect, useState } from 'react';
import { View, Text, ScrollView, Button, TextInput, TouchableOpacity } from 'react-native';
import { useRouter } from 'expo-router';
import CircleImagePicker from '@/components/CircleImagePicker';
import { AuthContext } from '@/contexts/AuthContext';
import { ProfileContext, ProfileForm } from '@/contexts/ProfileContext';
import globalStyles from '@/styles/GlobalStyles';

export default function ProfileScreen(): JSX.Element {
  const router = useRouter();
  // Ahora extraemos email desde AuthContext
  const { username, email, logout } = useContext(AuthContext);
  const { profileDetails, loadProfile, updateProfile, updateImage, deleteAccount } = useContext(ProfileContext)!;

  // Estado local del formulario solo con campos editables (sin email)
  const [editProfile, setEditProfile] = useState<boolean>(false);
  const [profileForm, setProfileForm] = useState<ProfileForm>({
    full_name: '',
    phone: '',
    address: '',
    cuit: '',
    profile_file_id: '',
  });

  useEffect(() => {
    void loadProfile();
  }, []);

  useEffect(() => {
    // Al cargar el perfil, rellenamos el formulario con los campos editables
    if (profileDetails) {
      setProfileForm({
        full_name: profileDetails.full_name || '',
        phone: profileDetails.phone || '',
        address: profileDetails.address || '',
        cuit: profileDetails.cuit || '',
        profile_file_id: profileDetails.profile_file_id ? profileDetails.profile_file_id.toString() : '',
      });
    }
  }, [profileDetails]);

  return (
    <ScrollView style={{ flex: 1, padding: 20 }}>
      <Text style={{ fontSize: 22, fontWeight: 'bold', marginBottom: 10 }}>Perfil</Text>

      {profileDetails ? (
        <View style={{ backgroundColor: '#f5f5f5', padding: 15, borderRadius: 10, marginBottom: 20 }}>
          <CircleImagePicker
            fileId={profileDetails.profile_file_id}
            editable={true}
            size={200}
            onImageChange={newFileId => updateImage(newFileId, profileForm)}
          />

          <Text style={{ fontSize: 18, marginVertical: 5 }}>Username: {username}</Text>
          <Text style={{ fontSize: 18, marginVertical: 5 }}>Email: {email}</Text>

          {editProfile ? (
            <>
              <TextInput
                style={{ borderWidth: 1, padding: 10, marginVertical: 8, borderRadius: 5, backgroundColor: '#fff' }}
                value={profileForm.full_name}
                onChangeText={text => setProfileForm({ ...profileForm, full_name: text })}
                placeholder="Nombre completo"
              />
              <TextInput
                style={{ borderWidth: 1, padding: 10, marginVertical: 8, borderRadius: 5, backgroundColor: '#fff' }}
                value={profileForm.phone}
                onChangeText={text => setProfileForm({ ...profileForm, phone: text })}
                placeholder="TelÃ©fono"
                keyboardType="phone-pad"
              />
              <TextInput
                style={{ borderWidth: 1, padding: 10, marginVertical: 8, borderRadius: 5, backgroundColor: '#fff' }}
                value={profileForm.address}
                onChangeText={text => setProfileForm({ ...profileForm, address: text })}
                placeholder="DirecciÃ³n"
              />
              <TextInput
                style={{ borderWidth: 1, padding: 10, marginVertical: 8, borderRadius: 5, backgroundColor: '#fff' }}
                value={profileForm.cuit}
                onChangeText={text => setProfileForm({ ...profileForm, cuit: text })}
                placeholder="CUIT"
                keyboardType="numeric"
              />
              <Button
                title="Guardar Perfil"
                onPress={() => {
                  void updateProfile(profileForm);
                  setEditProfile(false);
                }}
              />
            </>
          ) : (
            <>
              <Text style={{ fontSize: 18, marginVertical: 5 }}>Nombre: {profileDetails.full_name}</Text>
              <Text style={{ fontSize: 18, marginVertical: 5 }}>TelÃ©fono: {profileDetails.phone}</Text>
              <Text style={{ fontSize: 18, marginVertical: 5 }}>DirecciÃ³n: {profileDetails.address}</Text>
              <Text style={{ fontSize: 18, marginVertical: 5 }}>CUIT: {profileDetails.cuit}</Text>
              <TouchableOpacity
                style={{ backgroundColor: '#007BFF', borderRadius: 10, padding: 15, marginTop: 10, alignItems: 'center' }}
                onPress={() => setEditProfile(true)}
              >
                <Text style={{ color: '#fff', fontSize: 18 }}>Editar Perfil</Text>
              </TouchableOpacity>
            </>
          )}
        </View>
      ) : (
        <Text style={{ fontSize: 18, marginVertical: 5 }}>Cargando perfil...</Text>
      )}
      <View style={globalStyles.button}>
        <Button title="Eliminar Cuenta" onPress={deleteAccount} color="red" />
      </View>
      <View style={globalStyles.button}>
        <Button title="Cerrar SesiÃ³n" onPress={logout} />
      </View>
    </ScrollView>
  );
}

---
